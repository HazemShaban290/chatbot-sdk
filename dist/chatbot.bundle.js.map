{"version":3,"file":"chatbot.bundle.js","sources":["../src/utils.js","../node_modules/style-inject/dist/style-inject.es.js","../src/renderer.js","../src/chatbot.js"],"sourcesContent":["// src/utils.js\n\n/**\n * Generates a unique session ID.\n * @returns {string} A unique ID.\n */\nexport function generateUniqueId() {\n  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n    const r = Math.random() * 16 | 0,\n          v = c === 'x' ? r : (r & 0x3 | 0x8);\n    return v.toString(16);\n  });\n}\n\n/**\n * Stores data in localStorage.\n * @param {string} key - The key to store data under.\n * @param {*} value - The data to store.\n */\nexport function setLocalStorageItem(key, value) {\n  try {\n    localStorage.setItem(key, JSON.stringify(value));\n  } catch (e) {\n    console.warn('Chatbot SDK: localStorage write error:', e);\n  }\n}\n\n/**\n * Retrieves data from localStorage.\n * @param {string} key - The key to retrieve data from.\n * @returns {*} The retrieved data, or null if not found/error.\n */\nexport function getLocalStorageItem(key) {\n  try {\n    const item = localStorage.getItem(key);\n    return item ? JSON.parse(item) : null;\n  } catch (e) {\n    console.warn('Chatbot SDK: localStorage read error:', e);\n    return null;\n  }\n}\n\n/**\n * Basic Markdown parsing for bold, italics, links.\n * This is a simplified parser. For full markdown, consider a tiny library if allowed.\n * @param {string} text - The text to parse.\n * @returns {string} HTML string with basic markdown applied.\n */\nexport function parseMarkdown(text) {\n    if (!text) return '';\n    let html = text;\n\n    // Bold: **text** or __text__\n    html = html.replace(/\\*\\*(.*?)\\*\\*/g, '<strong>$1</strong>');\n    html = html.replace(/__(.*?)__/g, '<strong>$1</strong>');\n\n    // Italics: *text* or _text_\n    html = html.replace(/\\*(.*?)\\*/g, '<em>$1</em>');\n    html = html.replace(/_(.*?)_/g, '<em>$1</em>');\n\n    // Links: [text](url)\n    html = html.replace(/\\[([^\\]]+)\\]\\(([^)]+)\\)/g, '<a href=\"$2\" target=\"_blank\" rel=\"noopener noreferrer\">$1</a>');\n\n    // Line breaks\n    html = html.replace(/\\n/g, '<br/>');\n\n    return html;\n}\n\n/**\n * Dynamically loads an external script.\n * @param {string} url - The URL of the script.\n * @param {string} id - A unique ID for the script tag.\n * @returns {Promise<void>} A promise that resolves when the script is loaded.\n */\nexport function loadScript(url, id) {\n    return new Promise((resolve, reject) => {\n        if (document.getElementById(id)) {\n            return resolve(); // Already loaded\n        }\n        const script = document.createElement('script');\n        script.id = id;\n        script.src = url;\n        script.async = true;\n        script.onload = () => resolve();\n        script.onerror = () => reject(new Error(`Failed to load script: ${url}`));\n        document.head.appendChild(script);\n    });\n}","function styleInject(css, ref) {\n  if ( ref === void 0 ) ref = {};\n  var insertAt = ref.insertAt;\n\n  if (!css || typeof document === 'undefined') { return; }\n\n  var head = document.head || document.getElementsByTagName('head')[0];\n  var style = document.createElement('style');\n  style.type = 'text/css';\n\n  if (insertAt === 'top') {\n    if (head.firstChild) {\n      head.insertBefore(style, head.firstChild);\n    } else {\n      head.appendChild(style);\n    }\n  } else {\n    head.appendChild(style);\n  }\n\n  if (style.styleSheet) {\n    style.styleSheet.cssText = css;\n  } else {\n    style.appendChild(document.createTextNode(css));\n  }\n}\n\nexport default styleInject;\n","\n// src/renderer.js\nimport { loadScript } from './utils';\n\n// Get reference to the chatbot instance\nconst getChatbot = () => window.ChatbotSDK || { config: {} };\n\n/**\n * Applies styles to an element with priority to message-specific styles\n * @param {HTMLElement} element - The element to style\n * @param {string} component - The component type (e.g., 'buttons', 'carousel')\n * @param {string} elementType - The specific element type (e.g., 'container', 'button')\n * @param {object} [messageStyles] - Style overrides from message data (highest priority)\n */\nfunction applyStyles(element, component, elementType, messageStyles = {}) {\n  const chatbot = getChatbot();\n  \n  // Get base styles from config if they exist\n  const configStyles = chatbot.config.style?.components?.[component]?.[elementType] || {};\n  \n  // Get global message styles if they exist\n  const globalStyles = chatbot.config.style?.messages || {};\n  \n  // Merge styles with message styles taking priority\n  const styles = {\n    ...getDefaultStyles(component, elementType, globalStyles),\n    ...configStyles,\n    ...messageStyles\n  };\n\n  // Apply the combined styles\n  Object.entries(styles).forEach(([prop, value]) => {\n    if (value !== undefined && value !== null) {\n      // Handle CSS custom properties\n      if (prop.startsWith('--')) {\n        element.style.setProperty(prop, value);\n      } else {\n        element.style[prop] = value;\n      }\n    }\n  });\n}\n\n/**\n * Gets default styles based on global message styles\n */\nfunction getDefaultStyles(component, elementType, globalStyles) {\n  const defaults = {};\n  \n  switch (component) {\n    case 'buttons':\n      if (elementType === 'button') {\n        defaults.backgroundColor = globalStyles.buttonColor;\n        defaults.color = globalStyles.buttonTextColor;\n      }\n      break;\n    case 'carousel':\n      if (elementType === 'card') {\n        defaults.backgroundColor = globalStyles.botBubbleColor;\n      }\n      if (elementType === 'cardTitle' || elementType === 'cardSubtitle') {\n        defaults.color = globalStyles.botTextColor;\n      }\n      break;\n    case 'faq':\n      if (elementType === 'question') {\n        defaults.color = globalStyles.botTextColor;\n      }\n      break;\n    case 'rating':\n      if (elementType === 'star') {\n        defaults.color = globalStyles.buttonColor;\n      }\n      break;\n  }\n  \n  return defaults;\n}\n\n/**\n * Renders various message types with configured styling\n */\nexport function renderMessage(messageData, type, sendMessageCallback = null) {\n  switch (type) {\n    case 'buttons':\n      return createButtons(messageData.buttons, sendMessageCallback, messageData.style);\n    case 'image':\n      return createImage(messageData.image, messageData.style);\n    case 'video':\n      return createVideo(messageData.video, messageData.style);\n    case 'carousel':\n      return createCarousel(messageData.carousel, sendMessageCallback, messageData.style);\n    default:\n      return null;\n  }\n}\n\n/**\n * Renders custom payload types with configured styling\n */\nexport function renderCustomPayload(customPayload, sendMessageCallback = null) {\n    if (!customPayload) return null;\n\n    const customContainer = document.createElement('div');\n    customContainer.classList.add('chatbot-custom-payload');\n    applyStyles(customContainer, 'custom', 'container', customPayload.style);\n\n    if (customPayload.locations) {\n        const mapEl = createLocationsMap(customPayload.locations, customPayload.style);\n        if (mapEl) customContainer.appendChild(mapEl);\n    }\n    if (customPayload.faq_list) {\n        const faqEl = createFaqList(customPayload.faq_list, customPayload.style);\n        if (faqEl) customContainer.appendChild(faqEl);\n    }\n    if (customPayload.table) {\n        const tableEl = createTable(customPayload.table, customPayload.style);\n        if (tableEl) customContainer.appendChild(tableEl);\n    }\n    if (customPayload.rating) {\n        const ratingEl = createRating(customPayload.rating, sendMessageCallback, customPayload.style);\n        if (ratingEl) customContainer.appendChild(ratingEl);\n    }\n    if (customPayload.forms) {\n        const formEl = createDynamicForm(customPayload.forms, sendMessageCallback, customPayload.style);\n        if (formEl) customContainer.appendChild(formEl);\n    }\n\n    return customContainer.children.length > 0 ? customContainer : null;\n}\n\n// --- Component Creation Functions ---\n\nfunction createButtons(buttons, sendMessageCallback, styleOverrides = {}) {\n  if (!buttons || buttons.length === 0) return null;\n  \n  const container = document.createElement('div');\n  container.className = 'chatbot-button-container';\n  applyStyles(container, 'buttons', 'container', styleOverrides.container);\n\n  buttons.forEach(btn => {\n    const button = document.createElement('button');\n    button.textContent = btn.title;\n    button.className = 'chatbot-button';\n    \n    // Apply button styles with proper priority\n    applyStyles(button, 'buttons', 'button', {\n      // From button-specific config in message\n      ...(btn.button_color && { backgroundColor: btn.button_color }),\n      ...(btn.button_color && { color: 'white' }),\n      ...(btn.button_color && { borderColor: btn.button_color }),\n      // From style overrides\n      ...styleOverrides.button\n    });\n\n    if (btn.payload) {\n      button.addEventListener('click', () => {\n        container.querySelectorAll('button').forEach(b => b.disabled = true);\n        if (sendMessageCallback) sendMessageCallback(btn.title, btn.payload);\n      });\n    } else if (btn.url) {\n      button.addEventListener('click', () => window.open(btn.url, '_blank'));\n    } else if (btn.question) {\n      button.addEventListener('click', () => {\n        container.querySelectorAll('button').forEach(b => b.disabled = true);\n        if (sendMessageCallback) sendMessageCallback(btn.title, btn.question);\n      });\n    }\n    \n    container.appendChild(button);\n  });\n  \n  return container;\n}\n\nfunction createImage(imageUrl, styleOverrides = {}) {\n  if (!imageUrl) return null;\n  \n  const img = document.createElement('img');\n  img.src = imageUrl;\n  img.className = 'chatbot-image';\n  applyStyles(img, 'image', 'image', styleOverrides);\n  \n  return img;\n}\n\nfunction createVideo(videoUrl, styleOverrides = {}) {\n  if (!videoUrl) return null;\n  \n  const video = document.createElement('video');\n  video.src = videoUrl;\n  video.controls = true;\n  video.className = 'chatbot-video';\n  applyStyles(video, 'video', 'video', styleOverrides);\n  \n  return video;\n}\n\nfunction createCarousel(carouselItems, sendMessageCallback, styleOverrides = {}) {\n  if (!carouselItems || carouselItems.length === 0) return null;\n  \n  const container = document.createElement('div');\n  container.className = 'chatbot-carousel-container';\n  applyStyles(container, 'carousel', 'container', styleOverrides.container);\n\n  carouselItems.forEach(item => {\n    const card = document.createElement('div');\n    card.className = 'chatbot-carousel-card';\n    applyStyles(card, 'carousel', 'card', styleOverrides.card);\n\n    if (item.image_url) {\n      const img = document.createElement('img');\n      img.src = item.image_url;\n      img.className = 'chatbot-carousel-card-image';\n      applyStyles(img, 'carousel', 'cardImage', styleOverrides.cardImage);\n      card.appendChild(img);\n    }\n\n    const content = document.createElement('div');\n    content.className = 'chatbot-carousel-card-content';\n    applyStyles(content, 'carousel', 'cardContent', styleOverrides.content);\n\n    const title = document.createElement('h3');\n    title.className = 'chatbot-carousel-card-title';\n    title.textContent = item.title;\n    applyStyles(title, 'carousel', 'cardTitle', styleOverrides.title);\n    content.appendChild(title);\n\n    if (item.subtitle) {\n      const subtitle = document.createElement('p');\n      subtitle.className = 'chatbot-carousel-card-subtitle';\n      subtitle.textContent = item.subtitle;\n      applyStyles(subtitle, 'carousel', 'cardSubtitle', styleOverrides.subtitle);\n      content.appendChild(subtitle);\n    }\n\n    if (item.buttons?.length > 0) {\n      const buttonsContainer = createButtons(item.buttons, sendMessageCallback, {\n        ...styleOverrides,\n        button: {\n          ...(item.button_style || {})\n        }\n      });\n      if (buttonsContainer) content.appendChild(buttonsContainer);\n    }\n    \n    card.appendChild(content);\n    container.appendChild(card);\n  });\n  \n  return container;\n}\n\nfunction createLocationsMap(locations, styleOverrides = {}) {\n  if (!locations || locations.length === 0) return null;\n\n  const locationContainer = document.createElement('div');\n  locationContainer.className = 'chatbot-location-cards';\n  applyStyles(locationContainer, 'locations', 'container', styleOverrides.container);\n\n  locations.forEach(location => {\n    const mapUrl = `https://www.google.com/maps?q=${location.lat},${location.lng}`;\n    const staticMap = `https://maps.googleapis.com/maps/api/staticmap?center=${location.lat},${location.lng}&zoom=14&size=400x200&markers=color:red%7C${location.lat},${location.lng}&key=AIzaSyCYVHw1tnbSZsihFfewNPwvuKc0iXx0ymw`;\n\n    const card = document.createElement('div');\n    card.className = 'chatbot-location-card';\n    applyStyles(card, 'locations', 'card', styleOverrides.card);\n\n    // Map image\n    const img = document.createElement('img');\n    img.src = staticMap;\n    img.alt = `${location.name} map`;\n    img.className = 'chatbot-location-map';\n    applyStyles(img, 'locations', 'map', styleOverrides.map);\n    card.appendChild(img);\n\n    // Card body\n    const body = document.createElement('div');\n    body.className = 'chatbot-location-body';\n    applyStyles(body, 'locations', 'body', styleOverrides.body);\n\n    // Title\n    const title = document.createElement('div');\n    title.className = 'chatbot-location-title';\n    title.textContent = location.name;\n    applyStyles(title, 'locations', 'title', styleOverrides.title);\n    body.appendChild(title);\n\n    // Address\n    if (location.address) {\n      const address = document.createElement('div');\n      address.className = 'chatbot-location-address';\n      address.textContent = location.address;\n      applyStyles(address, 'locations', 'address', styleOverrides.address);\n      body.appendChild(address);\n    }\n\n    // Button\n    const button = document.createElement('a');\n    button.href = mapUrl;\n    button.target = '_blank';\n    button.className = 'chatbot-location-button';\n    button.textContent = 'View on Map';\n    applyStyles(button, 'locations', 'button', {\n      backgroundColor: getChatbot().config.style?.messages?.buttonColor,\n      color: getChatbot().config.style?.messages?.buttonTextColor,\n      ...styleOverrides.button\n    });\n    body.appendChild(button);\n\n    card.appendChild(body);\n    locationContainer.appendChild(card);\n  });\n\n  return locationContainer;\n}\n\nfunction createFaqList(faqs, styleOverrides = {}) {\n    if (!faqs || faqs.length === 0) return null;\n    \n    const container = document.createElement('div');\n    container.className = 'chatbot-faq-list-container';\n    applyStyles(container, 'faq', 'container', styleOverrides.container);\n\n    faqs.forEach((faq, index) => {\n        const item = document.createElement('div');\n        item.className = 'chatbot-faq-item';\n        applyStyles(item, 'faq', 'item', styleOverrides.item);\n\n        const question = document.createElement('div');\n        question.className = 'chatbot-faq-question';\n        question.textContent = faq.question;\n        applyStyles(question, 'faq', 'question', styleOverrides.question);\n        item.appendChild(question);\n\n        const answer = document.createElement('div');\n        answer.className = 'chatbot-faq-answer';\n        answer.innerHTML = faq.answer;\n        applyStyles(answer, 'faq', 'answer', styleOverrides.answer);\n        item.appendChild(answer);\n\n        question.addEventListener('click', () => {\n            item.classList.toggle('expanded');\n            if (item.classList.contains('expanded')) {\n                applyStyles(answer, 'faq', 'expandedAnswer', styleOverrides.expandedAnswer);\n            } else {\n                applyStyles(answer, 'faq', 'answer', styleOverrides.answer);\n            }\n        });\n        \n        container.appendChild(item);\n    });\n    \n    return container;\n}\n\nfunction createTable(tableData, styleOverrides = {}) {\n    if (!tableData || !tableData.headers || !tableData.rows) return null;\n\n    const container = document.createElement('div');\n    container.className = 'chatbot-table-container';\n    applyStyles(container, 'table', 'container', styleOverrides.container);\n\n    const table = document.createElement('table');\n    table.className = 'chatbot-table';\n    applyStyles(table, 'table', 'table', styleOverrides.table);\n\n    const thead = document.createElement('thead');\n    const headerRow = document.createElement('tr');\n    tableData.headers.forEach(headerText => {\n        const th = document.createElement('th');\n        th.textContent = headerText;\n        applyStyles(th, 'table', 'header', {\n          backgroundColor: getChatbot().config.style?.messages?.buttonColor,\n          color: getChatbot().config.style?.messages?.buttonTextColor,\n          ...styleOverrides.header\n        });\n        headerRow.appendChild(th);\n    });\n    thead.appendChild(headerRow);\n    table.appendChild(thead);\n\n    const tbody = document.createElement('tbody');\n    tableData.rows.forEach(rowData => {\n        const tr = document.createElement('tr');\n        rowData.forEach(cellData => {\n            const td = document.createElement('td');\n            td.textContent = cellData;\n            applyStyles(td, 'table', 'cell', styleOverrides.cell);\n            tr.appendChild(td);\n        });\n        tbody.appendChild(tr);\n    });\n    table.appendChild(tbody);\n\n    container.appendChild(table);\n    return container;\n}\n\nfunction createRating(ratingData, sendMessageCallback, styleOverrides = {}) {\n    if (!ratingData || !ratingData.scale) return null;\n\n    const container = document.createElement('div');\n    container.className = 'chatbot-rating-container';\n    applyStyles(container, 'rating', 'container', styleOverrides.container);\n\n    const title = document.createElement('div');\n    title.className = 'chatbot-rating-title';\n    title.textContent = ratingData.title || 'Please rate:';\n    applyStyles(title, 'rating', 'title', styleOverrides.title);\n    container.appendChild(title);\n\n    const starsContainer = document.createElement('div');\n    starsContainer.className = 'chatbot-stars';\n    applyStyles(starsContainer, 'rating', 'starsContainer', styleOverrides.starsContainer);\n    let selectedRating = 0;\n\n    for (let i = ratingData.scale; i >= 1; i--) {\n        const star = document.createElement('span');\n        star.innerHTML = '&#9733;';\n        star.dataset.value = i;\n        applyStyles(star, 'rating', 'star', {\n          color: getChatbot().config.style?.messages?.buttonColor,\n          ...styleOverrides.star\n        });\n\n        star.addEventListener('mouseover', () => {\n            starsContainer.querySelectorAll('span').forEach(s => {\n                if (parseInt(s.dataset.value) >= i) {\n                    s.classList.add('hover');\n                    applyStyles(s, 'rating', 'starHover', {\n                      color: getChatbot().config.style?.themeColor,\n                      ...styleOverrides.starHover\n                    });\n                }\n            });\n        });\n\n        star.addEventListener('mouseout', () => {\n            starsContainer.querySelectorAll('span').forEach(s => {\n                s.classList.remove('hover');\n                applyStyles(s, 'rating', 'star', {\n                  color: getChatbot().config.style?.messages?.buttonColor,\n                  ...styleOverrides.star\n                });\n            });\n        });\n\n        star.addEventListener('click', () => {\n            selectedRating = i;\n            starsContainer.querySelectorAll('span').forEach(s => {\n                if (parseInt(s.dataset.value) <= selectedRating) {\n                    s.classList.add('selected');\n                    applyStyles(s, 'rating', 'starSelected', {\n                      color: getChatbot().config.style?.themeColor,\n                      ...styleOverrides.starSelected\n                    });\n                } else {\n                    s.classList.remove('selected');\n                    applyStyles(s, 'rating', 'star', {\n                      color: getChatbot().config.style?.messages?.buttonColor,\n                      ...styleOverrides.star\n                    });\n                }\n            });\n            if (sendMessageCallback) {\n                sendMessageCallback(`Rated ${selectedRating} stars`, `/rate_service{\"rating\":${selectedRating}}`);\n            }\n        });\n        starsContainer.appendChild(star);\n    }\n    container.appendChild(starsContainer);\n    return container;\n}\n\nfunction createDynamicForm(formData, sendMessageCallback, styleOverrides = {}) {\n  if (!formData || !Array.isArray(formData.fields) || formData.fields.length === 0 || !formData.submit_payload) return null;\n\n  const container = document.createElement('div');\n  container.className = 'chatbot-form-container';\n  applyStyles(container, 'form', 'container', styleOverrides.container);\n\n  if (formData.title) {\n    const title = document.createElement('div');\n    title.className = 'chatbot-form-title';\n    title.textContent = formData.title;\n    applyStyles(title, 'form', 'title', styleOverrides.title);\n    container.appendChild(title);\n  }\n\n  const form = document.createElement('form');\n  form.className = 'chatbot-form';\n  applyStyles(form, 'form', 'form', styleOverrides.form);\n\n  formData.fields.forEach(field => {\n    const fieldDiv = document.createElement('div');\n    fieldDiv.className = 'chatbot-form-field';\n    applyStyles(fieldDiv, 'form', 'field', styleOverrides.field);\n\n    if (field.label) {\n      const label = document.createElement('label');\n      label.textContent = field.label;\n      label.htmlFor = `chatbot-form-${field.field_name}`;\n      applyStyles(label, 'form', 'label', styleOverrides.label);\n      fieldDiv.appendChild(label);\n    }\n\n    let inputElement;\n    if (field.type === 'select' && Array.isArray(field.options)) {\n      inputElement = document.createElement('select');\n      inputElement.name = field.field_name;\n      inputElement.id = `chatbot-form-${field.field_name}`;\n      field.options.forEach(optionText => {\n        const option = document.createElement('option');\n        option.value = optionText;\n        option.textContent = optionText;\n        inputElement.appendChild(option);\n      });\n    } else if (field.type === 'textarea') {\n      inputElement = document.createElement('textarea');\n      inputElement.name = field.field_name;\n      inputElement.id = `chatbot-form-${field.field_name}`;\n      inputElement.placeholder = field.placeholder || '';\n      inputElement.required = !!field.required;\n    } else {\n      inputElement = document.createElement('input');\n      inputElement.type = field.type || 'text';\n      inputElement.name = field.field_name;\n      inputElement.id = `chatbot-form-${field.field_name}`;\n      inputElement.placeholder = field.placeholder || '';\n      inputElement.required = !!field.required;\n    }\n\n    applyStyles(inputElement, 'form', 'input', {\n      backgroundColor: getChatbot().config.style?.messages?.inputBackground,\n      color: getChatbot().config.style?.messages?.inputTextColor,\n      borderColor: getChatbot().config.style?.messages?.inputBorderColor,\n      ...styleOverrides.input\n    });\n\n    fieldDiv.appendChild(inputElement);\n    form.appendChild(fieldDiv);\n  });\n\n  const submitButton = document.createElement('button');\n  submitButton.type = 'submit';\n  submitButton.className = 'chatbot-form-submit-button';\n  submitButton.textContent = formData.submit_button_text || 'Submit';\n  applyStyles(submitButton, 'form', 'submitButton', {\n    backgroundColor: getChatbot().config.style?.messages?.buttonColor,\n    color: getChatbot().config.style?.messages?.buttonTextColor,\n    ...styleOverrides.submitButton\n  });\n  form.appendChild(submitButton);\n\n  form.addEventListener('submit', (e) => {\n    e.preventDefault();\n    const formValues = {};\n    formData.fields.forEach(field => {\n      const input = form.querySelector(`[name=\"${field.field_name}\"]`);\n      if (input) formValues[field.field_name] = input.value;\n    });\n\n    if (sendMessageCallback) {\n      const userMessageText = `Submitted form: ${Object.entries(formValues).map(([key, value]) => `${key}: ${value}`).join(', ')}`;\n      const submitPayload = `${formData.submit_payload}${JSON.stringify(formValues)}`;\n      sendMessageCallback(userMessageText, submitPayload);\n    }\n    form.querySelectorAll('input, select, textarea, button').forEach(el => el.disabled = true);\n  });\n\n  container.appendChild(form);\n  return container;\n}\n","// src/chatbot.js - Enhanced with tabs, responsive design, and new features\nimport './chatbot.css';\nimport { parseMarkdown, generateUniqueId, setLocalStorageItem, getLocalStorageItem } from './utils';\nimport { renderMessage, renderCustomPayload } from './renderer';\n\nlet authToken = null;\nlet is_first_log_in = true;\n\nclass ChatbotWidget {\n  constructor() {\n    this.config = {};\n    this.isOpen = false;\n    this.sessionId = null;\n    this.messages = [];\n    this.elements = {};\n    this.refreshInterval = null;\n    this.debug = true;\n    this.currentTab = 'home';\n    this.termsAccepted = false;\n    this.announcements = [];\n    this.userNotifications = [];\n  }\n\n  log(...args) {\n    if (this.debug) console.log('[Chatbot]', ...args);\n  }\n\n  // --- Configuration & Initialization ---\n  initConfig(apiConfig = {}) {\n    const scriptTag = document.querySelector('script[src*=\"chatbot.bundle.js\"]');\n    let scriptConfig = {};\n\n    if (scriptTag) {\n      const configJson = scriptTag.getAttribute('chatbot-config');\n      if (configJson) {\n        try {\n          scriptConfig = JSON.parse(configJson);\n        } catch (e) {\n          console.error('Chatbot SDK: Invalid JSON in chatbot-config attribute', e);\n        }\n      }\n    }\n\n    this.config = {\n      ...scriptConfig,\n      ...apiConfig\n    };\n\n    // Apply defaults if not set\n    this.config.botUrl = this.config.botUrl || 'http://0.0.0.0:8000/api/v1/chatbot/chat';\n    this.config.startingUrl = 'http://0.0.0.0:8000/api/v1/chatbot/start';\n    this.config.announcementsUrl = 'http://0.0.0.0:8000/api/v1/chatbot/news';\n    this.config.themeColor = this.config.themeColor || '#020c15ff';\n    //console.log('Theme color set to:', this.config.themeColor);\n    this.config.position = this.config.position || 'bottom-right';\n    this.config.botName = this.config.botName || 'Chatbot';\n    console.log('botName:', this.config.botName);\n    this.config.inputPlaceholder = this.config.inputPlaceholder || 'Type your message...';\n    this.config.sendButtonText = this.config.sendButtonText || 'Send';\n  }\n\n  async init() {\n    this.initConfig();\n    await this.loadConfig();\n    this.initSession();\n    \n    if (document.readyState === 'complete' || document.readyState === 'interactive') {\n      this.createWidgetUI();\n    } else {\n      document.addEventListener('DOMContentLoaded', () => {\n        console.log('DOM fully loaded, creating UI');\n        this.createWidgetUI();\n      });\n    }\n    \n    // Fallback timeout\n    setTimeout(() => {\n      if (!this.elements.container) {\n        console.warn('Fallback UI creation');\n        this.createWidgetUI();\n      }\n    }, 1000);\n\n    // Load announcements\n    console.log('Loading announcements...');\n    await this.loadAnnouncements();\n  }\n\n  async loadConfig() {\n    if (this.config.configApiUrl) {\n      try {\n        this.log('Loading initial config from API');\n        const response = await fetch(`${this.config.configApiUrl}?t=${Date.now()}`);\n        const apiConfig = await response.json();\n        this.mergeConfigs(apiConfig);\n        this.applyDynamicStyles();\n      } catch (error) {\n        this.log('Initial config load failed:', error);\n      }\n    }\n  }\n\n  // --- Announcements Management ---\n  async loadAnnouncements() {\n    try {\n      const response = await fetch(this.config.announcementsUrl, {\n        method: 'GET',\n        headers: { 'Content-Type': 'application/json' }\n      });\n\n      if (response.ok) {\n        const announcements = await response.json();\n        this.announcements = announcements.sort((a, b) => new Date(b.date) - new Date(a.date));\n        this.renderAnnouncements();\n      }\n    } catch (error) {\n      console.error('Failed to load announcements:', error);\n    }\n  }\n\n  renderAnnouncements() {\n  const announcementsContent = this.elements.announcementsContent;\n  if (!announcementsContent) return;\n\n  const container = announcementsContent.querySelector('.chatbot-announcements-list');\n  if (!container) return;\n\n  container.innerHTML = '';\n  // Add a class for the specific scroll effect\n  container.classList.add('scroll-stack-list');\n\n  if (this.announcements.length === 0) {\n    container.innerHTML = `\n      <div class=\"chatbot-announcements-empty\">\n        <div class=\"chatbot-announcements-empty-icon\">üì¢</div>\n        <p>No announcements available at the moment.</p>\n      </div>\n    `;\n    return;\n  }\n\n  this.announcements.forEach((announcement, index) => {\n    const card = document.createElement('div');\n    card.className = 'chatbot-announcement-card';\n    card.style.animationDelay = `${index * 0.1}s`;\n\n    const imageSection = announcement.image \n      ? `<div class=\"chatbot-announcement-image\" style=\"background-image: url('${announcement.image}')\"></div>`\n      : `<div class=\"chatbot-announcement-image chatbot-announcement-default-icon\">üì¢</div>`;\n\n    card.innerHTML = `\n    \n      ${imageSection}\n      <div class=\"chatbot-announcement-content\">\n        <div class=\"chatbot-announcement-title\">${announcement.text || 'Announcement'}</div>\n        <div class=\"chatbot-announcement-description\">${announcement.description || ''}</div>\n        <div class=\"chatbot-announcement-date\">${this.formatDate(announcement.date)}</div>\n      </div>\n    `;\n\n    container.appendChild(card);\n  });\n}\n  formatDate(dateString) {\n    if (!dateString) return '';\n    try {\n      const date = new Date(dateString);\n      return date.toLocaleDateString('en-US', { \n        year: 'numeric', \n        month: 'short', \n        day: 'numeric' \n      });\n    } catch (error) {\n      return dateString;\n    }\n  }\n\n  // --- Dynamic Configuration ---\n  async refreshConfig() {\n    try {\n      this.log('Refreshing configuration...');\n      const response = await fetch(`${this.config.configApiUrl}?t=${Date.now()}`);\n      const newConfig = await response.json();\n      this.mergeConfigs(newConfig);\n      this.applyDynamicStyles();\n      this.updateUIElements();\n      this.log('Configuration refreshed successfully');\n      return true;\n    } catch (error) {\n      this.log('Failed to refresh config:', error);\n      return false;\n    }\n  }\n\n  mergeConfigs(newConfig) {\n    this.config = {\n      ...this.config,\n      ...newConfig,\n      style: {\n        ...(this.config.style || {}),\n        ...(newConfig.style || {})\n      },\n      features: {\n        ...(this.config.features || {}),\n        ...(newConfig.features || {})\n      }\n    };\n    this.log('Merged config:', this.config);\n  }\n\n  applyDynamicStyles() {\n    if (!this.config.style) {\n      this.log('No style configuration found');\n      return;\n    }\n\n    const root = document.documentElement;\n    const { style } = this.config;\n\n    if (style.themeColor) {\n    console.log('Applying theme color:', style.themeColor);\n      root.style.setProperty('--chatbot-theme-color', style.themeColor);\n      root.style.setProperty('--chatbot-theme-color-hover', this.adjustColor(style.themeColor, -20));\n    }\n\n    if (style.header?.backgroundColor) {\n        console.log('Applying theme color:', style.backgroundColor);\n      root.style.setProperty('--chatbot-header-bg', style.header.backgroundColor);\n    }\n\n    if (style.header?.textColor) {\n      root.style.setProperty('--chatbot-header-text', style.header.textColor);\n    }\n\n    if (style.bubble?.color) {\n      root.style.setProperty('--chatbot-bubble-color', style.bubble.color);\n    }\n\n    if (style.messages?.userBubbleColor) {\n      root.style.setProperty('--chatbot-user-bubble', style.messages.userBubbleColor);\n    }\n\n    if (style.messages?.botBubbleColor) {\n      root.style.setProperty('--chatbot-bot-bubble', style.messages.botBubbleColor);\n    }\n  }\n\n  adjustColor(color, amount) {\n    return '#' + color.replace(/^#/, '').replace(/../g, colorHex => \n      ('0' + Math.min(255, Math.max(0, parseInt(colorHex, 16) + amount)).toString(16)).slice(-6));\n  }\n\n  // --- UI Management ---\n  createWidgetUI() {\n    console.log('Creating widget UI...');\n    console.log('Config:', this.config);\n  \n    const container = document.createElement('div');\n    container.id = 'chatbot-widget-container';\n    console.log('Container created:', container);\n\n    container.classList.add(`chatbot-position-${this.config.position}`);\n    container.style.display = 'none';\n    container.style.opacity = '0';\n\n    document.body.appendChild(container);\n    this.elements.container = container;\n    \n    setTimeout(() => {\n      const computedStyle = window.getComputedStyle(this.elements.container);\n      console.log('Computed styles:', {\n        display: computedStyle.display,\n        opacity: computedStyle.opacity,\n        zIndex: computedStyle.zIndex,\n        visibility: computedStyle.visibility\n      });\n    }, 500);\n\n    // Apply animation settings\n    const animation = this.config.style?.animation || { type: 'fade-in', duration: 300 };\n    if (animation.type) {\n      container.style.transition = `all ${animation.duration}ms ease`;\n    }\n\n    // Create Chat Bubble\n    const bubble = document.createElement('div');\n    bubble.className = 'chatbot-bubble';\n    \n    const bubbleStyle = this.config.style?.bubble || {};\n    bubble.style.width = bubbleStyle.size || '60px';\n    bubble.style.height = bubbleStyle.size || '60px';\n    bubble.style.backgroundColor = bubbleStyle.color || 'var(--chatbot-theme-color)';\n    \n    if (bubbleStyle.icon) {\n      bubble.innerHTML = bubbleStyle.icon.startsWith('http') ? \n        `<img src=\"${bubbleStyle.icon}\" alt=\"Chat\" style=\"width: 70%; height: 70%;\">` : \n        bubbleStyle.icon;\n    } else {\n      bubble.innerHTML = `\n        <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"white\">\n          <path d=\"M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-2 12H6v-2h12v2zm0-3H6V9h12v2zm0-3H6V6h12v2z\"/>\n        </svg>\n      `;\n    }\n    \n    bubble.addEventListener('click', () => this.toggleChatWindow());\n    container.appendChild(bubble);\n    this.elements.bubble = bubble;\n\n    // Create Chat Window with tabs\n    const windowEl = document.createElement('div');\n    windowEl.className = 'chatbot-window';\n    \n    const headerStyle = this.config.style?.header || {};\n    windowEl.innerHTML = `\n      <div class=\"chatbot-header\" style=\"\n        ${headerStyle.backgroundColor ? `background-color: ${headerStyle.backgroundColor};` : ''}\n        ${headerStyle.textColor ? `color: ${headerStyle.textColor};` : ''}\n      \">\n        <div class=\"chatbot-header-top\">\n          ${headerStyle.icon ? \n            `<img src=\"${headerStyle.icon}\" class=\"chatbot-header-icon\" \n              style=\"width: ${headerStyle.iconSize || '30px'}; height: ${headerStyle.iconSize || '30px'};\">` : ''}\n          <span class=\"chatbot-header-title\">${this.config.botName}</span>\n          <button class=\"chatbot-header-close\" style=\"\n            ${headerStyle.textColor ? `color: ${headerStyle.textColor};` : ''}\n          \">&times;</button>\n        </div>\n\n      </div>\n      \n      <div class=\"chatbot-content\">\n        <!-- Home Tab -->\n        <div class=\"chatbot-tab-content active\" data-content=\"home\">\n          <div class=\"chatbot-home-content\">\n            <div class=\"chatbot-home-welcome\">\n              <h2>Welcome!</h2>\n              <p>How can we help you today?</p>\n            </div>\n            \n            <div class=\"chatbot-actions-grid\">\n              <div class=\"chatbot-action-card\" data-action=\"start-chat\">\n                <span class=\"chatbot-action-icon\">üí¨</span>\n                <div class=\"chatbot-action-title\">Start Chat</div>\n                <div class=\"chatbot-action-desc\">Begin a conversation with our assistant</div>\n              </div>\n              <div class=\"chatbot-action-card\" data-action=\"check-products\">\n                <span class=\"chatbot-action-icon\">üè™</span>\n                <div class=\"chatbot-action-title\">Our Products</div>\n                <div class=\"chatbot-action-desc\">Explore our product offerings</div>\n              </div>\n              <div class=\"chatbot-action-card\" data-action=\"contact-us\">\n                <span class=\"chatbot-action-icon\">üìû</span>\n                <div class=\"chatbot-action-title\">Contact Us</div>\n                <div class=\"chatbot-action-desc\">Get in touch with support</div>\n              </div>\n              <div class=\"chatbot-action-card\" data-action=\"faq\">\n                <span class=\"chatbot-action-icon\">‚ùì</span>\n                <div class=\"chatbot-action-title\">FAQ</div>\n                <div class=\"chatbot-action-desc\">Find answers to common questions</div>\n              </div>\n            </div>\n            \n            <div class=\"chatbot-user-actions\" style=\"display: none;\">\n              <h3>Your Account</h3>\n              <div class=\"chatbot-user-notifications\"></div>\n            </div>\n          </div>\n        </div>\n        \n        <!-- Chat Tab -->\n        <div class=\"chatbot-tab-content\" data-content=\"chat\">\n          <div class=\"chatbot-chat-content\">\n            <div class=\"chatbot-messages\"></div>\n            <div class=\"chatbot-input-area\">\n              <input type=\"text\" placeholder=\"${this.config.inputPlaceholder}\" />\n              <button class=\"chatbot-send-button\">${this.config.sendButtonText}</button>\n            </div>\n          </div>\n          \n          <!-- Terms Overlay -->\n          <div class=\"chatbot-terms-overlay\">\n            <div class=\"chatbot-terms-content\">\n              <div class=\"chatbot-terms-title\">Terms & Conditions</div>\n              <div class=\"chatbot-terms-text\">\n                Before we start, and for your protection, please don't type any account or card numbers on the screen or any of your PINs. Please also note that we will be keeping a record of this conversation for service quality purposes. I am here to help you with general inquiries about the Bank, its products and services. If you need to access your bank accounts or cards,\n              </div>\n              <div class=\"chatbot-terms-text\">\n                Dear customer, in order to ensure the confidentiality of your data, please do not share the three numbers on the back of the credit or debit card, the OTP or the password for the smart wallet service or the Internet banking with anyone, whether by phone, text message or e-mail and in case that this data is requested by any means of communication, please contact 19666 as soon as possible.\n              </div>\n              <div class=\"chatbot-terms-buttons\">\n                <button class=\"chatbot-terms-accept\">I Agree</button>\n                <button class=\"chatbot-terms-decline\">Decline</button>\n              </div>\n            </div>\n          </div>\n        </div>\n        \n        <!-- Announcements Tab -->\n        <div class=\"chatbot-tab-content\" data-content=\"announcements\">\n          <div class=\"chatbot-announcements-content\">\n            <div class=\"chatbot-announcements-list\"></div>\n          </div>\n        </div>\n      </div>\n      \n      <div class=\"chatbot-footer\" style=\"\n        text-align: center;\n        padding: 10px;\n        font-size: 12px;\n        font-family: 'Segoe UI', sans-serif;\n        background: #fdfdfd;\n      \">\n        <div class=\"chatbot-tabs\">\n          <button class=\"chatbot-tab active\" data-tab=\"home\">Home</button>\n          <button class=\"chatbot-tab\" data-tab=\"chat\">Chat</button>\n          <button class=\"chatbot-tab\" data-tab=\"announcements\">News</button>\n        </div>\n        <span style=\"\n            background: linear-gradient(90deg, #4a90e2, #9013fe, #ff4081);\n            -webkit-background-clip: text;\n            -webkit-text-fill-color: transparent;\n            font-weight: bold;\n            font-style: italic;\n            font-size: 1.1em;\n            animation: shimmer 3s infinite;\n            background-size: 200% auto;\n            display:inline-block;\n        \">Powered by FinovaX ‚ú®</span>\n      </div>\n    `;\n\n    container.appendChild(windowEl);\n    this.elements.window = windowEl;\n    this.elements.messagesContainer = windowEl.querySelector('.chatbot-messages');\n    this.elements.inputField = windowEl.querySelector('.chatbot-input-area input');\n    this.elements.sendButton = windowEl.querySelector('.chatbot-input-area button');\n    this.elements.closeButton = windowEl.querySelector('.chatbot-header-close');\n    this.elements.headerTitle = windowEl.querySelector('.chatbot-header-title');\n    this.elements.homeContent = windowEl.querySelector('[data-content=\"home\"]');\n    this.elements.chatContent = windowEl.querySelector('[data-content=\"chat\"]');\n    this.elements.announcementsContent = windowEl.querySelector('[data-content=\"announcements\"]');\n    this.elements.termsOverlay = windowEl.querySelector('.chatbot-terms-overlay');\n    this.elements.userActions = windowEl.querySelector('.chatbot-user-actions');\n    this.elements.userNotifications = windowEl.querySelector('.chatbot-user-notifications');\n\n    // Event Listeners\n    this.setupEventListeners();\n\n    // Render messages and show\n    this.messages.forEach(msg => this.displayMessage(msg, false));\n    this.scrollToBottom();\n    this.showWidget();\n\n    // Start auto-refresh if configured\n    if (this.config.autoRefresh) {\n      this.startAutoRefresh(this.config.autoRefreshInterval || 300000);\n    }\n  }\n\n  setupEventListeners() {\n    // Close button\n    this.elements.closeButton.addEventListener('click', () => this.toggleChatWindow());\n    \n    // Send message\n    this.elements.sendButton.addEventListener('click', () => this.sendMessage());\n    this.elements.inputField.addEventListener('keypress', (e) => {\n      if (e.key === 'Enter') this.sendMessage();\n    });\n\n    // Tab navigation\n    const tabs = this.elements.window.querySelectorAll('.chatbot-tab');\n    tabs.forEach(tab => {\n      tab.addEventListener('click', () => {\n        const tabName = tab.dataset.tab;\n        this.switchTab(tabName);\n      });\n    });\n\n    // Home actions\n    const actionCards = this.elements.window.querySelectorAll('.chatbot-action-card');\n    actionCards.forEach(card => {\n      card.addEventListener('click', () => {\n        const action = card.dataset.action;\n        this.handleHomeAction(action);\n      });\n    });\n\n    // Terms acceptance\n    const termsAccept = this.elements.window.querySelector('.chatbot-terms-accept');\n    const termsDecline = this.elements.window.querySelector('.chatbot-terms-decline');\n    \n    termsAccept.addEventListener('click', () => {\n      this.termsAccepted = true;\n      this.elements.termsOverlay.style.display = 'none';\n    });\n    \n    termsDecline.addEventListener('click', () => {\n      this.switchTab('home');\n    });\n  }\n\n  switchTab(tabName) {\n    // Update active tab button\n    const tabs = this.elements.window.querySelectorAll('.chatbot-tab');\n    tabs.forEach(tab => {\n      tab.classList.toggle('active', tab.dataset.tab === tabName);\n    });\n\n    // Update active content\n    const contents = this.elements.window.querySelectorAll('.chatbot-tab-content');\n    contents.forEach(content => {\n      content.classList.toggle('active', content.dataset.content === tabName);\n    });\n\n    this.currentTab = tabName;\n\n    // Handle tab-specific actions\n    if (tabName === 'chat') {\n      if (!this.termsAccepted) {\n        this.elements.termsOverlay.style.display = 'flex';\n      }\n      // Always scroll to bottom when opening chat tab\n      setTimeout(() => {\n        this.scrollToBottom();\n      }, 100);\n    }\n\n\n    if (tabName === 'announcements' && this.announcements.length === 0) {\n      this.loadAnnouncements();\n    }\n  }\n\n  handleHomeAction(action) {\n    switch (action) {\n      case 'start-chat':\n        this.switchTab('chat');\n        break;\n      case 'check-products':\n        this.switchTab('chat');\n        if (this.termsAccepted) {\n          setTimeout(() => {\n            this.sendMessage('Show me your products', '/list_product_list');\n          }, 500);\n        }\n        break;\n      case 'contact-us':\n        this.switchTab('chat');\n        if (this.termsAccepted) {\n          setTimeout(() => {\n            this.sendMessage('I need to contact support', '/contact_support');\n          }, 500);\n        }\n        break;\n      case 'faq':\n        this.switchTab('chat');\n        if (this.termsAccepted) {\n          setTimeout(() => {\n            this.sendMessage('Show me frequently asked questions', '/show_faq');\n          }, 500);\n        }\n        break;\n    }\n  }\n\n  async loadUserNotifications() {\n    if (!authToken) return;\n\n    try {\n      const response = await fetch(this.config.startingUrl, {\n        method: 'GET',\n        headers: { \n          'Content-Type': 'application/json',\n          'authorization': `Bearer ${authToken}`\n        },\n      });\n\n      if (response.ok) {\n        const notifications = await response.json();\n        this.userNotifications = notifications;\n        \n        this.renderUserNotifications();\n      }\n    } catch (error) {\n      console.error('Failed to load user notifications:', error);\n    }\n  }\n\nrenderUserNotifications() {\n  if (!this.elements.userActions || !this.elements.userNotifications) return;\n\n  // Clear existing notifications\n  this.elements.userNotifications.innerHTML = '';\n  \n  // Flatten the notifications into a single array of actionable items\n  const actionableItems = [];\n  this.userNotifications.forEach(notification => {\n    // Add the main notification text as a standalone card if it exists\n    if (notification.text) {\n      actionableItems.push({\n        text: notification.text,\n        url: null // No action for the main text\n      });\n    }\n    // Add each button as a separate actionable item\n    if (notification.buttons) {\n      notification.buttons.forEach(btn => {\n        actionableItems.push({\n          text: btn.title,\n          url: btn.url,\n        });\n      });\n    }\n  });\n\n  if (actionableItems.length === 0) {\n    this.elements.userActions.style.display = 'none';\n    return;\n  }\n\n  this.elements.userActions.style.display = 'block';\n\n  actionableItems.forEach(item => {\n    const card = document.createElement('div');\n    card.className = 'chatbot-notification-card';\n    \n    // Add the notification text\n    const textDiv = document.createElement('div');\n    textDiv.className = 'chatbot-notification-text';\n    textDiv.textContent = item.text;\n    card.appendChild(textDiv);\n    \n    // Add a button if a URL is available\n    if (item.url) {\n      const actionButton = document.createElement('button');\n      actionButton.className = 'chatbot-notification-button';\n      actionButton.textContent = 'View Details'; // A generic, actionable text\n      actionButton.onclick = () => window.open(item.url, '_blank');\n      card.appendChild(actionButton);\n    }\n    \n    this.elements.userNotifications.appendChild(card);\n  });\n}\n\n  updateUIElements() {\n    if (this.elements.headerTitle) {\n      this.elements.headerTitle.textContent = this.config.botName;\n    }\n    \n    if (this.elements.inputField) {\n      this.elements.inputField.placeholder = this.config.inputPlaceholder;\n    }\n    \n    if (this.elements.sendButton) {\n      this.elements.sendButton.textContent = this.config.sendButtonText;\n    }\n  }\n\n  showWidget() {\n    console.log('Attempting to show widget...');\n\n    // Force visibility for debugging\n    this.elements.container.style.display = 'block';\n    this.elements.container.style.opacity = '1';\n    this.elements.container.style.zIndex = '99999';\n    \n    // Original animation code\n    const animation = this.config.style?.animation || { type: 'fade-in', duration: 300 };\n    console.log('Using animation:', animation);\n\n    this.elements.container.style.display = 'block';\n    \n    if (animation.type === 'fade-in') {\n      setTimeout(() => {\n        this.elements.container.style.opacity = '1';\n      }, 50);\n    } else if (animation.type === 'slide-up') {\n      this.elements.container.style.transform = 'translateY(20px)';\n      setTimeout(() => {\n        this.elements.container.style.transition = `all ${animation.duration}ms ease`;\n        this.elements.container.style.opacity = '1';\n        this.elements.container.style.transform = 'translateY(0)';\n      }, 50);\n    } else {\n      this.elements.container.style.opacity = '1';\n    }\n  }\n\n  // --- Auto Refresh ---\n  startAutoRefresh(interval = 300000) {\n    this.stopAutoRefresh();\n    this.refreshInterval = setInterval(() => this.refreshConfig(), interval);\n    this.log(`Started auto-refresh every ${interval/1000} seconds`);\n  }\n\n  stopAutoRefresh() {\n    if (this.refreshInterval) {\n      clearInterval(this.refreshInterval);\n      this.refreshInterval = null;\n    }\n  }\n\n  // --- Session Management ---\n  initSession() {\n    this.sessionId = getLocalStorageItem('chatbot_session_id');\n    if (!this.sessionId) {\n      this.sessionId = generateUniqueId();\n      setLocalStorageItem('chatbot_session_id', this.sessionId);\n    }\n    this.messages = getLocalStorageItem(`chatbot_conversation_${this.sessionId}`) || [];\n  }\n\n  // --- Message Handling ---\n  displayMessage(message, save = true) {\n    const messageElement = document.createElement('div');\n    messageElement.classList.add('chatbot-message', message.sender === 'user' ? 'user' : 'bot');\n\n    if (message.text) {\n      const textContent = document.createElement('div');\n      textContent.innerHTML = parseMarkdown(message.text);\n      messageElement.appendChild(textContent);\n    }\n\n    if (message.buttons?.length > 0) {\n      const buttonContainer = renderMessage(message, 'buttons', this.sendMessage.bind(this));\n      if (buttonContainer) messageElement.appendChild(buttonContainer);\n    }\n    \n    if (message.image) {\n      const imageEl = renderMessage(message, 'image');\n      if (imageEl) messageElement.appendChild(imageEl);\n    }\n    \n    if (message.video) {\n      const videoEl = renderMessage(message, 'video');\n      if (videoEl) messageElement.appendChild(videoEl);\n    }\n    \n    if (message.carousel?.length > 0) {\n      const carouselEl = renderMessage(message, 'carousel', this.sendMessage.bind(this));\n      if (carouselEl) messageElement.appendChild(carouselEl);\n    }\n    \n    if (message.custom) {\n      const customEl = renderCustomPayload(message.custom, this.sendMessage.bind(this));\n      if (customEl) messageElement.appendChild(customEl);\n    }\n\n    this.elements.messagesContainer.appendChild(messageElement);\n    \n    if (save) {\n      this.messages.push(message);\n      setLocalStorageItem(`chatbot_conversation_${this.sessionId}`, this.messages);\n    }\n    \n    this.scrollToBottom();\n  }\n\n  async sendSuggestions() {\n    try {\n      const response = await fetch(this.config.startingUrl, {\n        method: 'GET',\n        headers: { \n          'Content-Type': 'application/json',\n          'authorization': `Bearer ${authToken}`\n        },\n      });\n\n      if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);\n\n      const botResponses = await response.json();\n      if (botResponses?.length > 0) {\n        console.log(authToken+\" --- IGNORE ---\");\n        botResponses.forEach(response => this.displayMessage({ sender: 'bot', ...response }));\n      } else {\n        this.displayMessage({ sender: 'bot', text: \"Sorry, I didn't get a response.\" });\n      }\n    } catch (error) {\n      console.error('Chatbot error:', error);\n      this.displayMessage({ \n        sender: 'bot', \n        text: \"I'm having trouble connecting. Please try again later.\" \n      });\n    }\n  }\n\n  async sendMessage(text = null, payload = null) {\n    let messageText = text || this.elements.inputField.value.trim();\n    if (!messageText && !payload) return;\n\n    const userMessage = { sender: 'user', text: messageText };\n    this.displayMessage(userMessage);\n    this.elements.inputField.value = '';\n\n    const requestBody = {\n      sender: this.sessionId,\n      message: messageText,\n      ...(payload && { customData: { payload } })\n    };\n\n    try {\n      const response = await fetch(this.config.botUrl, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(requestBody),\n      });\n\n      if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);\n\n      const botResponses = await response.json();\n      if (botResponses?.length > 0) {\n        console.log(authToken+\" --- IGNORE ---\");\n        botResponses.forEach(response => this.displayMessage({ sender: 'bot', ...response }));\n      } else {\n        this.displayMessage({ sender: 'bot', text: \"Sorry, I didn't get a response.\" });\n      }\n    } catch (error) {\n      console.error('Chatbot error:', error);\n      this.displayMessage({ \n        sender: 'bot', \n        text: \"I'm having trouble connecting. Please try again later.\" \n      });\n    }\n  }\n\n  // --- UI Controls ---\n  toggleChatWindow() {\n    this.isOpen = !this.isOpen;\n    this.elements.window.classList.toggle('open', this.isOpen);\n    this.elements.bubble.classList.toggle('hidden', this.isOpen);\n    \n    if (this.isOpen) {\n      if (is_first_log_in && authToken) {\n        is_first_log_in = false;\n        this.sendSuggestions();\n      }\n\n      this.elements.inputField.focus();\n      this.scrollToBottom();\n    }\n  }\n\n  scrollToBottom() {\n    if (this.elements.messagesContainer) {\n      this.elements.messagesContainer.scrollTop = this.elements.messagesContainer.scrollHeight;\n    }\n  }\n}\n\n// Initialize\n\nwindow.ChatbotSDK = new ChatbotWidget();\nwindow.ChatbotSDK.init();\nwindow.ChatbotSDK.init();\nwindow.ChatbotSDK.init();\n\n(function() {\n  const chatbotContainer = document.getElementById('chatbotContainer');\n\n  // Public function to set the authentication token inside the SDK\n  window.setChatbotAuthToken = function(token) {\n    authToken = token;\n    console.log(\"Chatbot SDK received a token. Saved locally.\");\n    console.log(\"Simulated Chatbot Auth Token:\", authToken);\n    \n    // Reload user notifications if widget is open\n    if (window.ChatbotSDK && window.ChatbotSDK.isOpen && authToken && is_first_log_in) {\n        is_first_log_in = false;\n      window.ChatbotSDK.sendSuggestions();\n    }\n  };\n  \n  // Initial chatbot state when the page loads\n  console.log(\"Chatbot SDK loaded. Chatbot is running but currently unauthenticated.\");\n})();"],"names":["setLocalStorageItem","key","value","localStorage","setItem","JSON","stringify","e","console","warn","getLocalStorageItem","item","getItem","parse","css","ref","insertAt","document","head","getElementsByTagName","style","createElement","type","firstChild","insertBefore","appendChild","styleSheet","cssText","createTextNode","getChatbot","window","ChatbotSDK","config","applyStyles","element","component","elementType","messageStyles","chatbot","configStyles","components","styles","getDefaultStyles","messages","Object","entries","forEach","prop","startsWith","setProperty","globalStyles","defaults","backgroundColor","buttonColor","color","buttonTextColor","botBubbleColor","botTextColor","renderMessage","messageData","sendMessageCallback","createButtons","buttons","imageUrl","styleOverrides","img","src","className","createImage","image","videoUrl","video","controls","createVideo","carouselItems","length","container","card","image_url","cardImage","content","title","textContent","subtitle","buttonsContainer","button","button_style","createCarousel","carousel","renderCustomPayload","customPayload","customContainer","classList","add","locations","mapEl","locationContainer","location","mapUrl","lat","lng","staticMap","alt","name","map","body","address","href","target","createLocationsMap","faq_list","faqEl","faqs","faq","index","question","answer","innerHTML","addEventListener","toggle","contains","expandedAnswer","createFaqList","table","tableEl","tableData","headers","rows","thead","headerRow","headerText","th","header","tbody","rowData","tr","cellData","td","cell","createTable","rating","ratingEl","ratingData","scale","starsContainer","selectedRating","i","star","dataset","querySelectorAll","s","parseInt","themeColor","starHover","remove","starSelected","createRating","forms","formEl","formData","Array","isArray","fields","submit_payload","form","field","fieldDiv","label","htmlFor","field_name","inputElement","options","id","optionText","option","placeholder","required","inputBackground","inputTextColor","borderColor","inputBorderColor","input","submitButton","submit_button_text","preventDefault","formValues","querySelector","userMessageText","join","submitPayload","el","disabled","createDynamicForm","children","btn","button_color","payload","b","url","open","authToken","is_first_log_in","constructor","this","isOpen","sessionId","elements","refreshInterval","debug","currentTab","termsAccepted","announcements","userNotifications","log","args","initConfig","apiConfig","scriptTag","scriptConfig","configJson","getAttribute","error","botUrl","startingUrl","announcementsUrl","position","botName","inputPlaceholder","sendButtonText","init","loadConfig","initSession","readyState","createWidgetUI","setTimeout","loadAnnouncements","configApiUrl","response","fetch","Date","now","json","mergeConfigs","applyDynamicStyles","method","ok","sort","a","date","renderAnnouncements","announcementsContent","announcement","animationDelay","imageSection","text","description","formatDate","dateString","toLocaleDateString","year","month","day","refreshConfig","newConfig","updateUIElements","features","root","documentElement","adjustColor","textColor","bubble","userBubbleColor","amount","replace","colorHex","Math","min","max","toString","slice","display","opacity","computedStyle","getComputedStyle","zIndex","visibility","animation","duration","transition","bubbleStyle","width","size","height","icon","toggleChatWindow","windowEl","headerStyle","iconSize","messagesContainer","inputField","sendButton","closeButton","headerTitle","homeContent","chatContent","termsOverlay","userActions","setupEventListeners","msg","displayMessage","scrollToBottom","showWidget","autoRefresh","startAutoRefresh","autoRefreshInterval","sendMessage","tab","tabName","switchTab","action","handleHomeAction","termsAccept","termsDecline","loadUserNotifications","authorization","notifications","renderUserNotifications","actionableItems","notification","push","textDiv","actionButton","onclick","transform","interval","stopAutoRefresh","setInterval","clearInterval","c","r","random","message","save","messageElement","sender","html","parseMarkdown","buttonContainer","bind","imageEl","videoEl","carouselEl","custom","customEl","sendSuggestions","Error","status","botResponses","messageText","trim","userMessage","requestBody","customData","focus","scrollTop","scrollHeight","getElementById","setChatbotAuthToken","token"],"mappings":"yBAmBO,SAASA,EAAoBC,EAAKC,GACvC,IACEC,aAAaC,QAAQH,EAAKI,KAAKC,UAAUJ,GAC1C,CAAC,MAAOK,GACPC,QAAQC,KAAK,yCAA0CF,EACxD,CACH,CAOO,SAASG,EAAoBT,GAClC,IACE,MAAMU,EAAOR,aAAaS,QAAQX,GAClC,OAAOU,EAAON,KAAKQ,MAAMF,GAAQ,IAClC,CAAC,MAAOJ,GAEP,OADAC,QAAQC,KAAK,wCAAyCF,GAC/C,IACR,CACH,ECxCA,SAAqBO,EAAKC,QACX,IAARA,IAAiBA,EAAM,CAAA,GAC5B,IAAIC,EAAWD,EAAIC,SAEnB,GAAKF,GAA2B,oBAAbG,SAAnB,CAEA,IAAIC,EAAOD,SAASC,MAAQD,SAASE,qBAAqB,QAAQ,GAC9DC,EAAQH,SAASI,cAAc,SACnCD,EAAME,KAAO,WAEI,QAAbN,GACEE,EAAKK,WACPL,EAAKM,aAAaJ,EAAOF,EAAKK,YAKhCL,EAAKO,YAAYL,GAGfA,EAAMM,WACRN,EAAMM,WAAWC,QAAUb,EAE3BM,EAAMK,YAAYR,SAASW,eAAed,GAnBY,CAqB1D,21qBCpBA,MAAMe,EAAa,IAAMC,OAAOC,YAAc,CAAEC,OAAQ,CAAE,GAS1D,SAASC,EAAYC,EAASC,EAAWC,EAAaC,EAAgB,CAAA,GACpE,MAAMC,EAAUT,IAGVU,EAAeD,EAAQN,OAAOZ,OAAOoB,aAAaL,KAAaC,IAAgB,GAM/EK,EAAS,IACVC,EAAiBP,EAAWC,EAJZE,EAAQN,OAAOZ,OAAOuB,UAAY,CAAA,MAKlDJ,KACAF,GAILO,OAAOC,QAAQJ,GAAQK,QAAQ,EAAEC,EAAM7C,MACjCA,UAEE6C,EAAKC,WAAW,MAClBd,EAAQd,MAAM6B,YAAYF,EAAM7C,GAEhCgC,EAAQd,MAAM2B,GAAQ7C,IAI9B,CAKA,SAASwC,EAAiBP,EAAWC,EAAac,GAChD,MAAMC,EAAW,CAAA,EAEjB,OAAQhB,GACN,IAAK,UACiB,WAAhBC,IACFe,EAASC,gBAAkBF,EAAaG,YACxCF,EAASG,MAAQJ,EAAaK,iBAEhC,MACF,IAAK,WACiB,SAAhBnB,IACFe,EAASC,gBAAkBF,EAAaM,gBAEtB,cAAhBpB,GAA+C,iBAAhBA,IACjCe,EAASG,MAAQJ,EAAaO,cAEhC,MACF,IAAK,MACiB,aAAhBrB,IACFe,EAASG,MAAQJ,EAAaO,cAEhC,MACF,IAAK,SACiB,SAAhBrB,IACFe,EAASG,MAAQJ,EAAaG,aAKpC,OAAOF,CACT,CAKO,SAASO,EAAcC,EAAarC,EAAMsC,EAAsB,MACrE,OAAQtC,GACN,IAAK,UACH,OAAOuC,EAAcF,EAAYG,QAASF,EAAqBD,EAAYvC,OAC7E,IAAK,QACH,OAwFN,SAAqB2C,EAAUC,EAAiB,IAC9C,IAAKD,EAAU,OAAO,KAEtB,MAAME,EAAMhD,SAASI,cAAc,OAKnC,OAJA4C,EAAIC,IAAMH,EACVE,EAAIE,UAAY,gBAChBlC,EAAYgC,EAAK,QAAS,QAASD,GAE5BC,CACT,CAjGaG,CAAYT,EAAYU,MAAOV,EAAYvC,OACpD,IAAK,QACH,OAiGN,SAAqBkD,EAAUN,EAAiB,IAC9C,IAAKM,EAAU,OAAO,KAEtB,MAAMC,EAAQtD,SAASI,cAAc,SAMrC,OALAkD,EAAML,IAAMI,EACZC,EAAMC,UAAW,EACjBD,EAAMJ,UAAY,gBAClBlC,EAAYsC,EAAO,QAAS,QAASP,GAE9BO,CACT,CA3GaE,CAAYd,EAAYY,MAAOZ,EAAYvC,OACpD,IAAK,WACH,OA2GN,SAAwBsD,EAAed,EAAqBI,EAAiB,CAAA,GAC3E,IAAKU,GAA0C,IAAzBA,EAAcC,OAAc,OAAO,KAEzD,MAAMC,EAAY3D,SAASI,cAAc,OAiDzC,OAhDAuD,EAAUT,UAAY,6BACtBlC,EAAY2C,EAAW,WAAY,YAAaZ,EAAeY,WAE/DF,EAAc5B,QAAQnC,IACpB,MAAMkE,EAAO5D,SAASI,cAAc,OAIpC,GAHAwD,EAAKV,UAAY,wBACjBlC,EAAY4C,EAAM,WAAY,OAAQb,EAAea,MAEjDlE,EAAKmE,UAAW,CAClB,MAAMb,EAAMhD,SAASI,cAAc,OACnC4C,EAAIC,IAAMvD,EAAKmE,UACfb,EAAIE,UAAY,8BAChBlC,EAAYgC,EAAK,WAAY,YAAaD,EAAee,WACzDF,EAAKpD,YAAYwC,EAClB,CAED,MAAMe,EAAU/D,SAASI,cAAc,OACvC2D,EAAQb,UAAY,gCACpBlC,EAAY+C,EAAS,WAAY,cAAehB,EAAegB,SAE/D,MAAMC,EAAQhE,SAASI,cAAc,MAMrC,GALA4D,EAAMd,UAAY,8BAClBc,EAAMC,YAAcvE,EAAKsE,MACzBhD,EAAYgD,EAAO,WAAY,YAAajB,EAAeiB,OAC3DD,EAAQvD,YAAYwD,GAEhBtE,EAAKwE,SAAU,CACjB,MAAMA,EAAWlE,SAASI,cAAc,KACxC8D,EAAShB,UAAY,iCACrBgB,EAASD,YAAcvE,EAAKwE,SAC5BlD,EAAYkD,EAAU,WAAY,eAAgBnB,EAAemB,UACjEH,EAAQvD,YAAY0D,EACrB,CAED,GAAIxE,EAAKmD,SAASa,OAAS,EAAG,CAC5B,MAAMS,EAAmBvB,EAAclD,EAAKmD,QAASF,EAAqB,IACrEI,EACHqB,OAAQ,IACF1E,EAAK2E,cAAgB,MAGzBF,GAAkBJ,EAAQvD,YAAY2D,EAC3C,CAEDP,EAAKpD,YAAYuD,GACjBJ,EAAUnD,YAAYoD,KAGjBD,CACT,CAhKaW,CAAe5B,EAAY6B,SAAU5B,EAAqBD,EAAYvC,OAC/E,QACE,OAAO,KAEb,CAKO,SAASqE,EAAoBC,EAAe9B,EAAsB,MACrE,IAAK8B,EAAe,OAAO,KAE3B,MAAMC,EAAkB1E,SAASI,cAAc,OAI/C,GAHAsE,EAAgBC,UAAUC,IAAI,0BAC9B5D,EAAY0D,EAAiB,SAAU,YAAaD,EAActE,OAE9DsE,EAAcI,UAAW,CACzB,MAAMC,EAiJd,SAA4BD,EAAW9B,EAAiB,IACtD,IAAK8B,GAAkC,IAArBA,EAAUnB,OAAc,OAAO,KAEjD,MAAMqB,EAAoB/E,SAASI,cAAc,OA0DjD,OAzDA2E,EAAkB7B,UAAY,yBAC9BlC,EAAY+D,EAAmB,YAAa,YAAahC,EAAeY,WAExEkB,EAAUhD,QAAQmD,IAChB,MAAMC,EAAS,iCAAiCD,EAASE,OAAOF,EAASG,MACnEC,EAAY,yDAAyDJ,EAASE,OAAOF,EAASG,gDAAgDH,EAASE,OAAOF,EAASG,kDAEvKvB,EAAO5D,SAASI,cAAc,OACpCwD,EAAKV,UAAY,wBACjBlC,EAAY4C,EAAM,YAAa,OAAQb,EAAea,MAGtD,MAAMZ,EAAMhD,SAASI,cAAc,OACnC4C,EAAIC,IAAMmC,EACVpC,EAAIqC,IAAM,GAAGL,EAASM,WACtBtC,EAAIE,UAAY,uBAChBlC,EAAYgC,EAAK,YAAa,MAAOD,EAAewC,KACpD3B,EAAKpD,YAAYwC,GAGjB,MAAMwC,EAAOxF,SAASI,cAAc,OACpCoF,EAAKtC,UAAY,wBACjBlC,EAAYwE,EAAM,YAAa,OAAQzC,EAAeyC,MAGtD,MAAMxB,EAAQhE,SAASI,cAAc,OAOrC,GANA4D,EAAMd,UAAY,yBAClBc,EAAMC,YAAce,EAASM,KAC7BtE,EAAYgD,EAAO,YAAa,QAASjB,EAAeiB,OACxDwB,EAAKhF,YAAYwD,GAGbgB,EAASS,QAAS,CACpB,MAAMA,EAAUzF,SAASI,cAAc,OACvCqF,EAAQvC,UAAY,2BACpBuC,EAAQxB,YAAce,EAASS,QAC/BzE,EAAYyE,EAAS,YAAa,UAAW1C,EAAe0C,SAC5DD,EAAKhF,YAAYiF,EAClB,CAGD,MAAMrB,EAASpE,SAASI,cAAc,KACtCgE,EAAOsB,KAAOT,EACdb,EAAOuB,OAAS,SAChBvB,EAAOlB,UAAY,0BACnBkB,EAAOH,YAAc,cACrBjD,EAAYoD,EAAQ,YAAa,SAAU,CACzCjC,gBAAiBvB,IAAaG,OAAOZ,OAAOuB,UAAUU,YACtDC,MAAOzB,IAAaG,OAAOZ,OAAOuB,UAAUY,mBACzCS,EAAeqB,SAEpBoB,EAAKhF,YAAY4D,GAEjBR,EAAKpD,YAAYgF,GACjBT,EAAkBvE,YAAYoD,KAGzBmB,CACT,CA/MsBa,CAAmBnB,EAAcI,UAAWJ,EAActE,OACpE2E,GAAOJ,EAAgBlE,YAAYsE,EAC1C,CACD,GAAIL,EAAcoB,SAAU,CACxB,MAAMC,EA6Md,SAAuBC,EAAMhD,EAAiB,IAC1C,IAAKgD,GAAwB,IAAhBA,EAAKrC,OAAc,OAAO,KAEvC,MAAMC,EAAY3D,SAASI,cAAc,OAiCzC,OAhCAuD,EAAUT,UAAY,6BACtBlC,EAAY2C,EAAW,MAAO,YAAaZ,EAAeY,WAE1DoC,EAAKlE,QAAQ,CAACmE,EAAKC,KACf,MAAMvG,EAAOM,SAASI,cAAc,OACpCV,EAAKwD,UAAY,mBACjBlC,EAAYtB,EAAM,MAAO,OAAQqD,EAAerD,MAEhD,MAAMwG,EAAWlG,SAASI,cAAc,OACxC8F,EAAShD,UAAY,uBACrBgD,EAASjC,YAAc+B,EAAIE,SAC3BlF,EAAYkF,EAAU,MAAO,WAAYnD,EAAemD,UACxDxG,EAAKc,YAAY0F,GAEjB,MAAMC,EAASnG,SAASI,cAAc,OACtC+F,EAAOjD,UAAY,qBACnBiD,EAAOC,UAAYJ,EAAIG,OACvBnF,EAAYmF,EAAQ,MAAO,SAAUpD,EAAeoD,QACpDzG,EAAKc,YAAY2F,GAEjBD,EAASG,iBAAiB,QAAS,KAC/B3G,EAAKiF,UAAU2B,OAAO,YAClB5G,EAAKiF,UAAU4B,SAAS,YACxBvF,EAAYmF,EAAQ,MAAO,iBAAkBpD,EAAeyD,gBAE5DxF,EAAYmF,EAAQ,MAAO,SAAUpD,EAAeoD,UAI5DxC,EAAUnD,YAAYd,KAGnBiE,CACX,CAlPsB8C,CAAchC,EAAcoB,SAAUpB,EAActE,OAC9D2F,GAAOpB,EAAgBlE,YAAYsF,EAC1C,CACD,GAAIrB,EAAciC,MAAO,CACrB,MAAMC,EAgPd,SAAqBC,EAAW7D,EAAiB,IAC7C,IAAK6D,IAAcA,EAAUC,UAAYD,EAAUE,KAAM,OAAO,KAEhE,MAAMnD,EAAY3D,SAASI,cAAc,OACzCuD,EAAUT,UAAY,0BACtBlC,EAAY2C,EAAW,QAAS,YAAaZ,EAAeY,WAE5D,MAAM+C,EAAQ1G,SAASI,cAAc,SACrCsG,EAAMxD,UAAY,gBAClBlC,EAAY0F,EAAO,QAAS,QAAS3D,EAAe2D,OAEpD,MAAMK,EAAQ/G,SAASI,cAAc,SAC/B4G,EAAYhH,SAASI,cAAc,MACzCwG,EAAUC,QAAQhF,QAAQoF,IACtB,MAAMC,EAAKlH,SAASI,cAAc,MAClC8G,EAAGjD,YAAcgD,EACjBjG,EAAYkG,EAAI,QAAS,SAAU,CACjC/E,gBAAiBvB,IAAaG,OAAOZ,OAAOuB,UAAUU,YACtDC,MAAOzB,IAAaG,OAAOZ,OAAOuB,UAAUY,mBACzCS,EAAeoE,SAEpBH,EAAUxG,YAAY0G,KAE1BH,EAAMvG,YAAYwG,GAClBN,EAAMlG,YAAYuG,GAElB,MAAMK,EAAQpH,SAASI,cAAc,SAcrC,OAbAwG,EAAUE,KAAKjF,QAAQwF,IACnB,MAAMC,EAAKtH,SAASI,cAAc,MAClCiH,EAAQxF,QAAQ0F,IACZ,MAAMC,EAAKxH,SAASI,cAAc,MAClCoH,EAAGvD,YAAcsD,EACjBvG,EAAYwG,EAAI,QAAS,OAAQzE,EAAe0E,MAChDH,EAAG9G,YAAYgH,KAEnBJ,EAAM5G,YAAY8G,KAEtBZ,EAAMlG,YAAY4G,GAElBzD,EAAUnD,YAAYkG,GACf/C,CACX,CAzRwB+D,CAAYjD,EAAciC,MAAOjC,EAActE,OAC3DwG,GAASjC,EAAgBlE,YAAYmG,EAC5C,CACD,GAAIlC,EAAckD,OAAQ,CACtB,MAAMC,EAuRd,SAAsBC,EAAYlF,EAAqBI,EAAiB,CAAA,GACpE,IAAK8E,IAAeA,EAAWC,MAAO,OAAO,KAE7C,MAAMnE,EAAY3D,SAASI,cAAc,OACzCuD,EAAUT,UAAY,2BACtBlC,EAAY2C,EAAW,SAAU,YAAaZ,EAAeY,WAE7D,MAAMK,EAAQhE,SAASI,cAAc,OACrC4D,EAAMd,UAAY,uBAClBc,EAAMC,YAAc4D,EAAW7D,OAAS,eACxChD,EAAYgD,EAAO,SAAU,QAASjB,EAAeiB,OACrDL,EAAUnD,YAAYwD,GAEtB,MAAM+D,EAAiB/H,SAASI,cAAc,OAC9C2H,EAAe7E,UAAY,gBAC3BlC,EAAY+G,EAAgB,SAAU,iBAAkBhF,EAAegF,gBACvE,IAAIC,EAAiB,EAErB,IAAK,IAAIC,EAAIJ,EAAWC,MAAOG,GAAK,EAAGA,IAAK,CACxC,MAAMC,EAAOlI,SAASI,cAAc,QACpC8H,EAAK9B,UAAY,UACjB8B,EAAKC,QAAQlJ,MAAQgJ,EACrBjH,EAAYkH,EAAM,SAAU,OAAQ,CAClC7F,MAAOzB,IAAaG,OAAOZ,OAAOuB,UAAUU,eACzCW,EAAemF,OAGpBA,EAAK7B,iBAAiB,YAAa,KAC/B0B,EAAeK,iBAAiB,QAAQvG,QAAQwG,IACxCC,SAASD,EAAEF,QAAQlJ,QAAUgJ,IAC7BI,EAAE1D,UAAUC,IAAI,SAChB5D,EAAYqH,EAAG,SAAU,YAAa,CACpChG,MAAOzB,IAAaG,OAAOZ,OAAOoI,cAC/BxF,EAAeyF,iBAMhCN,EAAK7B,iBAAiB,WAAY,KAC9B0B,EAAeK,iBAAiB,QAAQvG,QAAQwG,IAC5CA,EAAE1D,UAAU8D,OAAO,SACnBzH,EAAYqH,EAAG,SAAU,OAAQ,CAC/BhG,MAAOzB,IAAaG,OAAOZ,OAAOuB,UAAUU,eACzCW,EAAemF,WAK5BA,EAAK7B,iBAAiB,QAAS,KAC3B2B,EAAiBC,EACjBF,EAAeK,iBAAiB,QAAQvG,QAAQwG,IACxCC,SAASD,EAAEF,QAAQlJ,QAAU+I,GAC7BK,EAAE1D,UAAUC,IAAI,YAChB5D,EAAYqH,EAAG,SAAU,eAAgB,CACvChG,MAAOzB,IAAaG,OAAOZ,OAAOoI,cAC/BxF,EAAe2F,iBAGpBL,EAAE1D,UAAU8D,OAAO,YACnBzH,EAAYqH,EAAG,SAAU,OAAQ,CAC/BhG,MAAOzB,IAAaG,OAAOZ,OAAOuB,UAAUU,eACzCW,EAAemF,UAIxBvF,GACAA,EAAoB,SAASqF,UAAwB,0BAA0BA,QAGvFD,EAAevH,YAAY0H,EAC9B,CAED,OADAvE,EAAUnD,YAAYuH,GACfpE,CACX,CAjWyBgF,CAAalE,EAAckD,OAAQhF,EAAqB8B,EAActE,OACnFyH,GAAUlD,EAAgBlE,YAAYoH,EAC7C,CACD,GAAInD,EAAcmE,MAAO,CACrB,MAAMC,EA+Vd,SAA2BC,EAAUnG,EAAqBI,EAAiB,CAAA,GACzE,IAAK+F,IAAaC,MAAMC,QAAQF,EAASG,SAAsC,IAA3BH,EAASG,OAAOvF,SAAiBoF,EAASI,eAAgB,OAAO,KAErH,MAAMvF,EAAY3D,SAASI,cAAc,OAIzC,GAHAuD,EAAUT,UAAY,yBACtBlC,EAAY2C,EAAW,OAAQ,YAAaZ,EAAeY,WAEvDmF,EAAS9E,MAAO,CAClB,MAAMA,EAAQhE,SAASI,cAAc,OACrC4D,EAAMd,UAAY,qBAClBc,EAAMC,YAAc6E,EAAS9E,MAC7BhD,EAAYgD,EAAO,OAAQ,QAASjB,EAAeiB,OACnDL,EAAUnD,YAAYwD,EACvB,CAED,MAAMmF,EAAOnJ,SAASI,cAAc,QACpC+I,EAAKjG,UAAY,eACjBlC,EAAYmI,EAAM,OAAQ,OAAQpG,EAAeoG,MAEjDL,EAASG,OAAOpH,QAAQuH,IACtB,MAAMC,EAAWrJ,SAASI,cAAc,OAIxC,GAHAiJ,EAASnG,UAAY,qBACrBlC,EAAYqI,EAAU,OAAQ,QAAStG,EAAeqG,OAElDA,EAAME,MAAO,CACf,MAAMA,EAAQtJ,SAASI,cAAc,SACrCkJ,EAAMrF,YAAcmF,EAAME,MAC1BA,EAAMC,QAAU,gBAAgBH,EAAMI,aACtCxI,EAAYsI,EAAO,OAAQ,QAASvG,EAAeuG,OACnDD,EAAS7I,YAAY8I,EACtB,CAED,IAAIG,EACe,WAAfL,EAAM/I,MAAqB0I,MAAMC,QAAQI,EAAMM,UACjDD,EAAezJ,SAASI,cAAc,UACtCqJ,EAAanE,KAAO8D,EAAMI,WAC1BC,EAAaE,GAAK,gBAAgBP,EAAMI,aACxCJ,EAAMM,QAAQ7H,QAAQ+H,IACpB,MAAMC,EAAS7J,SAASI,cAAc,UACtCyJ,EAAO5K,MAAQ2K,EACfC,EAAO5F,YAAc2F,EACrBH,EAAajJ,YAAYqJ,MAEH,aAAfT,EAAM/I,MACfoJ,EAAezJ,SAASI,cAAc,YACtCqJ,EAAanE,KAAO8D,EAAMI,WAC1BC,EAAaE,GAAK,gBAAgBP,EAAMI,aACxCC,EAAaK,YAAcV,EAAMU,aAAe,GAChDL,EAAaM,WAAaX,EAAMW,WAEhCN,EAAezJ,SAASI,cAAc,SACtCqJ,EAAapJ,KAAO+I,EAAM/I,MAAQ,OAClCoJ,EAAanE,KAAO8D,EAAMI,WAC1BC,EAAaE,GAAK,gBAAgBP,EAAMI,aACxCC,EAAaK,YAAcV,EAAMU,aAAe,GAChDL,EAAaM,WAAaX,EAAMW,UAGlC/I,EAAYyI,EAAc,OAAQ,QAAS,CACzCtH,gBAAiBvB,IAAaG,OAAOZ,OAAOuB,UAAUsI,gBACtD3H,MAAOzB,IAAaG,OAAOZ,OAAOuB,UAAUuI,eAC5CC,YAAatJ,IAAaG,OAAOZ,OAAOuB,UAAUyI,oBAC/CpH,EAAeqH,QAGpBf,EAAS7I,YAAYiJ,GACrBN,EAAK3I,YAAY6I,KAGnB,MAAMgB,EAAerK,SAASI,cAAc,UA4B5C,OA3BAiK,EAAahK,KAAO,SACpBgK,EAAanH,UAAY,6BACzBmH,EAAapG,YAAc6E,EAASwB,oBAAsB,SAC1DtJ,EAAYqJ,EAAc,OAAQ,eAAgB,CAChDlI,gBAAiBvB,IAAaG,OAAOZ,OAAOuB,UAAUU,YACtDC,MAAOzB,IAAaG,OAAOZ,OAAOuB,UAAUY,mBACzCS,EAAesH,eAEpBlB,EAAK3I,YAAY6J,GAEjBlB,EAAK9C,iBAAiB,SAAW/G,IAC/BA,EAAEiL,iBACF,MAAMC,EAAa,CAAA,EAMnB,GALA1B,EAASG,OAAOpH,QAAQuH,IACtB,MAAMgB,EAAQjB,EAAKsB,cAAc,UAAUrB,EAAMI,gBAC7CY,IAAOI,EAAWpB,EAAMI,YAAcY,EAAMnL,SAG9C0D,EAAqB,CACvB,MAAM+H,EAAkB,mBAAmB/I,OAAOC,QAAQ4I,GAAYjF,IAAI,EAAEvG,EAAKC,KAAW,GAAGD,MAAQC,KAAS0L,KAAK,QAC/GC,EAAgB,GAAG9B,EAASI,iBAAiB9J,KAAKC,UAAUmL,KAClE7H,EAAoB+H,EAAiBE,EACtC,CACDzB,EAAKf,iBAAiB,mCAAmCvG,QAAQgJ,GAAMA,EAAGC,UAAW,KAGvFnH,EAAUnD,YAAY2I,GACfxF,CACT,CAjcuBoH,CAAkBtG,EAAcmE,MAAOjG,EAAqB8B,EAActE,OACrF0I,GAAQnE,EAAgBlE,YAAYqI,EAC3C,CAED,OAAOnE,EAAgBsG,SAAStH,OAAS,EAAIgB,EAAkB,IACnE,CAIA,SAAS9B,EAAcC,EAASF,EAAqBI,EAAiB,CAAA,GACpE,IAAKF,GAA8B,IAAnBA,EAAQa,OAAc,OAAO,KAE7C,MAAMC,EAAY3D,SAASI,cAAc,OAoCzC,OAnCAuD,EAAUT,UAAY,2BACtBlC,EAAY2C,EAAW,UAAW,YAAaZ,EAAeY,WAE9Dd,EAAQhB,QAAQoJ,IACd,MAAM7G,EAASpE,SAASI,cAAc,UACtCgE,EAAOH,YAAcgH,EAAIjH,MACzBI,EAAOlB,UAAY,iBAGnBlC,EAAYoD,EAAQ,UAAW,SAAU,IAEnC6G,EAAIC,cAAgB,CAAE/I,gBAAiB8I,EAAIC,iBAC3CD,EAAIC,cAAgB,CAAE7I,MAAO,YAC7B4I,EAAIC,cAAgB,CAAEhB,YAAae,EAAIC,iBAExCnI,EAAeqB,SAGhB6G,EAAIE,QACN/G,EAAOiC,iBAAiB,QAAS,KAC/B1C,EAAUyE,iBAAiB,UAAUvG,QAAQuJ,GAAKA,EAAEN,UAAW,GAC3DnI,GAAqBA,EAAoBsI,EAAIjH,MAAOiH,EAAIE,WAErDF,EAAII,IACbjH,EAAOiC,iBAAiB,QAAS,IAAMxF,OAAOyK,KAAKL,EAAII,IAAK,WACnDJ,EAAI/E,UACb9B,EAAOiC,iBAAiB,QAAS,KAC/B1C,EAAUyE,iBAAiB,UAAUvG,QAAQuJ,GAAKA,EAAEN,UAAW,GAC3DnI,GAAqBA,EAAoBsI,EAAIjH,MAAOiH,EAAI/E,YAIhEvC,EAAUnD,YAAY4D,KAGjBT,CACT,CCxKA,IAAI4H,EAAY,KACZC,GAAkB,EA+0BtB3K,OAAOC,WAAa,IA70BpB,MACE,WAAA2K,GACEC,KAAK3K,OAAS,GACd2K,KAAKC,QAAS,EACdD,KAAKE,UAAY,KACjBF,KAAKhK,SAAW,GAChBgK,KAAKG,SAAW,GAChBH,KAAKI,gBAAkB,KACvBJ,KAAKK,OAAQ,EACbL,KAAKM,WAAa,OAClBN,KAAKO,eAAgB,EACrBP,KAAKQ,cAAgB,GACrBR,KAAKS,kBAAoB,EAC1B,CAED,GAAAC,IAAOC,GACDX,KAAKK,OAAOxM,QAAQ6M,IAAI,eAAgBC,EAC7C,CAGD,UAAAC,CAAWC,EAAY,IACrB,MAAMC,EAAYxM,SAASyK,cAAc,oCACzC,IAAIgC,EAAe,CAAA,EAEnB,GAAID,EAAW,CACb,MAAME,EAAaF,EAAUG,aAAa,kBAC1C,GAAID,EACF,IACED,EAAerN,KAAKQ,MAAM8M,EAC3B,CAAC,MAAOpN,GACPC,QAAQqN,MAAM,wDAAyDtN,EACxE,CAEJ,CAEDoM,KAAK3K,OAAS,IACT0L,KACAF,GAILb,KAAK3K,OAAO8L,OAASnB,KAAK3K,OAAO8L,QAAU,0CAC3CnB,KAAK3K,OAAO+L,YAAc,2CAC1BpB,KAAK3K,OAAOgM,iBAAmB,0CAC/BrB,KAAK3K,OAAOwH,WAAamD,KAAK3K,OAAOwH,YAAc,YAEnDmD,KAAK3K,OAAOiM,SAAWtB,KAAK3K,OAAOiM,UAAY,eAC/CtB,KAAK3K,OAAOkM,QAAUvB,KAAK3K,OAAOkM,SAAW,UAC7C1N,QAAQ6M,IAAI,WAAYV,KAAK3K,OAAOkM,SACpCvB,KAAK3K,OAAOmM,iBAAmBxB,KAAK3K,OAAOmM,kBAAoB,uBAC/DxB,KAAK3K,OAAOoM,eAAiBzB,KAAK3K,OAAOoM,gBAAkB,MAC5D,CAED,UAAMC,GACJ1B,KAAKY,mBACCZ,KAAK2B,aACX3B,KAAK4B,cAEuB,aAAxBtN,SAASuN,YAAqD,gBAAxBvN,SAASuN,WACjD7B,KAAK8B,iBAELxN,SAASqG,iBAAiB,mBAAoB,KAC5C9G,QAAQ6M,IAAI,iCACZV,KAAK8B,mBAKTC,WAAW,KACJ/B,KAAKG,SAASlI,YACjBpE,QAAQC,KAAK,wBACbkM,KAAK8B,mBAEN,KAGHjO,QAAQ6M,IAAI,kCACNV,KAAKgC,mBACZ,CAED,gBAAML,GACJ,GAAI3B,KAAK3K,OAAO4M,aACd,IACEjC,KAAKU,IAAI,mCACT,MAAMwB,QAAiBC,MAAM,GAAGnC,KAAK3K,OAAO4M,kBAAkBG,KAAKC,SAC7DxB,QAAkBqB,EAASI,OACjCtC,KAAKuC,aAAa1B,GAClBb,KAAKwC,oBACN,CAAC,MAAOtB,GACPlB,KAAKU,IAAI,8BAA+BQ,EACzC,CAEJ,CAGD,uBAAMc,GACJ,IACE,MAAME,QAAiBC,MAAMnC,KAAK3K,OAAOgM,iBAAkB,CACzDoB,OAAQ,MACRtH,QAAS,CAAE,eAAgB,sBAG7B,GAAI+G,EAASQ,GAAI,CACf,MAAMlC,QAAsB0B,EAASI,OACrCtC,KAAKQ,cAAgBA,EAAcmC,KAAK,CAACC,EAAGlD,IAAM,IAAI0C,KAAK1C,EAAEmD,MAAQ,IAAIT,KAAKQ,EAAEC,OAChF7C,KAAK8C,qBACN,CACF,CAAC,MAAO5B,GACPrN,QAAQqN,MAAM,gCAAiCA,EAChD,CACF,CAED,mBAAA4B,GACA,MAAMC,EAAuB/C,KAAKG,SAAS4C,qBAC3C,IAAKA,EAAsB,OAE3B,MAAM9K,EAAY8K,EAAqBhE,cAAc,+BAChD9G,IAELA,EAAUyC,UAAY,GAEtBzC,EAAUgB,UAAUC,IAAI,qBAEU,IAA9B8G,KAAKQ,cAAcxI,OAUvBgI,KAAKQ,cAAcrK,QAAQ,CAAC6M,EAAczI,KACxC,MAAMrC,EAAO5D,SAASI,cAAc,OACpCwD,EAAKV,UAAY,4BACjBU,EAAKzD,MAAMwO,eAA4B,GAAR1I,EAAH,IAE5B,MAAM2I,EAAeF,EAAatL,MAC9B,yEAAyEsL,EAAatL,kBACtF,qFAEJQ,EAAKwC,UAAY,iBAEbwI,wGAE0CF,EAAaG,MAAQ,+EACfH,EAAaI,aAAe,4DACnCpD,KAAKqD,WAAWL,EAAaH,kCAI1E5K,EAAUnD,YAAYoD,KA5BtBD,EAAUyC,UAAY,kMA8B1B,CACE,UAAA2I,CAAWC,GACT,IAAKA,EAAY,MAAO,GACxB,IAEE,OADa,IAAIlB,KAAKkB,GACVC,mBAAmB,QAAS,CACtCC,KAAM,UACNC,MAAO,QACPC,IAAK,WAER,CAAC,MAAOxC,GACP,OAAOoC,CACR,CACF,CAGD,mBAAMK,GACJ,IACE3D,KAAKU,IAAI,+BACT,MAAMwB,QAAiBC,MAAM,GAAGnC,KAAK3K,OAAO4M,kBAAkBG,KAAKC,SAC7DuB,QAAkB1B,EAASI,OAKjC,OAJAtC,KAAKuC,aAAaqB,GAClB5D,KAAKwC,qBACLxC,KAAK6D,mBACL7D,KAAKU,IAAI,yCACF,CACR,CAAC,MAAOQ,GAEP,OADAlB,KAAKU,IAAI,4BAA6BQ,IAC/B,CACR,CACF,CAED,YAAAqB,CAAaqB,GACX5D,KAAK3K,OAAS,IACT2K,KAAK3K,UACLuO,EACHnP,MAAO,IACDuL,KAAK3K,OAAOZ,OAAS,MACrBmP,EAAUnP,OAAS,IAEzBqP,SAAU,IACJ9D,KAAK3K,OAAOyO,UAAY,MACxBF,EAAUE,UAAY,KAG9B9D,KAAKU,IAAI,iBAAkBV,KAAK3K,OACjC,CAED,kBAAAmN,GACE,IAAKxC,KAAK3K,OAAOZ,MAEf,YADAuL,KAAKU,IAAI,gCAIX,MAAMqD,EAAOzP,SAAS0P,iBAChBvP,MAAEA,GAAUuL,KAAK3K,OAEnBZ,EAAMoI,aACVhJ,QAAQ6M,IAAI,wBAAyBjM,EAAMoI,YACzCkH,EAAKtP,MAAM6B,YAAY,wBAAyB7B,EAAMoI,YACtDkH,EAAKtP,MAAM6B,YAAY,8BAA+B0J,KAAKiE,YAAYxP,EAAMoI,YAAa,MAGxFpI,EAAMgH,QAAQhF,kBACd5C,QAAQ6M,IAAI,wBAAyBjM,EAAMgC,iBAC7CsN,EAAKtP,MAAM6B,YAAY,sBAAuB7B,EAAMgH,OAAOhF,kBAGzDhC,EAAMgH,QAAQyI,WAChBH,EAAKtP,MAAM6B,YAAY,wBAAyB7B,EAAMgH,OAAOyI,WAG3DzP,EAAM0P,QAAQxN,OAChBoN,EAAKtP,MAAM6B,YAAY,yBAA0B7B,EAAM0P,OAAOxN,OAG5DlC,EAAMuB,UAAUoO,iBAClBL,EAAKtP,MAAM6B,YAAY,wBAAyB7B,EAAMuB,SAASoO,iBAG7D3P,EAAMuB,UAAUa,gBAClBkN,EAAKtP,MAAM6B,YAAY,uBAAwB7B,EAAMuB,SAASa,eAEjE,CAED,WAAAoN,CAAYtN,EAAO0N,GACjB,MAAO,IAAM1N,EAAM2N,QAAQ,KAAM,IAAIA,QAAQ,MAAOC,IACjD,IAAMC,KAAKC,IAAI,IAAKD,KAAKE,IAAI,EAAG9H,SAAS2H,EAAU,IAAMF,IAASM,SAAS,KAAKC,OAAO,GAC3F,CAGD,cAAA9C,GACEjO,QAAQ6M,IAAI,yBACZ7M,QAAQ6M,IAAI,UAAWV,KAAK3K,QAE5B,MAAM4C,EAAY3D,SAASI,cAAc,OACzCuD,EAAUgG,GAAK,2BACfpK,QAAQ6M,IAAI,qBAAsBzI,GAElCA,EAAUgB,UAAUC,IAAI,oBAAoB8G,KAAK3K,OAAOiM,YACxDrJ,EAAUxD,MAAMoQ,QAAU,OAC1B5M,EAAUxD,MAAMqQ,QAAU,IAE1BxQ,SAASwF,KAAKhF,YAAYmD,GAC1B+H,KAAKG,SAASlI,UAAYA,EAE1B8J,WAAW,KACT,MAAMgD,EAAgB5P,OAAO6P,iBAAiBhF,KAAKG,SAASlI,WAC5DpE,QAAQ6M,IAAI,mBAAoB,CAC9BmE,QAASE,EAAcF,QACvBC,QAASC,EAAcD,QACvBG,OAAQF,EAAcE,OACtBC,WAAYH,EAAcG,cAE3B,KAGH,MAAMC,EAAYnF,KAAK3K,OAAOZ,OAAO0Q,WAAa,CAAExQ,KAAM,UAAWyQ,SAAU,KAC3ED,EAAUxQ,OACZsD,EAAUxD,MAAM4Q,WAAa,OAAOF,EAAUC,mBAIhD,MAAMjB,EAAS7P,SAASI,cAAc,OACtCyP,EAAO3M,UAAY,iBAEnB,MAAM8N,EAActF,KAAK3K,OAAOZ,OAAO0P,QAAU,CAAA,EACjDA,EAAO1P,MAAM8Q,MAAQD,EAAYE,MAAQ,OACzCrB,EAAO1P,MAAMgR,OAASH,EAAYE,MAAQ,OAC1CrB,EAAO1P,MAAMgC,gBAAkB6O,EAAY3O,OAAS,6BAEhD2O,EAAYI,KACdvB,EAAOzJ,UAAY4K,EAAYI,KAAKrP,WAAW,QAC7C,aAAaiP,EAAYI,qDACzBJ,EAAYI,KAEdvB,EAAOzJ,UAAY,qPAOrByJ,EAAOxJ,iBAAiB,QAAS,IAAMqF,KAAK2F,oBAC5C1N,EAAUnD,YAAYqP,GACtBnE,KAAKG,SAASgE,OAASA,EAGvB,MAAMyB,EAAWtR,SAASI,cAAc,OACxCkR,EAASpO,UAAY,iBAErB,MAAMqO,EAAc7F,KAAK3K,OAAOZ,OAAOgH,QAAU,CAAA,EACjDmK,EAASlL,UAAY,wDAEfmL,EAAYpP,gBAAkB,qBAAqBoP,EAAYpP,mBAAqB,eACpFoP,EAAY3B,UAAY,UAAU2B,EAAY3B,aAAe,qEAG3D2B,EAAYH,KACZ,aAAaG,EAAYH,mEACPG,EAAYC,UAAY,mBAAmBD,EAAYC,UAAY,YAAc,oDAChE9F,KAAK3K,OAAOkM,uFAE7CsE,EAAY3B,UAAY,UAAU2B,EAAY3B,aAAe,+tEAkD3BlE,KAAK3K,OAAOmM,2EACRxB,KAAK3K,OAAOoM,2qFAwD5DxJ,EAAUnD,YAAY8Q,GACtB5F,KAAKG,SAAShL,OAASyQ,EACvB5F,KAAKG,SAAS4F,kBAAoBH,EAAS7G,cAAc,qBACzDiB,KAAKG,SAAS6F,WAAaJ,EAAS7G,cAAc,6BAClDiB,KAAKG,SAAS8F,WAAaL,EAAS7G,cAAc,8BAClDiB,KAAKG,SAAS+F,YAAcN,EAAS7G,cAAc,yBACnDiB,KAAKG,SAASgG,YAAcP,EAAS7G,cAAc,yBACnDiB,KAAKG,SAASiG,YAAcR,EAAS7G,cAAc,yBACnDiB,KAAKG,SAASkG,YAAcT,EAAS7G,cAAc,yBACnDiB,KAAKG,SAAS4C,qBAAuB6C,EAAS7G,cAAc,kCAC5DiB,KAAKG,SAASmG,aAAeV,EAAS7G,cAAc,0BACpDiB,KAAKG,SAASoG,YAAcX,EAAS7G,cAAc,yBACnDiB,KAAKG,SAASM,kBAAoBmF,EAAS7G,cAAc,+BAGzDiB,KAAKwG,sBAGLxG,KAAKhK,SAASG,QAAQsQ,GAAOzG,KAAK0G,eAAeD,GAAK,IACtDzG,KAAK2G,iBACL3G,KAAK4G,aAGD5G,KAAK3K,OAAOwR,aACd7G,KAAK8G,iBAAiB9G,KAAK3K,OAAO0R,qBAAuB,IAE5D,CAED,mBAAAP,GAEExG,KAAKG,SAAS+F,YAAYvL,iBAAiB,QAAS,IAAMqF,KAAK2F,oBAG/D3F,KAAKG,SAAS8F,WAAWtL,iBAAiB,QAAS,IAAMqF,KAAKgH,eAC9DhH,KAAKG,SAAS6F,WAAWrL,iBAAiB,WAAa/G,IACvC,UAAVA,EAAEN,KAAiB0M,KAAKgH,gBAIjBhH,KAAKG,SAAShL,OAAOuH,iBAAiB,gBAC9CvG,QAAQ8Q,IACXA,EAAItM,iBAAiB,QAAS,KAC5B,MAAMuM,EAAUD,EAAIxK,QAAQwK,IAC5BjH,KAAKmH,UAAUD,OAKClH,KAAKG,SAAShL,OAAOuH,iBAAiB,wBAC9CvG,QAAQ+B,IAClBA,EAAKyC,iBAAiB,QAAS,KAC7B,MAAMyM,EAASlP,EAAKuE,QAAQ2K,OAC5BpH,KAAKqH,iBAAiBD,OAK1B,MAAME,EAActH,KAAKG,SAAShL,OAAO4J,cAAc,yBACjDwI,EAAevH,KAAKG,SAAShL,OAAO4J,cAAc,0BAExDuI,EAAY3M,iBAAiB,QAAS,KACpCqF,KAAKO,eAAgB,EACrBP,KAAKG,SAASmG,aAAa7R,MAAMoQ,QAAU,SAG7C0C,EAAa5M,iBAAiB,QAAS,KACrCqF,KAAKmH,UAAU,SAElB,CAED,SAAAA,CAAUD,GAEKlH,KAAKG,SAAShL,OAAOuH,iBAAiB,gBAC9CvG,QAAQ8Q,IACXA,EAAIhO,UAAU2B,OAAO,SAAUqM,EAAIxK,QAAQwK,MAAQC,KAIpClH,KAAKG,SAAShL,OAAOuH,iBAAiB,wBAC9CvG,QAAQkC,IACfA,EAAQY,UAAU2B,OAAO,SAAUvC,EAAQoE,QAAQpE,UAAY6O,KAGjElH,KAAKM,WAAa4G,EAGF,SAAZA,IACGlH,KAAKO,gBACRP,KAAKG,SAASmG,aAAa7R,MAAMoQ,QAAU,QAG7C9C,WAAW,KACT/B,KAAK2G,kBACJ,MAIW,kBAAZO,GAA6D,IAA9BlH,KAAKQ,cAAcxI,QACpDgI,KAAKgC,mBAER,CAED,gBAAAqF,CAAiBD,GACf,OAAQA,GACN,IAAK,aACHpH,KAAKmH,UAAU,QACf,MACF,IAAK,iBACHnH,KAAKmH,UAAU,QACXnH,KAAKO,eACPwB,WAAW,KACT/B,KAAKgH,YAAY,wBAAyB,uBACzC,KAEL,MACF,IAAK,aACHhH,KAAKmH,UAAU,QACXnH,KAAKO,eACPwB,WAAW,KACT/B,KAAKgH,YAAY,4BAA6B,qBAC7C,KAEL,MACF,IAAK,MACHhH,KAAKmH,UAAU,QACXnH,KAAKO,eACPwB,WAAW,KACT/B,KAAKgH,YAAY,qCAAsC,cACtD,KAIV,CAED,2BAAMQ,GACJ,GAAK3H,EAEL,IACE,MAAMqC,QAAiBC,MAAMnC,KAAK3K,OAAO+L,YAAa,CACpDqB,OAAQ,MACRtH,QAAS,CACP,eAAgB,mBAChBsM,cAAiB,UAAU5H,OAI/B,GAAIqC,EAASQ,GAAI,CACf,MAAMgF,QAAsBxF,EAASI,OACrCtC,KAAKS,kBAAoBiH,EAEzB1H,KAAK2H,yBACN,CACF,CAAC,MAAOzG,GACPrN,QAAQqN,MAAM,qCAAsCA,EACrD,CACF,CAEH,uBAAAyG,GACE,IAAK3H,KAAKG,SAASoG,cAAgBvG,KAAKG,SAASM,kBAAmB,OAGpET,KAAKG,SAASM,kBAAkB/F,UAAY,GAG5C,MAAMkN,EAAkB,GACxB5H,KAAKS,kBAAkBtK,QAAQ0R,IAEzBA,EAAa1E,MACfyE,EAAgBE,KAAK,CACnB3E,KAAM0E,EAAa1E,KACnBxD,IAAK,OAILkI,EAAa1Q,SACf0Q,EAAa1Q,QAAQhB,QAAQoJ,IAC3BqI,EAAgBE,KAAK,CACnB3E,KAAM5D,EAAIjH,MACVqH,IAAKJ,EAAII,UAMc,IAA3BiI,EAAgB5P,QAKpBgI,KAAKG,SAASoG,YAAY9R,MAAMoQ,QAAU,QAE1C+C,EAAgBzR,QAAQnC,IACtB,MAAMkE,EAAO5D,SAASI,cAAc,OACpCwD,EAAKV,UAAY,4BAGjB,MAAMuQ,EAAUzT,SAASI,cAAc,OAMvC,GALAqT,EAAQvQ,UAAY,4BACpBuQ,EAAQxP,YAAcvE,EAAKmP,KAC3BjL,EAAKpD,YAAYiT,GAGb/T,EAAK2L,IAAK,CACZ,MAAMqI,EAAe1T,SAASI,cAAc,UAC5CsT,EAAaxQ,UAAY,8BACzBwQ,EAAazP,YAAc,eAC3ByP,EAAaC,QAAU,IAAM9S,OAAOyK,KAAK5L,EAAK2L,IAAK,UACnDzH,EAAKpD,YAAYkT,EAClB,CAEDhI,KAAKG,SAASM,kBAAkB3L,YAAYoD,MAzB5C8H,KAAKG,SAASoG,YAAY9R,MAAMoQ,QAAU,MA2B9C,CAEE,gBAAAhB,GACM7D,KAAKG,SAASgG,cAChBnG,KAAKG,SAASgG,YAAY5N,YAAcyH,KAAK3K,OAAOkM,SAGlDvB,KAAKG,SAAS6F,aAChBhG,KAAKG,SAAS6F,WAAW5H,YAAc4B,KAAK3K,OAAOmM,kBAGjDxB,KAAKG,SAAS8F,aAChBjG,KAAKG,SAAS8F,WAAW1N,YAAcyH,KAAK3K,OAAOoM,eAEtD,CAED,UAAAmF,GACE/S,QAAQ6M,IAAI,gCAGZV,KAAKG,SAASlI,UAAUxD,MAAMoQ,QAAU,QACxC7E,KAAKG,SAASlI,UAAUxD,MAAMqQ,QAAU,IACxC9E,KAAKG,SAASlI,UAAUxD,MAAMwQ,OAAS,QAGvC,MAAME,EAAYnF,KAAK3K,OAAOZ,OAAO0Q,WAAa,CAAExQ,KAAM,UAAWyQ,SAAU,KAC/EvR,QAAQ6M,IAAI,mBAAoByE,GAEhCnF,KAAKG,SAASlI,UAAUxD,MAAMoQ,QAAU,QAEjB,YAAnBM,EAAUxQ,KACZoN,WAAW,KACT/B,KAAKG,SAASlI,UAAUxD,MAAMqQ,QAAU,KACvC,IACyB,aAAnBK,EAAUxQ,MACnBqL,KAAKG,SAASlI,UAAUxD,MAAMyT,UAAY,mBAC1CnG,WAAW,KACT/B,KAAKG,SAASlI,UAAUxD,MAAM4Q,WAAa,OAAOF,EAAUC,kBAC5DpF,KAAKG,SAASlI,UAAUxD,MAAMqQ,QAAU,IACxC9E,KAAKG,SAASlI,UAAUxD,MAAMyT,UAAY,iBACzC,KAEHlI,KAAKG,SAASlI,UAAUxD,MAAMqQ,QAAU,GAE3C,CAGD,gBAAAgC,CAAiBqB,EAAW,KAC1BnI,KAAKoI,kBACLpI,KAAKI,gBAAkBiI,YAAY,IAAMrI,KAAK2D,gBAAiBwE,GAC/DnI,KAAKU,IAAI,8BAA8ByH,EAAS,cACjD,CAED,eAAAC,GACMpI,KAAKI,kBACPkI,cAActI,KAAKI,iBACnBJ,KAAKI,gBAAkB,KAE1B,CAGD,WAAAwB,GACE5B,KAAKE,UAAYnM,EAAoB,sBAChCiM,KAAKE,YACRF,KAAKE,UH7rBF,uCAAuCoE,QAAQ,QAAS,SAASiE,GACtE,MAAMC,EAAoB,GAAhBhE,KAAKiE,SAAgB,EAE/B,OADgB,MAANF,EAAYC,EAAS,EAAJA,EAAU,GAC5B7D,SAAS,GACtB,GG0rBMtR,EAAoB,qBAAsB2M,KAAKE,YAEjDF,KAAKhK,SAAWjC,EAAoB,wBAAwBiM,KAAKE,cAAgB,EAClF,CAGD,cAAAwG,CAAegC,EAASC,GAAO,GAC7B,MAAMC,EAAiBtU,SAASI,cAAc,OAG9C,GAFAkU,EAAe3P,UAAUC,IAAI,kBAAsC,SAAnBwP,EAAQG,OAAoB,OAAS,OAEjFH,EAAQvF,KAAM,CAChB,MAAM5K,EAAcjE,SAASI,cAAc,OAC3C6D,EAAYmC,UHjqBX,SAAuByI,GAC1B,IAAKA,EAAM,MAAO,GAClB,IAAI2F,EAAO3F,EAgBX,OAbA2F,EAAOA,EAAKxE,QAAQ,iBAAkB,uBACtCwE,EAAOA,EAAKxE,QAAQ,aAAc,uBAGlCwE,EAAOA,EAAKxE,QAAQ,aAAc,eAClCwE,EAAOA,EAAKxE,QAAQ,WAAY,eAGhCwE,EAAOA,EAAKxE,QAAQ,2BAA4B,iEAGhDwE,EAAOA,EAAKxE,QAAQ,MAAO,SAEpBwE,CACX,CG8oB8BC,CAAcL,EAAQvF,MAC9CyF,EAAe9T,YAAYyD,EAC5B,CAED,GAAImQ,EAAQvR,SAASa,OAAS,EAAG,CAC/B,MAAMgR,EAAkBjS,EAAc2R,EAAS,UAAW1I,KAAKgH,YAAYiC,KAAKjJ,OAC5EgJ,GAAiBJ,EAAe9T,YAAYkU,EACjD,CAED,GAAIN,EAAQhR,MAAO,CACjB,MAAMwR,EAAUnS,EAAc2R,EAAS,SACnCQ,GAASN,EAAe9T,YAAYoU,EACzC,CAED,GAAIR,EAAQ9Q,MAAO,CACjB,MAAMuR,EAAUpS,EAAc2R,EAAS,SACnCS,GAASP,EAAe9T,YAAYqU,EACzC,CAED,GAAIT,EAAQ7P,UAAUb,OAAS,EAAG,CAChC,MAAMoR,EAAarS,EAAc2R,EAAS,WAAY1I,KAAKgH,YAAYiC,KAAKjJ,OACxEoJ,GAAYR,EAAe9T,YAAYsU,EAC5C,CAED,GAAIV,EAAQW,OAAQ,CAClB,MAAMC,EAAWxQ,EAAoB4P,EAAQW,OAAQrJ,KAAKgH,YAAYiC,KAAKjJ,OACvEsJ,GAAUV,EAAe9T,YAAYwU,EAC1C,CAEDtJ,KAAKG,SAAS4F,kBAAkBjR,YAAY8T,GAExCD,IACF3I,KAAKhK,SAAS8R,KAAKY,GACnBrV,EAAoB,wBAAwB2M,KAAKE,YAAaF,KAAKhK,WAGrEgK,KAAK2G,gBACN,CAED,qBAAM4C,GACJ,IACE,MAAMrH,QAAiBC,MAAMnC,KAAK3K,OAAO+L,YAAa,CACpDqB,OAAQ,MACRtH,QAAS,CACP,eAAgB,mBAChBsM,cAAiB,UAAU5H,OAI/B,IAAKqC,EAASQ,GAAI,MAAM,IAAI8G,MAAM,uBAAuBtH,EAASuH,UAElE,MAAMC,QAAqBxH,EAASI,OAChCoH,GAAc1R,OAAS,GACzBnE,QAAQ6M,IAAIb,EAAU,mBACtB6J,EAAavT,QAAQ+L,GAAYlC,KAAK0G,eAAe,CAAEmC,OAAQ,SAAU3G,MAEzElC,KAAK0G,eAAe,CAAEmC,OAAQ,MAAO1F,KAAM,mCAE9C,CAAC,MAAOjC,GACPrN,QAAQqN,MAAM,iBAAkBA,GAChClB,KAAK0G,eAAe,CAClBmC,OAAQ,MACR1F,KAAM,0DAET,CACF,CAED,iBAAM6D,CAAY7D,EAAO,KAAM1D,EAAU,MACvC,IAAIkK,EAAcxG,GAAQnD,KAAKG,SAAS6F,WAAWzS,MAAMqW,OACzD,IAAKD,IAAgBlK,EAAS,OAE9B,MAAMoK,EAAc,CAAEhB,OAAQ,OAAQ1F,KAAMwG,GAC5C3J,KAAK0G,eAAemD,GACpB7J,KAAKG,SAAS6F,WAAWzS,MAAQ,GAEjC,MAAMuW,EAAc,CAClBjB,OAAQ7I,KAAKE,UACbwI,QAASiB,KACLlK,GAAW,CAAEsK,WAAY,CAAEtK,aAGjC,IACE,MAAMyC,QAAiBC,MAAMnC,KAAK3K,OAAO8L,OAAQ,CAC/CsB,OAAQ,OACRtH,QAAS,CAAE,eAAgB,oBAC3BrB,KAAMpG,KAAKC,UAAUmW,KAGvB,IAAK5H,EAASQ,GAAI,MAAM,IAAI8G,MAAM,uBAAuBtH,EAASuH,UAElE,MAAMC,QAAqBxH,EAASI,OAChCoH,GAAc1R,OAAS,GACzBnE,QAAQ6M,IAAIb,EAAU,mBACtB6J,EAAavT,QAAQ+L,GAAYlC,KAAK0G,eAAe,CAAEmC,OAAQ,SAAU3G,MAEzElC,KAAK0G,eAAe,CAAEmC,OAAQ,MAAO1F,KAAM,mCAE9C,CAAC,MAAOjC,GACPrN,QAAQqN,MAAM,iBAAkBA,GAChClB,KAAK0G,eAAe,CAClBmC,OAAQ,MACR1F,KAAM,0DAET,CACF,CAGD,gBAAAwC,GACE3F,KAAKC,QAAUD,KAAKC,OACpBD,KAAKG,SAAShL,OAAO8D,UAAU2B,OAAO,OAAQoF,KAAKC,QACnDD,KAAKG,SAASgE,OAAOlL,UAAU2B,OAAO,SAAUoF,KAAKC,QAEjDD,KAAKC,SACHH,GAAmBD,IACrBC,GAAkB,EAClBE,KAAKuJ,mBAGPvJ,KAAKG,SAAS6F,WAAWgE,QACzBhK,KAAK2G,iBAER,CAED,cAAAA,GACM3G,KAAKG,SAAS4F,oBAChB/F,KAAKG,SAAS4F,kBAAkBkE,UAAYjK,KAAKG,SAAS4F,kBAAkBmE,aAE/E,GAMH/U,OAAOC,WAAWsM,OAClBvM,OAAOC,WAAWsM,OAClBvM,OAAOC,WAAWsM,OAGSpN,SAAS6V,eAAe,oBAGjDhV,OAAOiV,oBAAsB,SAASC,GACpCxK,EAAYwK,EACZxW,QAAQ6M,IAAI,gDACZ7M,QAAQ6M,IAAI,gCAAiCb,GAGzC1K,OAAOC,YAAcD,OAAOC,WAAW6K,QAAUJ,GAAaC,IAC9DA,GAAkB,EACpB3K,OAAOC,WAAWmU,kBAExB,EAGE1V,QAAQ6M,IAAI"}