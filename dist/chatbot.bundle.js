!function(){"use strict";function t(t,e){try{localStorage.setItem(t,JSON.stringify(e))}catch(t){console.warn("Chatbot SDK: localStorage write error:",t)}}function e(t){try{const e=localStorage.getItem(t);return e?JSON.parse(e):null}catch(t){return console.warn("Chatbot SDK: localStorage read error:",t),null}}!function(t,e){void 0===e&&(e={});var o=e.insertAt;if(t&&"undefined"!=typeof document){var n=document.head||document.getElementsByTagName("head")[0],a=document.createElement("style");a.type="text/css","top"===o&&n.firstChild?n.insertBefore(a,n.firstChild):n.appendChild(a),a.styleSheet?a.styleSheet.cssText=t:a.appendChild(document.createTextNode(t))}}('#chatbot-widget-container{bottom:20px;font-family:Inter,-apple-system,BlinkMacSystemFont,sans-serif;position:fixed;right:20px;z-index:1000}.chatbot-bubble{align-items:center;animation:chatbot-pulse 2s cubic-bezier(.66,0,0,1) infinite;background-color:var(--chatbot-theme-color,#1261a0);border-radius:50%;box-shadow:0 4px 10px rgba(0,0,0,.2);color:#fff;cursor:pointer;display:flex;height:60px;justify-content:center;overflow:hidden;position:relative;transition:transform .2s ease-in-out,box-shadow .2s ease-in-out;width:60px}.chatbot-bubble:hover{box-shadow:0 6px 12px rgba(0,0,0,.25);transform:scale(1.05)}.chatbot-bubble:after{border-left:10px solid transparent;border-right:10px solid transparent;border-top:10px solid var(--chatbot-theme-color,#1261a0);bottom:-10px;content:"";height:0;position:absolute;right:15px;width:0}.chatbot-position-bottom-left .chatbot-bubble:after{left:15px;right:auto}@keyframes chatbot-pulse{0%{box-shadow:0 0 0 0 var(--chatbot-theme-color-faded,rgba(18,97,160,.7))}to{box-shadow:0 0 0 20px var(--chatbot-theme-color-faded,rgba(18,97,160,0))}}.chatbot-bubble.hidden{display:none}.chatbot-bubble svg{height:24px;width:24px}.chatbot-window{background-color:#fff;border-radius:12px;bottom:90px;box-shadow:0 10px 25px rgba(0,0,0,.15);display:flex;flex-direction:column;height:85vh;max-width:500px;min-width:400px;opacity:0;overflow:hidden;pointer-events:none;position:fixed;right:20px;transform:translateY(100%) scale(.9);transition:transform .3s ease,opacity .3s ease;width:25vw}@media (max-width:768px){.chatbot-window{border-radius:0;bottom:0;height:100vh;left:0;max-width:unset;min-width:unset;position:fixed;right:0;top:0;transform:translateY(100%);width:100vw}.chatbot-window.open{transform:translateY(0) scale(1)}#chatbot-widget-container{bottom:20px;right:20px}}.chatbot-window.open{opacity:1;pointer-events:auto;transform:translateY(0) scale(1)}.chatbot-header{background-color:var(--chatbot-theme-color,#667eea);color:#fff;display:flex;flex-direction:column;flex-shrink:0;padding:0}.chatbot-header-top{align-items:center;display:flex;font-size:1.1em;font-weight:600;justify-content:space-between;padding:12px 16px}.chatbot-header-close{background:none;border:none;color:#fff;cursor:pointer;font-size:1.5em;line-height:1;padding:4px}.chatbot-tabs{backdrop-filter:blur(10px);background:hsla(0,0%,100%,.1);border:1px solid hsla(0,0%,100%,.18);border-radius:20px;box-shadow:0 4px 20px 0 rgba(0,0,0,.37);display:flex;margin-bottom:1em;padding:3px}.chatbot-tab{background:transparent;border:none;border-radius:18px;color:#000;cursor:pointer;flex:1;font-size:.8em;font-weight:600;letter-spacing:.5px;overflow:hidden;padding:10px 18px;position:relative;text-transform:uppercase;transition:all .4s cubic-bezier(.25,.8,.25,1)}.chatbot-tab:hover{background:hsla(0,0%,100%,.2);box-shadow:0 4px 15px rgba(0,0,0,.15);color:#000;transform:translateY(-2px) scale(1.01)}.chatbot-tab:before{background:linear-gradient(120deg,transparent,hsla(0,0%,100%,.3),transparent);content:"";height:100%;left:-100%;position:absolute;top:0;transition:left .6s ease;width:100%}.chatbot-tab:hover:before{left:100%}.chatbot-tab.active{background:hsla(0,0%,100%,.4);border:1px solid hsla(0,0%,100%,.3);box-shadow:0 6px 20px rgba(0,0,0,.2);color:#000;font-weight:700;transform:translateY(-2px) scale(1.01)}.chatbot-tab.active:after{animation:tabGlowPulse 2s ease-in-out infinite;background:#000;border-radius:2px;bottom:0;content:"";height:3px;left:50%;position:absolute;transform:translateX(-50%);width:60%}@keyframes tabGlowPulse{0%,to{box-shadow:0 0 10px rgba(0,0,0,.6);opacity:.9;transform:translateX(-50%) scaleX(1)}50%{box-shadow:0 0 20px rgba(0,0,0,.8);opacity:1;transform:translateX(-50%) scaleX(1.1)}}.chatbot-content{display:flex}.chatbot-content,.chatbot-tab-content{flex-direction:column;flex-grow:1;overflow:hidden}.chatbot-tab-content{display:none}.chatbot-tab-content.active{display:flex}.chatbot-home-content{background:linear-gradient(135deg,#f8f9fa,#e9ecef);overflow-y:auto;padding:20px}.chatbot-home-welcome{background:#fff;border-radius:12px;box-shadow:0 2px 10px rgba(0,0,0,.1);margin-bottom:30px;padding:20px;text-align:center}.chatbot-home-welcome h2{color:var(--chatbot-theme-color,#667eea);font-size:1.4em;margin:0 0 10px}.chatbot-home-welcome p{color:#666;font-size:.9em;margin:0}.chatbot-actions-grid{display:grid;gap:15px;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));margin-bottom:20px}.chatbot-action-card{background:#fff;border:2px solid transparent;border-radius:12px;box-shadow:0 2px 8px rgba(0,0,0,.1);cursor:pointer;padding:20px 15px;text-align:center;transition:all .3s ease}.chatbot-action-card:hover{border-color:var(--chatbot-theme-color,#667eea);box-shadow:0 4px 15px rgba(0,0,0,.15);transform:translateY(-2px)}.chatbot-action-icon{display:block;font-size:2em;margin-bottom:10px}.chatbot-action-title{color:#333;font-size:.9em;font-weight:600;margin-bottom:5px}.chatbot-action-desc{color:#666;font-size:.75em;line-height:1.4}.chatbot-user-actions{margin-top:20px}.chatbot-user-actions h3{color:var(--chatbot-theme-color,#667eea);font-size:1.1em;margin:0 0 15px;text-align:center}.chatbot-notification-card{animation:slideInRight .5s ease;background:#fff;border-left:4px solid var(--chatbot-theme-color,#667eea);border-radius:8px;box-shadow:0 2px 6px rgba(0,0,0,.1);margin-bottom:10px;padding:15px}@keyframes slideInRight{0%{opacity:0;transform:translateX(20px)}to{opacity:1;transform:translateX(0)}}.chatbot-notification-text{color:#333;font-size:.9em;line-height:1.4;margin-bottom:10px}.chatbot-notification-button{background:var(--chatbot-theme-color,#667eea);border:none;border-radius:6px;color:#fff;cursor:pointer;font-size:.8em;margin-bottom:8px;margin-right:8px;padding:8px 16px;transition:background-color .3s}.chatbot-notification-button:hover{background:var(--chatbot-theme-color-hover,#5a6fd1)}.chatbot-chat-content{display:flex;flex-direction:column;flex-grow:1;overflow:hidden}.chatbot-terms-overlay{align-items:center;animation:fadeInScale .3s ease;backdrop-filter:blur(8px);background:linear-gradient(135deg,hsla(0,0%,100%,.98),rgba(248,250,252,.95));bottom:0;display:flex;flex-direction:column;justify-content:center;left:0;padding:5px;position:absolute;right:0;top:0;z-index:10}@keyframes fadeInScale{0%{opacity:0;transform:scale(.9)}to{opacity:1;transform:scale(1)}}.chatbot-terms-content{background:#fff;border:1px solid rgba(0,0,0,.05);border-radius:16px;box-shadow:0 20px 40px rgba(0,0,0,.15),0 8px 16px rgba(0,0,0,.1),inset 0 1px 0 hsla(0,0%,100%,.9);max-height:85%;max-width:90%;overflow-y:auto;padding:30px 25px;position:relative}.chatbot-terms-content:before{background:linear-gradient(90deg,var(--chatbot-theme-color),#9013fe,#ff4081);border-radius:16px 16px 0 0;content:"";height:4px;left:0;position:absolute;right:0;top:0}.chatbot-terms-title{color:var(--chatbot-theme-color,#667eea);font-size:1.3em;font-weight:700;margin-bottom:24px;position:relative;text-align:center}.chatbot-terms-title:after{background:linear-gradient(90deg,var(--chatbot-theme-color),#9013fe);border-radius:1px;bottom:-8px;content:"";height:2px;left:50%;position:absolute;transform:translateX(-50%);width:40px}.chatbot-terms-text{background:linear-gradient(135deg,#f8fafc,#f1f5f9);border-left:4px solid #fbbf24;border-radius:10px;color:#4a5568;font-size:.6em;line-height:1.7;margin-bottom:18px;padding:16px 18px;position:relative;transition:all .3s ease}.chatbot-terms-text:before{content:"‚ö†Ô∏è";font-size:1.1em;left:12px;opacity:.8;position:absolute;top:12px}.chatbot-terms-text{padding-left:42px}.chatbot-terms-text:hover{background:linear-gradient(135deg,#f1f5f9,#e2e8f0);transform:translateY(-1px)}.chatbot-terms-buttons{display:flex;gap:16px;justify-content:center;margin-top:28px}.chatbot-terms-accept,.chatbot-terms-decline{border:none;border-radius:10px;cursor:pointer;font-size:.9em;font-weight:600;letter-spacing:.5px;overflow:hidden;padding:14px 28px;position:relative;text-transform:uppercase;transition:all .3s cubic-bezier(.4,0,.2,1)}.chatbot-terms-accept{background:var(--chatbot-theme-color);box-shadow:0 4px 12px rgba(102,126,234,.3);color:#fff}.chatbot-terms-accept:before{background:linear-gradient(90deg,transparent,hsla(0,0%,100%,.2),transparent);content:"";height:100%;left:-100%;position:absolute;top:0;transition:left .5s ease;width:100%}.chatbot-terms-accept:hover:before{left:100%}.chatbot-terms-accept:hover{box-shadow:0 6px 20px rgba(102,126,234,.4);transform:translateY(-2px)}.chatbot-terms-decline{background:linear-gradient(135deg,#64748b,#475569);box-shadow:0 4px 12px rgba(100,116,139,.3);color:#fff}.chatbot-terms-decline:hover{background:linear-gradient(135deg,#475569,#334155);box-shadow:0 6px 20px rgba(100,116,139,.4);transform:translateY(-2px)}.chatbot-messages{background-color:#f8f9fa;display:flex;flex-direction:column;flex-grow:1;gap:8px;overflow-y:auto;padding:12px}.chatbot-announcements-content{background:linear-gradient(135deg,#f8f9fa,#e9ecef);overflow-y:auto;padding:15px}.chatbot-announcements-list{display:flex;flex-direction:column;gap:15px}.chatbot-announcement-card{animation:fadeInUp .5s ease forwards;background:#fff;border-radius:12px;box-shadow:0 3px 12px rgba(0,0,0,.1);opacity:0;overflow:hidden;transform:translateY(20px);transition:all .3s ease}.chatbot-announcement-card:hover{box-shadow:0 6px 20px rgba(0,0,0,.15);transform:translateY(-2px)}@keyframes fadeInUp{to{opacity:1;transform:translateY(0)}}.chatbot-announcement-image{align-items:center;background-color:var(--chatbot-theme-color,#667eea);background-position:50%;background-size:cover;color:#fff;display:flex;font-size:2em;height:120px;justify-content:center;position:relative;width:100%}.chatbot-announcement-content{padding:15px}.chatbot-announcement-title{color:#333;font-size:1em;font-weight:600;line-height:1.4;margin-bottom:8px}.chatbot-announcement-description{color:#666;font-size:.85em;line-height:1.5;margin-bottom:10px}.chatbot-announcement-date{align-items:center;color:#999;display:flex;font-size:.75em;font-weight:500;gap:5px}.chatbot-announcement-date:before{content:"üìÖ";font-size:.9em}.chatbot-announcements-empty{color:#666;padding:40px 20px;text-align:center}.chatbot-announcements-empty-icon{font-size:3em;margin-bottom:15px;opacity:.5}.chatbot-input-area{background-color:#fff;border-top:1px solid #e2e8f0;display:flex;flex-shrink:0;padding:12px}.chatbot-input-area input{border:1px solid #e2e8f0;border-radius:20px;flex-grow:1;font-size:.9em;margin-right:8px;outline:none;padding:10px 16px;transition:border-color .3s}.chatbot-input-area input:focus{border-color:var(--chatbot-theme-color,#667eea)}.chatbot-input-area button{background-color:var(--chatbot-theme-color,#667eea);border:none;border-radius:20px;color:#fff;cursor:pointer;font-size:.9em;font-weight:500;padding:10px 16px;transition:background-color .3s}.chatbot-input-area button:hover{background-color:var(--chatbot-theme-color-hover,#5a6fd1)}.chatbot-message{word-wrap:break-word;border-radius:12px;box-shadow:0 1px 3px rgba(0,0,0,.1);font-size:.95em;line-height:1.4;margin-bottom:8px;max-width:80%;padding:10px 14px}.chatbot-message.user{background-color:var(--chatbot-theme-color,#667eea);border-bottom-right-radius:4px;color:#fff;margin-left:auto}.chatbot-message.bot{background-color:#fff;border:1px solid #e2e8f0;border-bottom-left-radius:4px;color:#333;margin-right:auto}.chatbot-message a{color:var(--chatbot-theme-color,#667eea);text-decoration:underline}.chatbot-message.user a{color:#fff;text-decoration:underline}.chatbot-button-container{display:flex;flex-wrap:wrap;gap:8px;margin-top:8px}.chatbot-button-container button{background-color:var(--chatbot-theme-color,#667eea);border:none;border-radius:20px;color:#fff;cursor:pointer;flex-grow:1;font-size:.85em;padding:8px 12px;transition:all .2s}.chatbot-button-container button:hover{background-color:var(--chatbot-theme-color-hover,#5a6fd1);transform:translateY(-1px)}.chatbot-announcements-content::-webkit-scrollbar,.chatbot-home-content::-webkit-scrollbar,.chatbot-messages::-webkit-scrollbar{width:6px}.chatbot-announcements-content::-webkit-scrollbar-track,.chatbot-home-content::-webkit-scrollbar-track,.chatbot-messages::-webkit-scrollbar-track{background:#f1f1f1;border-radius:3px}.chatbot-announcements-content::-webkit-scrollbar-thumb,.chatbot-home-content::-webkit-scrollbar-thumb,.chatbot-messages::-webkit-scrollbar-thumb{background:#c1c1c1;border-radius:3px}.chatbot-announcements-content::-webkit-scrollbar-thumb:hover,.chatbot-home-content::-webkit-scrollbar-thumb:hover,.chatbot-messages::-webkit-scrollbar-thumb:hover{background:#a8a8a8}.chatbot-position-bottom-right{bottom:20px;right:20px}.chatbot-position-bottom-left{bottom:20px;left:20px}.chatbot-position-top-right{right:20px;top:20px}.chatbot-position-top-left{left:20px;top:20px}:root{--chatbot-theme-color:#667eea;--chatbot-theme-color-hover:#5a6fd1;--chatbot-header-bg:var(--chatbot-theme-color);--chatbot-header-text:#fff;--chatbot-bubble-size:60px;--chatbot-bubble-color:var(--chatbot-theme-color);--chatbot-user-bubble:var(--chatbot-theme-color);--chatbot-bot-bubble:#f0f2f5;--chatbot-text-size:0.95em}');const o=()=>window.ChatbotSDK||{config:{}};function n(t,e,n,s={}){const i=o(),r=i.config.style?.components?.[e]?.[n]||{},c={...a(e,n,i.config.style?.messages||{}),...r,...s};Object.entries(c).forEach(([e,o])=>{null!=o&&(e.startsWith("--")?t.style.setProperty(e,o):t.style[e]=o)})}function a(t,e,o){const n={};switch(t){case"buttons":"button"===e&&(n.backgroundColor=o.buttonColor,n.color=o.buttonTextColor);break;case"carousel":"card"===e&&(n.backgroundColor=o.botBubbleColor),"cardTitle"!==e&&"cardSubtitle"!==e||(n.color=o.botTextColor);break;case"faq":"question"===e&&(n.color=o.botTextColor);break;case"rating":"star"===e&&(n.color=o.buttonColor)}return n}function s(t,e,o=null){switch(e){case"buttons":return r(t.buttons,o,t.style);case"image":return function(t,e={}){if(!t)return null;const o=document.createElement("img");return o.src=t,o.className="chatbot-image",n(o,"image","image",e),o}(t.image,t.style);case"video":return function(t,e={}){if(!t)return null;const o=document.createElement("video");return o.src=t,o.controls=!0,o.className="chatbot-video",n(o,"video","video",e),o}(t.video,t.style);case"carousel":return function(t,e,o={}){if(!t||0===t.length)return null;const a=document.createElement("div");return a.className="chatbot-carousel-container",n(a,"carousel","container",o.container),t.forEach(t=>{const s=document.createElement("div");if(s.className="chatbot-carousel-card",n(s,"carousel","card",o.card),t.image_url){const e=document.createElement("img");e.src=t.image_url,e.className="chatbot-carousel-card-image",n(e,"carousel","cardImage",o.cardImage),s.appendChild(e)}const i=document.createElement("div");i.className="chatbot-carousel-card-content",n(i,"carousel","cardContent",o.content);const c=document.createElement("h3");if(c.className="chatbot-carousel-card-title",c.textContent=t.title,n(c,"carousel","cardTitle",o.title),i.appendChild(c),t.subtitle){const e=document.createElement("p");e.className="chatbot-carousel-card-subtitle",e.textContent=t.subtitle,n(e,"carousel","cardSubtitle",o.subtitle),i.appendChild(e)}if(t.buttons?.length>0){const n=r(t.buttons,e,{...o,button:{...t.button_style||{}}});n&&i.appendChild(n)}s.appendChild(i),a.appendChild(s)}),a}(t.carousel,o,t.style);default:return null}}function i(t,e=null){if(!t)return null;const a=document.createElement("div");if(a.classList.add("chatbot-custom-payload"),n(a,"custom","container",t.style),t.locations){const e=function(t,e={}){if(!t||0===t.length)return null;const a=document.createElement("div");return a.className="chatbot-location-cards",n(a,"locations","container",e.container),t.forEach(t=>{const s=`https://www.google.com/maps?q=${t.lat},${t.lng}`,i=`https://maps.googleapis.com/maps/api/staticmap?center=${t.lat},${t.lng}&zoom=14&size=400x200&markers=color:red%7C${t.lat},${t.lng}&key=AIzaSyCYVHw1tnbSZsihFfewNPwvuKc0iXx0ymw`,r=document.createElement("div");r.className="chatbot-location-card",n(r,"locations","card",e.card);const c=document.createElement("img");c.src=i,c.alt=`${t.name} map`,c.className="chatbot-location-map",n(c,"locations","map",e.map),r.appendChild(c);const l=document.createElement("div");l.className="chatbot-location-body",n(l,"locations","body",e.body);const d=document.createElement("div");if(d.className="chatbot-location-title",d.textContent=t.name,n(d,"locations","title",e.title),l.appendChild(d),t.address){const o=document.createElement("div");o.className="chatbot-location-address",o.textContent=t.address,n(o,"locations","address",e.address),l.appendChild(o)}const h=document.createElement("a");h.href=s,h.target="_blank",h.className="chatbot-location-button",h.textContent="View on Map",n(h,"locations","button",{backgroundColor:o().config.style?.messages?.buttonColor,color:o().config.style?.messages?.buttonTextColor,...e.button}),l.appendChild(h),r.appendChild(l),a.appendChild(r)}),a}(t.locations,t.style);e&&a.appendChild(e)}if(t.faq_list){const e=function(t,e={}){if(!t||0===t.length)return null;const o=document.createElement("div");return o.className="chatbot-faq-list-container",n(o,"faq","container",e.container),t.forEach((t,a)=>{const s=document.createElement("div");s.className="chatbot-faq-item",n(s,"faq","item",e.item);const i=document.createElement("div");i.className="chatbot-faq-question",i.textContent=t.question,n(i,"faq","question",e.question),s.appendChild(i);const r=document.createElement("div");r.className="chatbot-faq-answer",r.innerHTML=t.answer,n(r,"faq","answer",e.answer),s.appendChild(r),i.addEventListener("click",()=>{s.classList.toggle("expanded"),s.classList.contains("expanded")?n(r,"faq","expandedAnswer",e.expandedAnswer):n(r,"faq","answer",e.answer)}),o.appendChild(s)}),o}(t.faq_list,t.style);e&&a.appendChild(e)}if(t.table){const e=function(t,e={}){if(!t||!t.headers||!t.rows)return null;const a=document.createElement("div");a.className="chatbot-table-container",n(a,"table","container",e.container);const s=document.createElement("table");s.className="chatbot-table",n(s,"table","table",e.table);const i=document.createElement("thead"),r=document.createElement("tr");t.headers.forEach(t=>{const a=document.createElement("th");a.textContent=t,n(a,"table","header",{backgroundColor:o().config.style?.messages?.buttonColor,color:o().config.style?.messages?.buttonTextColor,...e.header}),r.appendChild(a)}),i.appendChild(r),s.appendChild(i);const c=document.createElement("tbody");return t.rows.forEach(t=>{const o=document.createElement("tr");t.forEach(t=>{const a=document.createElement("td");a.textContent=t,n(a,"table","cell",e.cell),o.appendChild(a)}),c.appendChild(o)}),s.appendChild(c),a.appendChild(s),a}(t.table,t.style);e&&a.appendChild(e)}if(t.rating){const s=function(t,e,a={}){if(!t||!t.scale)return null;const s=document.createElement("div");s.className="chatbot-rating-container",n(s,"rating","container",a.container);const i=document.createElement("div");i.className="chatbot-rating-title",i.textContent=t.title||"Please rate:",n(i,"rating","title",a.title),s.appendChild(i);const r=document.createElement("div");r.className="chatbot-stars",n(r,"rating","starsContainer",a.starsContainer);let c=0;for(let s=t.scale;s>=1;s--){const t=document.createElement("span");t.innerHTML="&#9733;",t.dataset.value=s,n(t,"rating","star",{color:o().config.style?.messages?.buttonColor,...a.star}),t.addEventListener("mouseover",()=>{r.querySelectorAll("span").forEach(t=>{parseInt(t.dataset.value)>=s&&(t.classList.add("hover"),n(t,"rating","starHover",{color:o().config.style?.themeColor,...a.starHover}))})}),t.addEventListener("mouseout",()=>{r.querySelectorAll("span").forEach(t=>{t.classList.remove("hover"),n(t,"rating","star",{color:o().config.style?.messages?.buttonColor,...a.star})})}),t.addEventListener("click",()=>{c=s,r.querySelectorAll("span").forEach(t=>{parseInt(t.dataset.value)<=c?(t.classList.add("selected"),n(t,"rating","starSelected",{color:o().config.style?.themeColor,...a.starSelected})):(t.classList.remove("selected"),n(t,"rating","star",{color:o().config.style?.messages?.buttonColor,...a.star}))}),e&&e(`Rated ${c} stars`,`/rate_service{"rating":${c}}`)}),r.appendChild(t)}return s.appendChild(r),s}(t.rating,e,t.style);s&&a.appendChild(s)}if(t.forms){const s=function(t,e,a={}){if(!t||!t.fields||!t.submit_payload)return null;const s=document.createElement("div");if(s.className="chatbot-form-container",n(s,"form","container",a.container),t.title){const e=document.createElement("div");e.className="chatbot-form-title",e.textContent=t.title,n(e,"form","title",a.title),s.appendChild(e)}const i=document.createElement("form");n(i,"form","form",a.form),i.addEventListener("submit",o=>{o.preventDefault();const n={};if(t.fields.forEach(t=>{const e=i.querySelector(`[name="${t.field_name}"]`);e&&(n[t.field_name]=e.value)}),e){const o=`Submitted form: ${Object.entries(n).map(([t,e])=>`${t}: ${e}`).join(", ")}`,a=`${t.submit_payload}${JSON.stringify(n)}`;e(o,a)}i.querySelectorAll("input, select, button").forEach(t=>t.disabled=!0)}),t.fields.forEach(t=>{const e=document.createElement("div");e.className="chatbot-form-field",n(e,"form","field",a.field);const s=document.createElement("label");let r;s.textContent=t.label,s.htmlFor=`chatbot-form-${t.field_name}`,n(s,"form","label",a.label),e.appendChild(s),"select"===t.type&&t.options?(r=document.createElement("select"),t.options.forEach(t=>{const e=document.createElement("option");e.value=t,e.textContent=t,r.appendChild(e)})):(r=document.createElement("input"),r.type=t.type),r.id=`chatbot-form-${t.field_name}`,r.name=t.field_name,r.placeholder=t.placeholder||"",r.required=t.required||!1,n(r,"form","input",{backgroundColor:o().config.style?.messages?.inputBackground,color:o().config.style?.messages?.inputTextColor,borderColor:o().config.style?.messages?.inputBorderColor,...a.input}),e.appendChild(r),i.appendChild(e)});const r=document.createElement("button");return r.type="submit",r.className="chatbot-form-submit-button",r.textContent=t.submit_button_text||"Submit",n(r,"form","submitButton",{backgroundColor:o().config.style?.messages?.buttonColor,color:o().config.style?.messages?.buttonTextColor,...a.submitButton}),i.appendChild(r),s.appendChild(i),s}(t.forms,e,t.style);s&&a.appendChild(s)}return a.children.length>0?a:null}function r(t,e,o={}){if(!t||0===t.length)return null;const a=document.createElement("div");return a.className="chatbot-button-container",n(a,"buttons","container",o.container),t.forEach(t=>{const s=document.createElement("button");s.textContent=t.title,s.className="chatbot-button",n(s,"buttons","button",{...t.button_color&&{backgroundColor:t.button_color},...t.button_color&&{color:"white"},...t.button_color&&{borderColor:t.button_color},...o.button}),t.payload?s.addEventListener("click",()=>{a.querySelectorAll("button").forEach(t=>t.disabled=!0),e&&e(t.title,t.payload)}):t.url?s.addEventListener("click",()=>window.open(t.url,"_blank")):t.question&&s.addEventListener("click",()=>{a.querySelectorAll("button").forEach(t=>t.disabled=!0),e&&e(t.title,t.question)}),a.appendChild(s)}),a}let c=null,l=!0;window.ChatbotSDK=new class{constructor(){this.config={},this.isOpen=!1,this.sessionId=null,this.messages=[],this.elements={},this.refreshInterval=null,this.debug=!0,this.currentTab="home",this.termsAccepted=!1,this.announcements=[],this.userNotifications=[]}log(...t){this.debug&&console.log("[Chatbot]",...t)}initConfig(t={}){const e=document.querySelector('script[src*="chatbot.bundle.js"]');let o={};if(e){const t=e.getAttribute("chatbot-config");if(t)try{o=JSON.parse(t)}catch(t){console.error("Chatbot SDK: Invalid JSON in chatbot-config attribute",t)}}this.config={...o,...t},this.config.botUrl=this.config.botUrl||"http://0.0.0.0:8000/api/v1/chatbot/chat",this.config.startingUrl="http://0.0.0.0:8000/api/v1/chatbot/start",this.config.announcementsUrl="http://0.0.0.0:8000/api/v1/mock/announcements",this.config.themeColor=this.config.themeColor||"#020c15ff",this.config.position=this.config.position||"bottom-right",this.config.botName=this.config.botName||"Chatbot",console.log("botName:",this.config.botName),this.config.inputPlaceholder=this.config.inputPlaceholder||"Type your message...",this.config.sendButtonText=this.config.sendButtonText||"Send"}async init(){this.initConfig(),await this.loadConfig(),this.initSession(),"complete"===document.readyState||"interactive"===document.readyState?this.createWidgetUI():document.addEventListener("DOMContentLoaded",()=>{console.log("DOM fully loaded, creating UI"),this.createWidgetUI()}),setTimeout(()=>{this.elements.container||(console.warn("Fallback UI creation"),this.createWidgetUI())},1e3),console.log("Loading announcements..."),await this.loadAnnouncements()}async loadConfig(){if(this.config.configApiUrl)try{this.log("Loading initial config from API");const t=await fetch(`${this.config.configApiUrl}?t=${Date.now()}`),e=await t.json();this.mergeConfigs(e),this.applyDynamicStyles()}catch(t){this.log("Initial config load failed:",t)}}async loadAnnouncements(){try{const t=await fetch(this.config.announcementsUrl,{method:"GET",headers:{"Content-Type":"application/json"}});if(t.ok){const e=await t.json();this.announcements=e.sort((t,e)=>new Date(e.date)-new Date(t.date)),this.renderAnnouncements()}}catch(t){console.error("Failed to load announcements:",t)}}renderAnnouncements(){const t=this.elements.announcementsContent;if(!t)return;const e=t.querySelector(".chatbot-announcements-list");e&&(e.innerHTML="",e.classList.add("scroll-stack-list"),0!==this.announcements.length?this.announcements.forEach((t,o)=>{const n=document.createElement("div");n.className="chatbot-announcement-card",n.style.animationDelay=.1*o+"s";const a=t.image?`<div class="chatbot-announcement-image" style="background-image: url('${t.image}')"></div>`:'<div class="chatbot-announcement-image chatbot-announcement-default-icon">üì¢</div>';n.innerHTML=`\n    \n      ${a}\n      <div class="chatbot-announcement-content">\n        <div class="chatbot-announcement-title">${t.text||"Announcement"}</div>\n        <div class="chatbot-announcement-description">${t.description||""}</div>\n        <div class="chatbot-announcement-date">${this.formatDate(t.date)}</div>\n      </div>\n    `,e.appendChild(n)}):e.innerHTML='\n      <div class="chatbot-announcements-empty">\n        <div class="chatbot-announcements-empty-icon">üì¢</div>\n        <p>No announcements available at the moment.</p>\n      </div>\n    ')}formatDate(t){if(!t)return"";try{return new Date(t).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}catch(e){return t}}async refreshConfig(){try{this.log("Refreshing configuration...");const t=await fetch(`${this.config.configApiUrl}?t=${Date.now()}`),e=await t.json();return this.mergeConfigs(e),this.applyDynamicStyles(),this.updateUIElements(),this.log("Configuration refreshed successfully"),!0}catch(t){return this.log("Failed to refresh config:",t),!1}}mergeConfigs(t){this.config={...this.config,...t,style:{...this.config.style||{},...t.style||{}},features:{...this.config.features||{},...t.features||{}}},this.log("Merged config:",this.config)}applyDynamicStyles(){if(!this.config.style)return void this.log("No style configuration found");const t=document.documentElement,{style:e}=this.config;e.themeColor&&(console.log("Applying theme color:",e.themeColor),t.style.setProperty("--chatbot-theme-color",e.themeColor),t.style.setProperty("--chatbot-theme-color-hover",this.adjustColor(e.themeColor,-20))),e.header?.backgroundColor&&(console.log("Applying theme color:",e.backgroundColor),t.style.setProperty("--chatbot-header-bg",e.header.backgroundColor)),e.header?.textColor&&t.style.setProperty("--chatbot-header-text",e.header.textColor),e.bubble?.color&&t.style.setProperty("--chatbot-bubble-color",e.bubble.color),e.messages?.userBubbleColor&&t.style.setProperty("--chatbot-user-bubble",e.messages.userBubbleColor),e.messages?.botBubbleColor&&t.style.setProperty("--chatbot-bot-bubble",e.messages.botBubbleColor)}adjustColor(t,e){return"#"+t.replace(/^#/,"").replace(/../g,t=>("0"+Math.min(255,Math.max(0,parseInt(t,16)+e)).toString(16)).slice(-6))}createWidgetUI(){console.log("Creating widget UI..."),console.log("Config:",this.config);const t=document.createElement("div");t.id="chatbot-widget-container",console.log("Container created:",t),t.classList.add(`chatbot-position-${this.config.position}`),t.style.display="none",t.style.opacity="0",document.body.appendChild(t),this.elements.container=t,setTimeout(()=>{const t=window.getComputedStyle(this.elements.container);console.log("Computed styles:",{display:t.display,opacity:t.opacity,zIndex:t.zIndex,visibility:t.visibility})},500);const e=this.config.style?.animation||{type:"fade-in",duration:300};e.type&&(t.style.transition=`all ${e.duration}ms ease`);const o=document.createElement("div");o.className="chatbot-bubble";const n=this.config.style?.bubble||{};o.style.width=n.size||"60px",o.style.height=n.size||"60px",o.style.backgroundColor=n.color||"var(--chatbot-theme-color)",n.icon?o.innerHTML=n.icon.startsWith("http")?`<img src="${n.icon}" alt="Chat" style="width: 70%; height: 70%;">`:n.icon:o.innerHTML='\n        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white">\n          <path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-2 12H6v-2h12v2zm0-3H6V9h12v2zm0-3H6V6h12v2z"/>\n        </svg>\n      ',o.addEventListener("click",()=>this.toggleChatWindow()),t.appendChild(o),this.elements.bubble=o;const a=document.createElement("div");a.className="chatbot-window";const s=this.config.style?.header||{};a.innerHTML=`\n      <div class="chatbot-header" style="\n        ${s.backgroundColor?`background-color: ${s.backgroundColor};`:""}\n        ${s.textColor?`color: ${s.textColor};`:""}\n      ">\n        <div class="chatbot-header-top">\n          ${s.icon?`<img src="${s.icon}" class="chatbot-header-icon" \n              style="width: ${s.iconSize||"30px"}; height: ${s.iconSize||"30px"};">`:""}\n          <span class="chatbot-header-title">${this.config.botName}</span>\n          <button class="chatbot-header-close" style="\n            ${s.textColor?`color: ${s.textColor};`:""}\n          ">&times;</button>\n        </div>\n\n      </div>\n      \n      <div class="chatbot-content">\n        \x3c!-- Home Tab --\x3e\n        <div class="chatbot-tab-content active" data-content="home">\n          <div class="chatbot-home-content">\n            <div class="chatbot-home-welcome">\n              <h2>Welcome!</h2>\n              <p>How can we help you today?</p>\n            </div>\n            \n            <div class="chatbot-actions-grid">\n              <div class="chatbot-action-card" data-action="start-chat">\n                <span class="chatbot-action-icon">üí¨</span>\n                <div class="chatbot-action-title">Start Chat</div>\n                <div class="chatbot-action-desc">Begin a conversation with our assistant</div>\n              </div>\n              <div class="chatbot-action-card" data-action="check-products">\n                <span class="chatbot-action-icon">üè™</span>\n                <div class="chatbot-action-title">Our Products</div>\n                <div class="chatbot-action-desc">Explore our product offerings</div>\n              </div>\n              <div class="chatbot-action-card" data-action="contact-us">\n                <span class="chatbot-action-icon">üìû</span>\n                <div class="chatbot-action-title">Contact Us</div>\n                <div class="chatbot-action-desc">Get in touch with support</div>\n              </div>\n              <div class="chatbot-action-card" data-action="faq">\n                <span class="chatbot-action-icon">‚ùì</span>\n                <div class="chatbot-action-title">FAQ</div>\n                <div class="chatbot-action-desc">Find answers to common questions</div>\n              </div>\n            </div>\n            \n            <div class="chatbot-user-actions" style="display: none;">\n              <h3>Your Account</h3>\n              <div class="chatbot-user-notifications"></div>\n            </div>\n          </div>\n        </div>\n        \n        \x3c!-- Chat Tab --\x3e\n        <div class="chatbot-tab-content" data-content="chat">\n          <div class="chatbot-chat-content">\n            <div class="chatbot-messages"></div>\n            <div class="chatbot-input-area">\n              <input type="text" placeholder="${this.config.inputPlaceholder}" />\n              <button class="chatbot-send-button">${this.config.sendButtonText}</button>\n            </div>\n          </div>\n          \n          \x3c!-- Terms Overlay --\x3e\n          <div class="chatbot-terms-overlay">\n            <div class="chatbot-terms-content">\n              <div class="chatbot-terms-title">Terms & Conditions</div>\n              <div class="chatbot-terms-text">\n                Before we start, and for your protection, please don't type any account or card numbers on the screen or any of your PINs. Please also note that we will be keeping a record of this conversation for service quality purposes. I am here to help you with general inquiries about the Bank, its products and services. If you need to access your bank accounts or cards,\n              </div>\n              <div class="chatbot-terms-text">\n                Dear customer, in order to ensure the confidentiality of your data, please do not share the three numbers on the back of the credit or debit card, the OTP or the password for the smart wallet service or the Internet banking with anyone, whether by phone, text message or e-mail and in case that this data is requested by any means of communication, please contact 19666 as soon as possible.\n              </div>\n              <div class="chatbot-terms-buttons">\n                <button class="chatbot-terms-accept">I Agree</button>\n                <button class="chatbot-terms-decline">Decline</button>\n              </div>\n            </div>\n          </div>\n        </div>\n        \n        \x3c!-- Announcements Tab --\x3e\n        <div class="chatbot-tab-content" data-content="announcements">\n          <div class="chatbot-announcements-content">\n            <div class="chatbot-announcements-list"></div>\n          </div>\n        </div>\n      </div>\n      \n      <div class="chatbot-footer" style="\n        text-align: center;\n        padding: 10px;\n        font-size: 12px;\n        font-family: 'Segoe UI', sans-serif;\n        background: #fdfdfd;\n      ">\n        <div class="chatbot-tabs">\n          <button class="chatbot-tab active" data-tab="home">Home</button>\n          <button class="chatbot-tab" data-tab="chat">Chat</button>\n          <button class="chatbot-tab" data-tab="announcements">News</button>\n        </div>\n        <span style="\n            background: linear-gradient(90deg, #4a90e2, #9013fe, #ff4081);\n            -webkit-background-clip: text;\n            -webkit-text-fill-color: transparent;\n            font-weight: bold;\n            font-style: italic;\n            font-size: 1.1em;\n            animation: shimmer 3s infinite;\n            background-size: 200% auto;\n            display:inline-block;\n        ">Powered by Finova ‚ú®</span>\n      </div>\n    `,t.appendChild(a),this.elements.window=a,this.elements.messagesContainer=a.querySelector(".chatbot-messages"),this.elements.inputField=a.querySelector(".chatbot-input-area input"),this.elements.sendButton=a.querySelector(".chatbot-input-area button"),this.elements.closeButton=a.querySelector(".chatbot-header-close"),this.elements.headerTitle=a.querySelector(".chatbot-header-title"),this.elements.homeContent=a.querySelector('[data-content="home"]'),this.elements.chatContent=a.querySelector('[data-content="chat"]'),this.elements.announcementsContent=a.querySelector('[data-content="announcements"]'),this.elements.termsOverlay=a.querySelector(".chatbot-terms-overlay"),this.elements.userActions=a.querySelector(".chatbot-user-actions"),this.elements.userNotifications=a.querySelector(".chatbot-user-notifications"),this.setupEventListeners(),this.messages.forEach(t=>this.displayMessage(t,!1)),this.scrollToBottom(),this.showWidget(),this.config.autoRefresh&&this.startAutoRefresh(this.config.autoRefreshInterval||3e5)}setupEventListeners(){this.elements.closeButton.addEventListener("click",()=>this.toggleChatWindow()),this.elements.sendButton.addEventListener("click",()=>this.sendMessage()),this.elements.inputField.addEventListener("keypress",t=>{"Enter"===t.key&&this.sendMessage()});this.elements.window.querySelectorAll(".chatbot-tab").forEach(t=>{t.addEventListener("click",()=>{const e=t.dataset.tab;this.switchTab(e)})});this.elements.window.querySelectorAll(".chatbot-action-card").forEach(t=>{t.addEventListener("click",()=>{const e=t.dataset.action;this.handleHomeAction(e)})});const t=this.elements.window.querySelector(".chatbot-terms-accept"),e=this.elements.window.querySelector(".chatbot-terms-decline");t.addEventListener("click",()=>{this.termsAccepted=!0,this.elements.termsOverlay.style.display="none"}),e.addEventListener("click",()=>{this.switchTab("home")})}switchTab(t){this.elements.window.querySelectorAll(".chatbot-tab").forEach(e=>{e.classList.toggle("active",e.dataset.tab===t)});this.elements.window.querySelectorAll(".chatbot-tab-content").forEach(e=>{e.classList.toggle("active",e.dataset.content===t)}),this.currentTab=t,"chat"===t&&(this.termsAccepted||(this.elements.termsOverlay.style.display="flex"),setTimeout(()=>{this.scrollToBottom()},100)),"announcements"===t&&0===this.announcements.length&&this.loadAnnouncements()}handleHomeAction(t){switch(t){case"start-chat":this.switchTab("chat");break;case"check-products":this.switchTab("chat"),this.termsAccepted&&setTimeout(()=>{this.sendMessage("Show me your products","/list_product_list")},500);break;case"contact-us":this.switchTab("chat"),this.termsAccepted&&setTimeout(()=>{this.sendMessage("I need to contact support","/contact_support")},500);break;case"faq":this.switchTab("chat"),this.termsAccepted&&setTimeout(()=>{this.sendMessage("Show me frequently asked questions","/show_faq")},500)}}async loadUserNotifications(){if(c)try{const t=await fetch(this.config.startingUrl,{method:"GET",headers:{"Content-Type":"application/json",authorization:`Bearer ${c}`}});if(t.ok){const e=await t.json();this.userNotifications=e,this.renderUserNotifications()}}catch(t){console.error("Failed to load user notifications:",t)}}renderUserNotifications(){if(!this.elements.userActions||!this.elements.userNotifications)return;this.elements.userNotifications.innerHTML="";const t=[];this.userNotifications.forEach(e=>{e.text&&t.push({text:e.text,url:null}),e.buttons&&e.buttons.forEach(e=>{t.push({text:e.title,url:e.url})})}),0!==t.length?(this.elements.userActions.style.display="block",t.forEach(t=>{const e=document.createElement("div");e.className="chatbot-notification-card";const o=document.createElement("div");if(o.className="chatbot-notification-text",o.textContent=t.text,e.appendChild(o),t.url){const o=document.createElement("button");o.className="chatbot-notification-button",o.textContent="View Details",o.onclick=()=>window.open(t.url,"_blank"),e.appendChild(o)}this.elements.userNotifications.appendChild(e)})):this.elements.userActions.style.display="none"}updateUIElements(){this.elements.headerTitle&&(this.elements.headerTitle.textContent=this.config.botName),this.elements.inputField&&(this.elements.inputField.placeholder=this.config.inputPlaceholder),this.elements.sendButton&&(this.elements.sendButton.textContent=this.config.sendButtonText)}showWidget(){console.log("Attempting to show widget..."),this.elements.container.style.display="block",this.elements.container.style.opacity="1",this.elements.container.style.zIndex="99999";const t=this.config.style?.animation||{type:"fade-in",duration:300};console.log("Using animation:",t),this.elements.container.style.display="block","fade-in"===t.type?setTimeout(()=>{this.elements.container.style.opacity="1"},50):"slide-up"===t.type?(this.elements.container.style.transform="translateY(20px)",setTimeout(()=>{this.elements.container.style.transition=`all ${t.duration}ms ease`,this.elements.container.style.opacity="1",this.elements.container.style.transform="translateY(0)"},50)):this.elements.container.style.opacity="1"}startAutoRefresh(t=3e5){this.stopAutoRefresh(),this.refreshInterval=setInterval(()=>this.refreshConfig(),t),this.log(`Started auto-refresh every ${t/1e3} seconds`)}stopAutoRefresh(){this.refreshInterval&&(clearInterval(this.refreshInterval),this.refreshInterval=null)}initSession(){this.sessionId=e("chatbot_session_id"),this.sessionId||(this.sessionId="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){const e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)}),t("chatbot_session_id",this.sessionId)),this.messages=e(`chatbot_conversation_${this.sessionId}`)||[]}displayMessage(e,o=!0){const n=document.createElement("div");if(n.classList.add("chatbot-message","user"===e.sender?"user":"bot"),e.text){const t=document.createElement("div");t.innerHTML=function(t){if(!t)return"";let e=t;return e=e.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>"),e=e.replace(/__(.*?)__/g,"<strong>$1</strong>"),e=e.replace(/\*(.*?)\*/g,"<em>$1</em>"),e=e.replace(/_(.*?)_/g,"<em>$1</em>"),e=e.replace(/\[([^\]]+)\]\(([^)]+)\)/g,'<a href="$2" target="_blank" rel="noopener noreferrer">$1</a>'),e=e.replace(/\n/g,"<br/>"),e}(e.text),n.appendChild(t)}if(e.buttons?.length>0){const t=s(e,"buttons",this.sendMessage.bind(this));t&&n.appendChild(t)}if(e.image){const t=s(e,"image");t&&n.appendChild(t)}if(e.video){const t=s(e,"video");t&&n.appendChild(t)}if(e.carousel?.length>0){const t=s(e,"carousel",this.sendMessage.bind(this));t&&n.appendChild(t)}if(e.custom){const t=i(e.custom,this.sendMessage.bind(this));t&&n.appendChild(t)}this.elements.messagesContainer.appendChild(n),o&&(this.messages.push(e),t(`chatbot_conversation_${this.sessionId}`,this.messages)),this.scrollToBottom()}async sendSuggestions(){try{const t=await fetch(this.config.startingUrl,{method:"GET",headers:{"Content-Type":"application/json",authorization:`Bearer ${c}`}});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const e=await t.json();e?.length>0?(console.log(c+" --- IGNORE ---"),e.forEach(t=>this.displayMessage({sender:"bot",...t}))):this.displayMessage({sender:"bot",text:"Sorry, I didn't get a response."})}catch(t){console.error("Chatbot error:",t),this.displayMessage({sender:"bot",text:"I'm having trouble connecting. Please try again later."})}}async sendMessage(t=null,e=null){let o=t||this.elements.inputField.value.trim();if(!o&&!e)return;const n={sender:"user",text:o};this.displayMessage(n),this.elements.inputField.value="";const a={sender:this.sessionId,message:o,...e&&{customData:{payload:e}}};try{const t=await fetch(this.config.botUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const e=await t.json();e?.length>0?(console.log(c+" --- IGNORE ---"),e.forEach(t=>this.displayMessage({sender:"bot",...t}))):this.displayMessage({sender:"bot",text:"Sorry, I didn't get a response."})}catch(t){console.error("Chatbot error:",t),this.displayMessage({sender:"bot",text:"I'm having trouble connecting. Please try again later."})}}toggleChatWindow(){this.isOpen=!this.isOpen,this.elements.window.classList.toggle("open",this.isOpen),this.elements.bubble.classList.toggle("hidden",this.isOpen),this.isOpen&&(l&&c&&(l=!1,this.sendSuggestions()),this.elements.inputField.focus(),this.scrollToBottom())}scrollToBottom(){this.elements.messagesContainer&&(this.elements.messagesContainer.scrollTop=this.elements.messagesContainer.scrollHeight)}},window.ChatbotSDK.init(),window.ChatbotSDK.init(),window.ChatbotSDK.init(),document.getElementById("chatbotContainer"),window.setChatbotAuthToken=function(t){c=t,console.log("Chatbot SDK received a token. Saved locally."),console.log("Simulated Chatbot Auth Token:",c),window.ChatbotSDK&&window.ChatbotSDK.isOpen&&c&&l&&(l=!1,window.ChatbotSDK.sendSuggestions())},console.log("Chatbot SDK loaded. Chatbot is running but currently unauthenticated.")}();
//# sourceMappingURL=chatbot.bundle.js.map
