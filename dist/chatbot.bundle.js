!function(){"use strict";function t(t,e){try{localStorage.setItem(t,JSON.stringify(e))}catch(t){console.warn("Chatbot SDK: localStorage write error:",t)}}function e(t){try{const e=localStorage.getItem(t);return e?JSON.parse(e):null}catch(t){return console.warn("Chatbot SDK: localStorage read error:",t),null}}function o(t,e,o=null){switch(e){case"buttons":return a(t.buttons,o);case"image":return function(t){if(!t)return null;const e=document.createElement("img");return e.src=t,e.className="chatbot-image",e}(t.image);case"video":return function(t){if(!t)return null;const e=document.createElement("video");return e.src=t,e.controls=!0,e.className="chatbot-video",e}(t.video);case"carousel":return function(t,e){if(!t||0===t.length)return null;const o=document.createElement("div");return o.className="chatbot-carousel-container",t.forEach(t=>{const n=document.createElement("div");if(n.className="chatbot-carousel-card",t.image_url){const e=document.createElement("img");e.src=t.image_url,e.className="chatbot-carousel-card-image",n.appendChild(e)}const i=document.createElement("div");i.className="chatbot-carousel-card-content";const s=document.createElement("h3");if(s.className="chatbot-carousel-card-title",s.textContent=t.title,i.appendChild(s),t.subtitle){const e=document.createElement("p");e.className="chatbot-carousel-card-subtitle",e.textContent=t.subtitle,i.appendChild(e)}if(t.buttons&&t.buttons.length>0){const o=a(t.buttons,e);o&&i.appendChild(o)}n.appendChild(i),o.appendChild(n)}),o}(t.carousel,o);default:return null}}function n(t,e=null){if(!t)return null;const o=document.createElement("div");if(o.classList.add("chatbot-custom-payload"),t.locations){const e=function(t){if(!t||0===t.length)return null;const e=document.createElement("div");return e.className="chatbot-map-container",e.style.width="100%",e.style.height="300px",e.style.borderRadius="8px",e.style.marginTop="10px",e.style.overflow="hidden",e.textContent="Map requires Google Maps API Key.",e.style.backgroundColor="#f8d7da",e.style.color="#721c24",e.style.padding="10px",e.style.textAlign="center",e}(t.locations);e&&o.appendChild(e)}if(t.faq_list){const e=function(t){if(!t||0===t.length)return null;const e=document.createElement("div");return e.className="chatbot-faq-list-container",e.style.marginTop="10px",t.forEach((t,o)=>{const n=document.createElement("div");n.className="chatbot-faq-item";const a=document.createElement("div");a.className="chatbot-faq-question",a.textContent=t.question,n.appendChild(a);const i=document.createElement("div");i.className="chatbot-faq-answer",i.innerHTML=t.answer,n.appendChild(i),a.addEventListener("click",()=>{n.classList.toggle("expanded")}),e.appendChild(n)}),e}(t.faq_list);e&&o.appendChild(e)}if(t.table){const e=function(t){if(!t||!t.headers||!t.rows)return null;const e=document.createElement("div");e.className="chatbot-table-container";const o=document.createElement("table");o.className="chatbot-table";const n=document.createElement("thead"),a=document.createElement("tr");t.headers.forEach(t=>{const e=document.createElement("th");e.textContent=t,a.appendChild(e)}),n.appendChild(a),o.appendChild(n);const i=document.createElement("tbody");return t.rows.forEach(t=>{const e=document.createElement("tr");t.forEach(t=>{const o=document.createElement("td");o.textContent=t,e.appendChild(o)}),i.appendChild(e)}),o.appendChild(i),e.appendChild(o),e}(t.table);e&&o.appendChild(e)}if(t.rating){const n=function(t,e){if(!t||!t.scale)return null;const o=document.createElement("div");o.className="chatbot-rating-container";const n=document.createElement("div");n.className="chatbot-rating-title",n.textContent=t.title||"Please rate:",o.appendChild(n);const a=document.createElement("div");a.className="chatbot-stars";let i=0;for(let o=t.scale;o>=1;o--){const t=document.createElement("span");t.innerHTML="&#9733;",t.dataset.value=o,t.addEventListener("mouseover",()=>{a.querySelectorAll("span").forEach(t=>{parseInt(t.dataset.value)>=o?t.classList.add("hover"):t.classList.remove("hover")})}),t.addEventListener("mouseout",()=>{a.querySelectorAll("span").forEach(t=>t.classList.remove("hover"))}),t.addEventListener("click",()=>{i=o,a.querySelectorAll("span").forEach(t=>{parseInt(t.dataset.value)<=i?t.classList.add("selected"):t.classList.remove("selected")}),e&&e(`Rated ${i} stars`,`/rate_service{"rating":${i}}`)}),a.appendChild(t)}return o.appendChild(a),o}(t.rating,e);n&&o.appendChild(n)}if(t.forms){const n=function(t,e){if(!t||!t.fields||!t.submit_payload)return null;const o=document.createElement("div");if(o.className="chatbot-form-container",t.title){const e=document.createElement("div");e.className="chatbot-form-title",e.textContent=t.title,o.appendChild(e)}const n=document.createElement("form");n.addEventListener("submit",o=>{o.preventDefault();const a={};if(t.fields.forEach(t=>{const e=n.querySelector(`[name="${t.field_name}"]`);e&&(a[t.field_name]=e.value)}),e){const o=`Submitted form: ${Object.entries(a).map(([t,e])=>`${t}: ${e}`).join(", ")}`,n=`${t.submit_payload}${JSON.stringify(a)}`;e(o,n)}n.querySelectorAll("input, select, button").forEach(t=>t.disabled=!0)}),t.fields.forEach(t=>{const e=document.createElement("div");e.className="chatbot-form-field";const o=document.createElement("label");let a;o.textContent=t.label,o.htmlFor=`chatbot-form-${t.field_name}`,e.appendChild(o),"select"===t.type&&t.options?(a=document.createElement("select"),t.options.forEach(t=>{const e=document.createElement("option");e.value=t,e.textContent=t,a.appendChild(e)})):(a=document.createElement("input"),a.type=t.type),a.id=`chatbot-form-${t.field_name}`,a.name=t.field_name,a.placeholder=t.placeholder||"",a.required=t.required||!1,e.appendChild(a),n.appendChild(e)});const a=document.createElement("button");return a.type="submit",a.className="chatbot-form-submit-button",a.textContent=t.submit_button_text||"Submit",n.appendChild(a),o.appendChild(n),o}(t.forms,e);n&&o.appendChild(n)}return o.children.length>0?o:null}function a(t,e){if(!t||0===t.length)return null;const o=document.createElement("div");return o.className="chatbot-button-container",t.forEach(t=>{const n=document.createElement("button");n.textContent=t.title,t.button_color&&(n.style.backgroundColor=t.button_color,n.style.color="white",n.style.borderColor=t.button_color),t.payload?n.addEventListener("click",()=>{o.querySelectorAll("button").forEach(t=>t.disabled=!0),e&&e(t.title,t.payload)}):t.url&&n.addEventListener("click",()=>window.open(t.url,"_blank")),o.appendChild(n)}),o}!function(t,e){void 0===e&&(e={});var o=e.insertAt;if(t&&"undefined"!=typeof document){var n=document.head||document.getElementsByTagName("head")[0],a=document.createElement("style");a.type="text/css","top"===o&&n.firstChild?n.insertBefore(a,n.firstChild):n.appendChild(a),a.styleSheet?a.styleSheet.cssText=t:a.appendChild(document.createTextNode(t))}}('#chatbot-widget-container{bottom:20px;font-family:Arial,sans-serif;position:fixed;right:20px;z-index:1000}.chatbot-bubble{align-items:center;background-color:var(--chatbot-theme-color,#2196f3);border-radius:50%;box-shadow:0 2px 10px rgba(0,0,0,.2);color:#fff;cursor:pointer;display:flex;height:60px;justify-content:center;transition:transform .3s ease-in-out;width:60px}.chatbot-bubble.hidden{display:none}.chatbot-bubble:hover{transform:scale(1.05)}.chatbot-bubble svg{height:30px;width:30px}.chatbot-window{background-color:#fff;border-radius:8px;bottom:90px;box-shadow:0 5px 15px rgba(0,0,0,.3);display:flex;flex-direction:column;height:500px;opacity:0;overflow:hidden;pointer-events:none;position:fixed;right:20px;transform:translateY(100%) scale(.8);transition:transform .3s ease-in-out,opacity .3s ease-in-out;width:350px}.chatbot-window.open{opacity:1;pointer-events:auto;transform:translateY(0) scale(1)}.chatbot-header{align-items:center;background-color:var(--chatbot-theme-color,#2196f3);color:#fff;display:flex;flex-shrink:0;font-size:1.1em;font-weight:700;justify-content:space-between;padding:15px}.chatbot-header-close{background:none;border:none;color:#fff;cursor:pointer;font-size:1.5em}.chatbot-messages{background-color:#f7f7f7;flex-grow:1;overflow-y:auto;padding:15px}.chatbot-input-area{background-color:#fff;border-top:1px solid #eee;display:flex;flex-shrink:0;padding:10px}.chatbot-input-area input{border:1px solid #ccc;border-radius:20px;flex-grow:1;font-size:.9em;margin-right:10px;padding:10px 15px}.chatbot-input-area button{background-color:var(--chatbot-theme-color,#2196f3);border:none;border-radius:20px;color:#fff;cursor:pointer;font-size:.9em;padding:10px 15px}.chatbot-message{word-wrap:break-word;border-radius:15px;margin-bottom:10px;max-width:80%;padding:10px 15px}.chatbot-message.user{background-color:var(--chatbot-theme-color,#2196f3);border-bottom-right-radius:2px;color:#fff;margin-left:auto}.chatbot-message.bot{background-color:#e0e0e0;border-bottom-left-radius:2px;color:#333;margin-right:auto}.chatbot-message a{color:var(--chatbot-theme-color,#2196f3);text-decoration:underline}.chatbot-message.user a{color:#fff}.chatbot-button-container{display:flex;flex-wrap:wrap;gap:8px;margin-top:10px}.chatbot-button-container button{background-color:#fff;border:1px solid var(--chatbot-button-border-color,#ccc);border-radius:20px;cursor:pointer;font-size:.85em;padding:8px 12px;transition:background-color .2s,color .2s}.chatbot-button-container button:hover{background-color:#eee}.chatbot-image{border-radius:5px;height:auto;margin-top:8px;max-width:100%}.chatbot-video{height:auto;margin-top:8px;min-height:200px;width:100%}.chatbot-carousel-container{-webkit-overflow-scrolling:touch;display:flex;gap:15px;margin-top:8px;overflow-x:auto;padding:10px 0;scrollbar-width:none}.chatbot-carousel-container::-webkit-scrollbar{display:none}.chatbot-carousel-card{background-color:#fff;border-radius:8px;box-shadow:0 2px 8px rgba(0,0,0,.1);display:flex;flex:0 0 220px;flex-direction:column;min-height:250px;overflow:hidden}.chatbot-carousel-card-image{height:120px;object-fit:cover;width:100%}.chatbot-carousel-card-content{display:flex;flex-direction:column;flex-grow:1;padding:10px}.chatbot-carousel-card-title{font-size:1.05em;font-weight:700;margin-bottom:5px}.chatbot-carousel-card-subtitle{color:#666;font-size:.9em;margin-bottom:10px}.chatbot-carousel-card .chatbot-button-container{flex-direction:column;margin-top:auto}.chatbot-faq-item{border:1px solid #eee;border-radius:5px;margin-bottom:10px;overflow:hidden}.chatbot-faq-question{align-items:center;background-color:#f0f0f0;cursor:pointer;display:flex;font-weight:700;justify-content:space-between;padding:10px 15px}.chatbot-faq-question:after{content:"+";font-size:1.2em;transition:transform .2s}.chatbot-faq-item.expanded .chatbot-faq-question:after{content:"-";transform:rotate(180deg)}.chatbot-faq-answer{background-color:#fff;border-top:1px solid #eee;display:none;padding:10px 15px}.chatbot-faq-item.expanded .chatbot-faq-answer{display:block}.chatbot-table-container{background-color:#fff;border:1px solid #eee;border-radius:5px;margin-top:8px;overflow-x:auto}.chatbot-table{border-collapse:collapse;width:100%}.chatbot-table td,.chatbot-table th{border:1px solid #eee;padding:10px;text-align:left}.chatbot-table th{background-color:#f0f0f0;font-weight:700}.chatbot-rating-container{margin-top:15px;text-align:center}.chatbot-rating-title{font-weight:700;margin-bottom:10px}.chatbot-stars{direction:rtl;display:inline-block;unicode-bidi:bidi-override}.chatbot-stars>span{color:#ccc;cursor:pointer;display:inline-block;font-size:2.5em;position:relative;width:1.1em}.chatbot-stars>span.selected,.chatbot-stars>span.selected~span,.chatbot-stars>span:hover,.chatbot-stars>span:hover~span{color:gold}.chatbot-form-container{background-color:#fff;border-radius:8px;box-shadow:0 2px 5px rgba(0,0,0,.05);margin-top:10px;padding:15px}.chatbot-form-title{font-size:1.1em;font-weight:700;margin-bottom:15px}.chatbot-form-field{margin-bottom:15px}.chatbot-form-field label{display:block;font-size:.9em;font-weight:700;margin-bottom:5px}.chatbot-form-field input[type=email],.chatbot-form-field input[type=text],.chatbot-form-field select{border:1px solid #ccc;border-radius:5px;font-size:.9em;padding:10px;width:calc(100% - 22px)}.chatbot-form-submit-button{background-color:var(--chatbot-theme-color,#2196f3);border:none;border-radius:5px;box-sizing:border-box;color:#fff;cursor:pointer;font-size:1em;padding:12px 20px;width:100%}');window.ChatbotSDK=new class{constructor(){this.config={},this.isOpen=!1,this.sessionId=null,this.messages=[],this.elements={}}initConfig(t={}){const e=document.querySelector('script[src*="chatbot.bundle.js"]');let o={};if(e){const t=e.getAttribute("chatbot-config");if(t)try{o=JSON.parse(t)}catch(t){console.error("Chatbot SDK: Invalid JSON in chatbot-config attribute",t)}}this.config={...o,...t},this.config.botUrl=this.config.botUrl||"http://0.0.0.0:8000/chat",this.config.themeColor=this.config.themeColor||"#020c15ff",this.config.position=this.config.position||"bottom-right",this.config.botName=this.config.botName||"Chatbot",document.documentElement.style.setProperty("--chatbot-theme-color",this.config.themeColor)}initSession(){this.sessionId=e("chatbot_session_id"),this.sessionId||(this.sessionId="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){const e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)}),t("chatbot_session_id",this.sessionId)),this.messages=e(`chatbot_conversation_${this.sessionId}`)||[]}createWidgetUI(){const t=document.createElement("div");t.id="chatbot-widget-container",t.classList.add(`chatbot-position-${this.config.position}`),t.style.display="none",t.style.opacity="0",document.body.appendChild(t),this.elements.container=t;const e=document.createElement("div");e.className="chatbot-bubble",e.innerHTML='\n      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white">\n        <path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-2 12H6v-2h12v2zm0-3H6V9h12v2zm0-3H6V6h12v2z"/>\n      </svg>\n    ',e.addEventListener("click",()=>this.toggleChatWindow()),t.appendChild(e),this.elements.bubble=e;const o=document.createElement("div");o.className="chatbot-window",o.innerHTML=`\n      <div class="chatbot-header">\n        <span class="chatbot-header-title">${this.config.botName}</span>\n        <button class="chatbot-header-close">&times;</button>\n      </div>\n      <div class="chatbot-messages"></div>\n      <div class="chatbot-input-area">\n        <input type="text" placeholder="Type your message..." />\n        <button class="chatbot-send-button">Send</button>\n      </div>\n    `,t.appendChild(o),this.elements.window=o,this.elements.messagesContainer=o.querySelector(".chatbot-messages"),this.elements.inputField=o.querySelector(".chatbot-input-area input"),this.elements.sendButton=o.querySelector(".chatbot-send-button"),this.elements.closeButton=o.querySelector(".chatbot-header-close"),this.elements.closeButton.addEventListener("click",()=>this.toggleChatWindow()),this.elements.sendButton.addEventListener("click",()=>this.sendMessage()),this.elements.inputField.addEventListener("keypress",t=>{"Enter"===t.key&&this.sendMessage()}),this.messages.forEach(t=>this.displayMessage(t,!1)),this.scrollToBottom(),this.showWidget()}showWidget(){const t=this.config.appearanceAnimation||{type:"fade-in",duration:500};this.elements.container.style.display="block","fade-in"===t.type?(this.elements.container.style.transition=`opacity ${t.duration/1e3}s ease-in-out`,setTimeout(()=>{this.elements.container.style.opacity="1"},50)):this.elements.container.style.opacity="1"}toggleChatWindow(){this.isOpen=!this.isOpen,this.elements.window.classList.toggle("open",this.isOpen),this.elements.bubble.classList.toggle("hidden",this.isOpen),this.isOpen&&(this.elements.inputField.focus(),this.scrollToBottom())}displayMessage(e,a=!0){const i=document.createElement("div");if(i.classList.add("chatbot-message","user"===e.sender?"user":"bot"),e.text){const t=document.createElement("div");t.innerHTML=function(t){if(!t)return"";let e=t;return e=e.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>"),e=e.replace(/__(.*?)__/g,"<strong>$1</strong>"),e=e.replace(/\*(.*?)\*/g,"<em>$1</em>"),e=e.replace(/_(.*?)_/g,"<em>$1</em>"),e=e.replace(/\[([^\]]+)\]\(([^)]+)\)/g,'<a href="$2" target="_blank" rel="noopener noreferrer">$1</a>'),e=e.replace(/\n/g,"<br/>"),e}(e.text),i.appendChild(t)}if(e.buttons&&e.buttons.length>0){const t=o(e,"buttons",this.sendMessage.bind(this));t&&i.appendChild(t)}if(e.image){const t=o(e,"image");t&&i.appendChild(t)}if(e.video){const t=o(e,"video");t&&i.appendChild(t)}if(e.carousel&&e.carousel.length>0){const t=o(e,"carousel",this.sendMessage.bind(this));t&&i.appendChild(t)}if(e.custom){const t=n(e.custom,this.sendMessage.bind(this));t&&i.appendChild(t)}this.elements.messagesContainer.appendChild(i),a&&(this.messages.push(e),t(`chatbot_conversation_${this.sessionId}`,this.messages)),this.scrollToBottom()}async sendMessage(t=null,e=null){let o=t||this.elements.inputField.value.trim();if(!o&&!e)return;const n={sender:"user",text:o};this.displayMessage(n),this.elements.inputField.value="";const a={sender:this.sessionId,message:o,...e&&{customData:{payload:e}}};try{const t=await fetch(this.config.botUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const e=await t.json();e&&e.length>0?e.forEach(t=>{this.displayMessage({sender:"bot",...t})}):this.displayMessage({sender:"bot",text:"Sorry, I didn't get a response from the bot."})}catch(t){console.error("Chatbot SDK: Error communicating with bot backend:",t),this.displayMessage({sender:"bot",text:"Sorry, I'm having trouble connecting right now. Please try again later."})}}scrollToBottom(){this.elements.messagesContainer.scrollTop=this.elements.messagesContainer.scrollHeight}async init(){if(this.initConfig(),this.config.appearanceApiUrl)try{console.log(`Chatbot SDK: Fetching appearance config from ${this.config.appearanceApiUrl}`);const t=await fetch(this.config.appearanceApiUrl);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const e=await t.json();e.showChatbot?(this.initConfig(e.initialConfig),e.appearanceAnimation&&(this.config.appearanceAnimation=e.appearanceAnimation),this.initSession(),document.addEventListener("DOMContentLoaded",()=>this.createWidgetUI())):console.log("Chatbot SDK: showChatbot is false from API. Not displaying widget.")}catch(t){console.error("Chatbot SDK: Error fetching appearance configuration:",t),console.log("Chatbot SDK: Not displaying widget due to API error.")}else console.log("Chatbot SDK: No appearance API URL provided. Displaying with script tag config."),this.initSession(),document.addEventListener("DOMContentLoaded",()=>this.createWidgetUI())}},window.ChatbotSDK.init()}();
//# sourceMappingURL=chatbot.bundle.js.map
