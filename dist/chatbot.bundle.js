!function(){"use strict";function t(t,e){try{localStorage.setItem(t,JSON.stringify(e))}catch(t){console.warn("Chatbot SDK: localStorage write error:",t)}}function e(t){try{const e=localStorage.getItem(t);return e?JSON.parse(e):null}catch(t){return console.warn("Chatbot SDK: localStorage read error:",t),null}}!function(t,e){void 0===e&&(e={});var o=e.insertAt;if(t&&"undefined"!=typeof document){var a=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css","top"===o&&a.firstChild?a.insertBefore(n,a.firstChild):a.appendChild(n),n.styleSheet?n.styleSheet.cssText=t:n.appendChild(document.createTextNode(t))}}('#chatbot-widget-container{bottom:20px;font-family:Inter,-apple-system,BlinkMacSystemFont,sans-serif;position:fixed;right:20px;z-index:1000}.chatbot-bubble{align-items:center;animation:chatbot-pulse 2s cubic-bezier(.66,0,0,1) infinite;background-color:var(--chatbot-theme-color,#1261a0);border-radius:50%;box-shadow:0 4px 10px rgba(0,0,0,.2);color:#fff;cursor:pointer;display:flex;height:60px;justify-content:center;overflow:hidden;position:relative;transition:transform .2s ease-in-out,box-shadow .2s ease-in-out;width:60px}.chatbot-bubble:hover{box-shadow:0 6px 12px rgba(0,0,0,.25)}.chatbot-bubble:after{border-left:10px solid transparent;border-right:10px solid transparent;border-top:10px solid var(--chatbot-theme-color,#1261a0);bottom:-10px;content:"";height:0;position:absolute;right:15px;width:0}.chatbot-position-bottom-left .chatbot-bubble:after{left:15px;right:auto}@keyframes chatbot-pulse{0%{box-shadow:0 0 0 0 var(--chatbot-theme-color-faded,rgba(18,97,160,.7))}to{box-shadow:0 0 0 20px var(--chatbot-theme-color-faded,rgba(18,97,160,0))}}.chatbot-bubble.hidden{display:none}.chatbot-bubble:hover{background-color:var(--chatbot-theme-color-hover,#5a6fd1);transform:scale(1.05)}.chatbot-bubble svg{height:24px;width:24px}.chatbot-window{background-color:#fff;border-radius:12px;bottom:90px;box-shadow:0 10px 25px rgba(0,0,0,.15);display:flex;flex-direction:column;height:500px;max-height:80vh;opacity:0;overflow:hidden;pointer-events:none;position:fixed;right:20px;transform:translateY(100%) scale(.9);transition:transform .3s ease,opacity .3s ease;width:350px}.chatbot-window.open{opacity:1;pointer-events:auto;transform:translateY(0) scale(1)}.chatbot-header{align-items:center;background-color:var(--chatbot-theme-color,#667eea);color:#fff;display:flex;flex-shrink:0;font-size:1.1em;font-weight:600;justify-content:space-between;padding:6px 12px}.chatbot-header-close{background:none;border:none;color:#fff;cursor:pointer;font-size:1.5em;line-height:1;padding:4px}.chatbot-messages{background-color:#f8f9fa;display:flex;flex-direction:column;flex-grow:1;gap:8px;overflow-y:auto;padding:12px}.chatbot-input-area{background-color:#fff;border-top:1px solid #e2e8f0;display:flex;flex-shrink:0;padding:12px}.chatbot-input-area input{border:1px solid #e2e8f0;border-radius:20px;flex-grow:1;font-size:.9em;margin-right:8px;outline:none;padding:10px 16px;transition:border-color .3s}.chatbot-input-area input:focus{border-color:var(--chatbot-theme-color,#667eea)}.chatbot-input-area button{background-color:var(--chatbot-theme-color,#667eea);border:none;border-radius:20px;color:#fff;cursor:pointer;font-size:.9em;font-weight:500;padding:10px 16px;transition:background-color .3s}.chatbot-input-area button:hover{background-color:var(--chatbot-theme-color-hover,#5a6fd1)}.chatbot-message{word-wrap:break-word;border-radius:12px;box-shadow:0 1px 3px rgba(0,0,0,.1);font-size:.95em;line-height:1.4;margin-bottom:8px;max-width:80%;padding:10px 14px}.chatbot-message.user{background-color:var(--chatbot-theme-color,#667eea);border-bottom-right-radius:4px;color:#fff;margin-left:auto}.chatbot-message.bot{background-color:#fff;border:1px solid #e2e8f0;border-bottom-left-radius:4px;color:#333;margin-right:auto}.chatbot-message a{color:var(--chatbot-theme-color,#667eea);text-decoration:underline}.chatbot-message.user a{color:#fff;text-decoration:underline}.chatbot-button-container{display:flex;flex-wrap:wrap;gap:8px;margin-top:8px}.chatbot-button-container button{background-color:var(--chatbot-theme-color,#667eea);border:none;border-radius:20px;color:#fff;cursor:pointer;flex-grow:1;font-size:.85em;padding:8px 12px;transition:all .2s}.chatbot-button-container button:hover{background-color:var(--chatbot-theme-color-hover,#5a6fd1);transform:translateY(-1px)}.chatbot-image{border:1px solid #e2e8f0;border-radius:8px;height:auto;margin-top:8px;max-width:100%}.chatbot-video{background-color:#000;border-radius:8px;height:auto;margin-top:8px;max-height:200px;width:100%}.chatbot-carousel-container{display:flex;gap:12px;margin-top:8px;overflow-x:auto;padding:8px 0;scrollbar-width:none}.chatbot-carousel-container::-webkit-scrollbar{display:none}.chatbot-carousel-card{background-color:#fff;border:1px solid #e2e8f0;border-radius:8px;box-shadow:0 2px 8px rgba(0,0,0,.1);display:flex;flex:0 0 220px;flex-direction:column;overflow:hidden}.chatbot-carousel-card-image{height:120px;object-fit:cover;width:100%}.chatbot-carousel-card-content{display:flex;flex-direction:column;flex-grow:1;padding:12px}.chatbot-carousel-card-title{font-size:.95em;font-weight:600;margin-bottom:4px}.chatbot-carousel-card-subtitle{color:#666;font-size:.85em;margin-bottom:8px}.chatbot-faq-list-container{margin-top:8px}.chatbot-faq-item{border:1px solid #e2e8f0;border-radius:8px;margin-bottom:8px;overflow:hidden}.chatbot-faq-question{align-items:center;background-color:#f8f9fa;cursor:pointer;display:flex;font-size:.9em;font-weight:500;justify-content:space-between;padding:10px 12px}.chatbot-faq-question:after{content:"+";font-size:1.1em}.chatbot-faq-item.expanded .chatbot-faq-question:after{content:"-"}.chatbot-faq-answer{background-color:#fff;border-top:1px solid #e2e8f0;display:none;font-size:.85em;line-height:1.5;padding:10px 12px}.chatbot-faq-item.expanded .chatbot-faq-answer{display:block}.chatbot-table-container{background-color:#fff;border:1px solid #e2e8f0;border-radius:8px;margin-top:8px;overflow-x:auto}.chatbot-table{border-collapse:collapse;font-size:.85em;width:100%}.chatbot-table td,.chatbot-table th{border:1px solid #e2e8f0;padding:8px 12px;text-align:left}.chatbot-table th{background-color:#f8f9fa;font-weight:600}.chatbot-rating-container{background-color:#fff;border:1px solid #e2e8f0;border-radius:8px;margin-top:12px;padding:8px;text-align:center}.chatbot-rating-title{font-size:.9em;font-weight:500;margin-bottom:8px}.chatbot-stars{direction:rtl;display:inline-block;unicode-bidi:bidi-override}.chatbot-stars>span{color:#e2e8f0;cursor:pointer;display:inline-block;font-size:1.8em;position:relative;transition:color .2s;width:1.1em}.chatbot-stars>span.selected,.chatbot-stars>span.selected~span,.chatbot-stars>span:hover,.chatbot-stars>span:hover~span{color:#ffc107}.chatbot-form-container{background-color:#fff;border:1px solid #e2e8f0;border-radius:8px;margin-top:8px;padding:12px}.chatbot-form-title{font-size:.95em;font-weight:500;margin-bottom:12px}.chatbot-form-field{margin-bottom:12px}.chatbot-form-field label{display:block;font-size:.85em;font-weight:500;margin-bottom:4px}.chatbot-form-field input[type=email],.chatbot-form-field input[type=text],.chatbot-form-field select{border:1px solid #e2e8f0;border-radius:6px;font-size:.9em;padding:8px 12px;transition:border-color .3s;width:100%}.chatbot-form-field input[type=email]:focus,.chatbot-form-field input[type=text]:focus,.chatbot-form-field select:focus{border-color:var(--chatbot-theme-color,#667eea);outline:none}.chatbot-form-submit-button{background-color:var(--chatbot-theme-color,#667eea);border:none;border-radius:6px;color:#fff;cursor:pointer;font-size:.9em;font-weight:500;margin-top:8px;padding:10px;transition:background-color .3s;width:100%}.chatbot-form-submit-button:hover{background-color:var(--chatbot-theme-color-hover,#5a6fd1)}.chatbot-location-cards{display:grid;gap:12px;grid-template-columns:1fr;margin-top:8px}.chatbot-location-card{background-color:#fff;border:1px solid #e2e8f0;border-radius:8px;box-shadow:0 2px 4px rgba(0,0,0,.05);max-width:100%;overflow:hidden}.chatbot-location-map{background-color:#f8f9fa;height:120px;object-fit:cover;width:100%}.chatbot-location-body{padding:12px}.chatbot-location-title{color:#333;font-size:.9em;font-weight:600;margin-bottom:4px}.chatbot-location-address{color:#666;font-size:.8em;line-height:1.4;margin-bottom:8px}.chatbot-location-button{color:var(--chatbot-theme-color,#667eea);display:inline-block;font-size:.8em;font-weight:500;padding:4px 0;text-decoration:none;transition:color .2s}.chatbot-location-button:hover{color:var(--chatbot-theme-color-hover,#5a6fd1);text-decoration:underline}.chatbot-location-card img{display:block;height:auto;max-width:100%}.chatbot-messages::-webkit-scrollbar{width:6px}.chatbot-messages::-webkit-scrollbar-track{background:#f1f1f1;border-radius:3px}.chatbot-messages::-webkit-scrollbar-thumb{background:#c1c1c1;border-radius:3px}.chatbot-messages::-webkit-scrollbar-thumb:hover{background:#a8a8a8}.chatbot-typing-indicator{align-items:center;background-color:#fff;border:1px solid #e2e8f0;border-radius:12px;display:flex;margin-bottom:8px;padding:8px 12px;width:fit-content}.chatbot-typing-dot{animation:chatbot-typing 1.4s ease-in-out infinite;background-color:#a0aec0;border-radius:50%;height:6px;margin:0 2px;width:6px}.chatbot-typing-dot:first-child{animation-delay:0s}.chatbot-typing-dot:nth-child(2){animation-delay:.2s}.chatbot-typing-dot:nth-child(3){animation-delay:.4s}@keyframes chatbot-typing{0%,60%,to{transform:translateY(0)}30%{transform:translateY(-5px)}}.chatbot-position-bottom-right{bottom:20px;right:20px}.chatbot-position-bottom-left{bottom:20px;left:20px}.chatbot-position-top-right{right:20px;top:20px}.chatbot-position-top-left{left:20px;top:20px}:root{--chatbot-theme-color:#667eea;--chatbot-theme-color-hover:#5a6fd1;--chatbot-header-bg:var(--chatbot-theme-color);--chatbot-header-text:#fff;--chatbot-bubble-size:60px;--chatbot-bubble-color:var(--chatbot-theme-color);--chatbot-user-bubble:var(--chatbot-theme-color);--chatbot-bot-bubble:#f0f2f5;--chatbot-text-size:0.95em}.chatbot-header{background-color:var(--chatbot-header-bg);color:var(--chatbot-header-text)}.chatbot-bubble{background-color:var(--chatbot-bubble-color);height:var(--chatbot-bubble-size);width:var(--chatbot-bubble-size)}.chatbot-message.user{background-color:var(--chatbot-user-bubble)}.chatbot-message.bot{background-color:var(--chatbot-bot-bubble)}.chatbot-message{font-size:var(--chatbot-text-size)}.chatbot-refresh-btn{background:none;border:none;color:inherit;cursor:pointer;font-size:1em;margin-left:auto;margin-right:10px;opacity:.7;transition:opacity .2s}.chatbot-refresh-btn:hover{opacity:1}');const o=()=>window.ChatbotSDK||{config:{}};function a(t,e,a,s={}){const r=o(),i=r.config.style?.components?.[e]?.[a]||{},c={...n(e,a,r.config.style?.messages||{}),...i,...s};Object.entries(c).forEach(([e,o])=>{null!=o&&(e.startsWith("--")?t.style.setProperty(e,o):t.style[e]=o)})}function n(t,e,o){const a={};switch(t){case"buttons":"button"===e&&(a.backgroundColor=o.buttonColor,a.color=o.buttonTextColor);break;case"carousel":"card"===e&&(a.backgroundColor=o.botBubbleColor),"cardTitle"!==e&&"cardSubtitle"!==e||(a.color=o.botTextColor);break;case"faq":"question"===e&&(a.color=o.botTextColor);break;case"rating":"star"===e&&(a.color=o.buttonColor)}return a}function s(t,e,o=null){switch(e){case"buttons":return i(t.buttons,o,t.style);case"image":return function(t,e={}){if(!t)return null;const o=document.createElement("img");return o.src=t,o.className="chatbot-image",a(o,"image","image",e),o}(t.image,t.style);case"video":return function(t,e={}){if(!t)return null;const o=document.createElement("video");return o.src=t,o.controls=!0,o.className="chatbot-video",a(o,"video","video",e),o}(t.video,t.style);case"carousel":return function(t,e,o={}){if(!t||0===t.length)return null;const n=document.createElement("div");return n.className="chatbot-carousel-container",a(n,"carousel","container",o.container),t.forEach(t=>{const s=document.createElement("div");if(s.className="chatbot-carousel-card",a(s,"carousel","card",o.card),t.image_url){const e=document.createElement("img");e.src=t.image_url,e.className="chatbot-carousel-card-image",a(e,"carousel","cardImage",o.cardImage),s.appendChild(e)}const r=document.createElement("div");r.className="chatbot-carousel-card-content",a(r,"carousel","cardContent",o.content);const c=document.createElement("h3");if(c.className="chatbot-carousel-card-title",c.textContent=t.title,a(c,"carousel","cardTitle",o.title),r.appendChild(c),t.subtitle){const e=document.createElement("p");e.className="chatbot-carousel-card-subtitle",e.textContent=t.subtitle,a(e,"carousel","cardSubtitle",o.subtitle),r.appendChild(e)}if(t.buttons?.length>0){const a=i(t.buttons,e,{...o,button:{...t.button_style||{}}});a&&r.appendChild(a)}s.appendChild(r),n.appendChild(s)}),n}(t.carousel,o,t.style);default:return null}}function r(t,e=null){if(!t)return null;const n=document.createElement("div");if(n.classList.add("chatbot-custom-payload"),a(n,"custom","container",t.style),t.locations){const e=function(t,e={}){if(!t||0===t.length)return null;const n=document.createElement("div");return n.className="chatbot-location-cards",a(n,"locations","container",e.container),t.forEach(t=>{const s=`https://www.google.com/maps?q=${t.lat},${t.lng}`,r=`https://maps.googleapis.com/maps/api/staticmap?center=${t.lat},${t.lng}&zoom=14&size=400x200&markers=color:red%7C${t.lat},${t.lng}&key=AIzaSyCYVHw1tnbSZsihFfewNPwvuKc0iXx0ymw`,i=document.createElement("div");i.className="chatbot-location-card",a(i,"locations","card",e.card);const c=document.createElement("img");c.src=r,c.alt=`${t.name} map`,c.className="chatbot-location-map",a(c,"locations","map",e.map),i.appendChild(c);const l=document.createElement("div");l.className="chatbot-location-body",a(l,"locations","body",e.body);const d=document.createElement("div");if(d.className="chatbot-location-title",d.textContent=t.name,a(d,"locations","title",e.title),l.appendChild(d),t.address){const o=document.createElement("div");o.className="chatbot-location-address",o.textContent=t.address,a(o,"locations","address",e.address),l.appendChild(o)}const h=document.createElement("a");h.href=s,h.target="_blank",h.className="chatbot-location-button",h.textContent="View on Map",a(h,"locations","button",{backgroundColor:o().config.style?.messages?.buttonColor,color:o().config.style?.messages?.buttonTextColor,...e.button}),l.appendChild(h),i.appendChild(l),n.appendChild(i)}),n}(t.locations,t.style);e&&n.appendChild(e)}if(t.faq_list){const e=function(t,e={}){if(!t||0===t.length)return null;const o=document.createElement("div");return o.className="chatbot-faq-list-container",a(o,"faq","container",e.container),t.forEach((t,n)=>{const s=document.createElement("div");s.className="chatbot-faq-item",a(s,"faq","item",e.item);const r=document.createElement("div");r.className="chatbot-faq-question",r.textContent=t.question,a(r,"faq","question",e.question),s.appendChild(r);const i=document.createElement("div");i.className="chatbot-faq-answer",i.innerHTML=t.answer,a(i,"faq","answer",e.answer),s.appendChild(i),r.addEventListener("click",()=>{s.classList.toggle("expanded"),s.classList.contains("expanded")?a(i,"faq","expandedAnswer",e.expandedAnswer):a(i,"faq","answer",e.answer)}),o.appendChild(s)}),o}(t.faq_list,t.style);e&&n.appendChild(e)}if(t.table){const e=function(t,e={}){if(!t||!t.headers||!t.rows)return null;const n=document.createElement("div");n.className="chatbot-table-container",a(n,"table","container",e.container);const s=document.createElement("table");s.className="chatbot-table",a(s,"table","table",e.table);const r=document.createElement("thead"),i=document.createElement("tr");t.headers.forEach(t=>{const n=document.createElement("th");n.textContent=t,a(n,"table","header",{backgroundColor:o().config.style?.messages?.buttonColor,color:o().config.style?.messages?.buttonTextColor,...e.header}),i.appendChild(n)}),r.appendChild(i),s.appendChild(r);const c=document.createElement("tbody");return t.rows.forEach(t=>{const o=document.createElement("tr");t.forEach(t=>{const n=document.createElement("td");n.textContent=t,a(n,"table","cell",e.cell),o.appendChild(n)}),c.appendChild(o)}),s.appendChild(c),n.appendChild(s),n}(t.table,t.style);e&&n.appendChild(e)}if(t.rating){const s=function(t,e,n={}){if(!t||!t.scale)return null;const s=document.createElement("div");s.className="chatbot-rating-container",a(s,"rating","container",n.container);const r=document.createElement("div");r.className="chatbot-rating-title",r.textContent=t.title||"Please rate:",a(r,"rating","title",n.title),s.appendChild(r);const i=document.createElement("div");i.className="chatbot-stars",a(i,"rating","starsContainer",n.starsContainer);let c=0;for(let s=t.scale;s>=1;s--){const t=document.createElement("span");t.innerHTML="&#9733;",t.dataset.value=s,a(t,"rating","star",{color:o().config.style?.messages?.buttonColor,...n.star}),t.addEventListener("mouseover",()=>{i.querySelectorAll("span").forEach(t=>{parseInt(t.dataset.value)>=s&&(t.classList.add("hover"),a(t,"rating","starHover",{color:o().config.style?.themeColor,...n.starHover}))})}),t.addEventListener("mouseout",()=>{i.querySelectorAll("span").forEach(t=>{t.classList.remove("hover"),a(t,"rating","star",{color:o().config.style?.messages?.buttonColor,...n.star})})}),t.addEventListener("click",()=>{c=s,i.querySelectorAll("span").forEach(t=>{parseInt(t.dataset.value)<=c?(t.classList.add("selected"),a(t,"rating","starSelected",{color:o().config.style?.themeColor,...n.starSelected})):(t.classList.remove("selected"),a(t,"rating","star",{color:o().config.style?.messages?.buttonColor,...n.star}))}),e&&e(`Rated ${c} stars`,`/rate_service{"rating":${c}}`)}),i.appendChild(t)}return s.appendChild(i),s}(t.rating,e,t.style);s&&n.appendChild(s)}if(t.forms){const s=function(t,e,n={}){if(!t||!t.fields||!t.submit_payload)return null;const s=document.createElement("div");if(s.className="chatbot-form-container",a(s,"form","container",n.container),t.title){const e=document.createElement("div");e.className="chatbot-form-title",e.textContent=t.title,a(e,"form","title",n.title),s.appendChild(e)}const r=document.createElement("form");a(r,"form","form",n.form),r.addEventListener("submit",o=>{o.preventDefault();const a={};if(t.fields.forEach(t=>{const e=r.querySelector(`[name="${t.field_name}"]`);e&&(a[t.field_name]=e.value)}),e){const o=`Submitted form: ${Object.entries(a).map(([t,e])=>`${t}: ${e}`).join(", ")}`,n=`${t.submit_payload}${JSON.stringify(a)}`;e(o,n)}r.querySelectorAll("input, select, button").forEach(t=>t.disabled=!0)}),t.fields.forEach(t=>{const e=document.createElement("div");e.className="chatbot-form-field",a(e,"form","field",n.field);const s=document.createElement("label");let i;s.textContent=t.label,s.htmlFor=`chatbot-form-${t.field_name}`,a(s,"form","label",n.label),e.appendChild(s),"select"===t.type&&t.options?(i=document.createElement("select"),t.options.forEach(t=>{const e=document.createElement("option");e.value=t,e.textContent=t,i.appendChild(e)})):(i=document.createElement("input"),i.type=t.type),i.id=`chatbot-form-${t.field_name}`,i.name=t.field_name,i.placeholder=t.placeholder||"",i.required=t.required||!1,a(i,"form","input",{backgroundColor:o().config.style?.messages?.inputBackground,color:o().config.style?.messages?.inputTextColor,borderColor:o().config.style?.messages?.inputBorderColor,...n.input}),e.appendChild(i),r.appendChild(e)});const i=document.createElement("button");return i.type="submit",i.className="chatbot-form-submit-button",i.textContent=t.submit_button_text||"Submit",a(i,"form","submitButton",{backgroundColor:o().config.style?.messages?.buttonColor,color:o().config.style?.messages?.buttonTextColor,...n.submitButton}),r.appendChild(i),s.appendChild(r),s}(t.forms,e,t.style);s&&n.appendChild(s)}return n.children.length>0?n:null}function i(t,e,o={}){if(!t||0===t.length)return null;const n=document.createElement("div");return n.className="chatbot-button-container",a(n,"buttons","container",o.container),t.forEach(t=>{const s=document.createElement("button");s.textContent=t.title,s.className="chatbot-button",a(s,"buttons","button",{...t.button_color&&{backgroundColor:t.button_color},...t.button_color&&{color:"white"},...t.button_color&&{borderColor:t.button_color},...o.button}),t.payload?s.addEventListener("click",()=>{n.querySelectorAll("button").forEach(t=>t.disabled=!0),e&&e(t.title,t.payload)}):t.url?s.addEventListener("click",()=>window.open(t.url,"_blank")):t.question&&s.addEventListener("click",()=>{n.querySelectorAll("button").forEach(t=>t.disabled=!0),e&&e(t.title,t.question)}),n.appendChild(s)}),n}window.ChatbotSDK=new class{constructor(){this.config={},this.isOpen=!1,this.sessionId=null,this.messages=[],this.elements={},this.refreshInterval=null,this.debug=!0}log(...t){this.debug&&console.log("[Chatbot]",...t)}initConfig(t={}){const e=document.querySelector('script[src*="chatbot.bundle.js"]');let o={};if(e){const t=e.getAttribute("chatbot-config");if(t)try{o=JSON.parse(t)}catch(t){console.error("Chatbot SDK: Invalid JSON in chatbot-config attribute",t)}}this.config={...o,...t},this.config.botUrl=this.config.botUrl||"http://0.0.0.0:8000/api/v1/chatbot/chat",this.config.themeColor=this.config.themeColor||"#020c15ff",this.config.position=this.config.position||"bottom-right",this.config.botName=this.config.botName||"Chatbot",this.config.inputPlaceholder=this.config.inputPlaceholder||"Type your message...",this.config.sendButtonText=this.config.sendButtonText||"Send"}async init(){this.initConfig(),await this.loadConfig(),this.initSession(),"complete"===document.readyState||"interactive"===document.readyState?this.createWidgetUI():document.addEventListener("DOMContentLoaded",()=>{console.log("DOM fully loaded, creating UI"),this.createWidgetUI()}),setTimeout(()=>{this.elements.container||(console.warn("Fallback UI creation"),this.createWidgetUI())},1e3)}async loadConfig(){if(this.config.configApiUrl)try{this.log("Loading initial config from API");const t=await fetch(`${this.config.configApiUrl}?t=${Date.now()}`),e=await t.json();this.mergeConfigs(e)}catch(t){this.log("Initial config load failed:",t)}}async refreshConfig(){try{this.log("Refreshing configuration...");const t=await fetch(`${this.config.configApiUrl}?t=${Date.now()}`),e=await t.json();return this.mergeConfigs(e),this.applyDynamicStyles(),this.updateUIElements(),this.log("Configuration refreshed successfully"),!0}catch(t){return this.log("Failed to refresh config:",t),!1}}mergeConfigs(t){this.config={...this.config,...t,style:{...this.config.style||{},...t.style||{}},features:{...this.config.features||{},...t.features||{}}},this.log("Merged config:",this.config)}applyDynamicStyles(){if(!this.config.style)return void this.log("No style configuration found");const t=document.documentElement,{style:e}=this.config;e.themeColor&&(t.style.setProperty("--chatbot-theme-color",e.themeColor),t.style.setProperty("--chatbot-theme-color-hover",this.adjustColor(e.themeColor,-20))),e.header?.backgroundColor&&t.style.setProperty("--chatbot-header-bg",e.header.backgroundColor),e.header?.textColor&&t.style.setProperty("--chatbot-header-text",e.header.textColor),e.bubble?.color&&t.style.setProperty("--chatbot-bubble-color",e.bubble.color),e.messages?.userBubbleColor&&t.style.setProperty("--chatbot-user-bubble",e.messages.userBubbleColor),e.messages?.botBubbleColor&&t.style.setProperty("--chatbot-bot-bubble",e.messages.botBubbleColor)}adjustColor(t,e){return"#"+t.replace(/^#/,"").replace(/../g,t=>("0"+Math.min(255,Math.max(0,parseInt(t,16)+e)).toString(16)).slice(-6))}createWidgetUI(){console.log("Creating widget UI..."),console.log("Config:",this.config);const t=document.createElement("div");t.id="chatbot-widget-container",console.log("Container created:",t),t.classList.add(`chatbot-position-${this.config.position}`),t.style.display="none",t.style.opacity="0",document.body.appendChild(t),this.elements.container=t,setTimeout(()=>{const t=window.getComputedStyle(this.elements.container);console.log("Computed styles:",{display:t.display,opacity:t.opacity,zIndex:t.zIndex,visibility:t.visibility})},500);const e=this.config.style?.animation||{type:"fade-in",duration:300};e.type&&(t.style.transition=`all ${e.duration}ms ease`);const o=document.createElement("div");o.className="chatbot-bubble";const a=this.config.style?.bubble||{};o.style.width=a.size||"60px",o.style.height=a.size||"60px",o.style.backgroundColor=a.color||"var(--chatbot-theme-color)",a.icon?o.innerHTML=a.icon.startsWith("http")?`<img src="${a.icon}" alt="Chat" style="width: 70%; height: 70%;">`:a.icon:o.innerHTML='\n        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white">\n          <path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-2 12H6v-2h12v2zm0-3H6V9h12v2zm0-3H6V6h12v2z"/>\n        </svg>\n      ',o.addEventListener("click",()=>this.toggleChatWindow()),t.appendChild(o),this.elements.bubble=o;const n=document.createElement("div");n.className="chatbot-window",this.refreshConfig();const s=this.config.style?.header||{};n.innerHTML=`\n      <div class="chatbot-header" style="\n        ${s.backgroundColor?`background-color: ${s.backgroundColor};`:""}\n        ${s.textColor?`color: ${s.textColor};`:""}\n      ">\n        ${s.icon?`<img src="${s.icon}" class="chatbot-header-icon" \n            style="width: ${s.iconSize||"30px"}; height: ${s.iconSize||"30px"};">`:""}\n        <span class="chatbot-header-title">${this.config.botName}</span>\n        <button class="chatbot-header-close" style="\n          ${s.textColor?`color: ${s.textColor};`:""}\n        ">&times;</button>\n      </div>\n      <div class="chatbot-messages"></div>\n      <div class="chatbot-input-area">\n        <input type="text" placeholder="${this.config.inputPlaceholder}" />\n        <button class="chatbot-send-button">${this.config.sendButtonText}</button>\n      </div>\n    `,t.appendChild(n),this.elements.window=n,this.elements.messagesContainer=n.querySelector(".chatbot-messages"),this.elements.inputField=n.querySelector(".chatbot-input-area input"),this.elements.sendButton=n.querySelector(".chatbot-input-area button"),this.elements.closeButton=n.querySelector(".chatbot-header-close"),this.elements.headerTitle=n.querySelector(".chatbot-header-title"),this.elements.closeButton.addEventListener("click",()=>this.toggleChatWindow()),this.elements.sendButton.addEventListener("click",()=>this.sendMessage()),this.elements.inputField.addEventListener("keypress",t=>{"Enter"===t.key&&this.sendMessage()}),this.messages.forEach(t=>this.displayMessage(t,!1)),this.scrollToBottom(),this.showWidget(),this.config.autoRefresh&&this.startAutoRefresh(this.config.autoRefreshInterval||3e5)}updateUIElements(){this.elements.headerTitle&&(this.elements.headerTitle.textContent=this.config.botName),this.elements.inputField&&(this.elements.inputField.placeholder=this.config.inputPlaceholder),this.elements.sendButton&&(this.elements.sendButton.textContent=this.config.sendButtonText)}showWidget(){console.log("Attempting to show widget..."),this.elements.container.style.display="block",this.elements.container.style.opacity="1",this.elements.container.style.zIndex="99999";const t=this.config.style?.animation||{type:"fade-in",duration:300};console.log("Using animation:",t),this.elements.container.style.display="block","fade-in"===t.type?setTimeout(()=>{this.elements.container.style.opacity="1"},50):"slide-up"===t.type?(this.elements.container.style.transform="translateY(20px)",setTimeout(()=>{this.elements.container.style.transition=`all ${t.duration}ms ease`,this.elements.container.style.opacity="1",this.elements.container.style.transform="translateY(0)"},50)):this.elements.container.style.opacity="1"}startAutoRefresh(t=3e5){this.stopAutoRefresh(),this.refreshInterval=setInterval(()=>this.refreshConfig(),t),this.log(`Started auto-refresh every ${t/1e3} seconds`)}stopAutoRefresh(){this.refreshInterval&&(clearInterval(this.refreshInterval),this.refreshInterval=null)}initSession(){this.sessionId=e("chatbot_session_id"),this.sessionId||(this.sessionId="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){const e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)}),t("chatbot_session_id",this.sessionId)),this.messages=e(`chatbot_conversation_${this.sessionId}`)||[]}displayMessage(e,o=!0){const a=document.createElement("div");if(a.classList.add("chatbot-message","user"===e.sender?"user":"bot"),e.text){const t=document.createElement("div");t.innerHTML=function(t){if(!t)return"";let e=t;return e=e.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>"),e=e.replace(/__(.*?)__/g,"<strong>$1</strong>"),e=e.replace(/\*(.*?)\*/g,"<em>$1</em>"),e=e.replace(/_(.*?)_/g,"<em>$1</em>"),e=e.replace(/\[([^\]]+)\]\(([^)]+)\)/g,'<a href="$2" target="_blank" rel="noopener noreferrer">$1</a>'),e=e.replace(/\n/g,"<br/>"),e}(e.text),a.appendChild(t)}if(e.buttons?.length>0){const t=s(e,"buttons",this.sendMessage.bind(this));t&&a.appendChild(t)}if(e.image){const t=s(e,"image");t&&a.appendChild(t)}if(e.video){const t=s(e,"video");t&&a.appendChild(t)}if(e.carousel?.length>0){const t=s(e,"carousel",this.sendMessage.bind(this));t&&a.appendChild(t)}if(e.custom){const t=r(e.custom,this.sendMessage.bind(this));t&&a.appendChild(t)}this.elements.messagesContainer.appendChild(a),o&&(this.messages.push(e),t(`chatbot_conversation_${this.sessionId}`,this.messages)),this.scrollToBottom()}async sendMessage(t=null,e=null){let o=t||this.elements.inputField.value.trim();if(!o&&!e)return;const a={sender:"user",text:o};this.displayMessage(a),this.elements.inputField.value="";const n={sender:this.sessionId,message:o,...e&&{customData:{payload:e}}};try{const t=await fetch(this.config.botUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const e=await t.json();e?.length>0?e.forEach(t=>this.displayMessage({sender:"bot",...t})):this.displayMessage({sender:"bot",text:"Sorry, I didn't get a response."})}catch(t){console.error("Chatbot error:",t),this.displayMessage({sender:"bot",text:"I'm having trouble connecting. Please try again later."})}}toggleChatWindow(){this.isOpen=!this.isOpen,this.elements.window.classList.toggle("open",this.isOpen),this.elements.bubble.classList.toggle("hidden",this.isOpen),this.isOpen&&(this.elements.inputField.focus(),this.scrollToBottom())}scrollToBottom(){this.elements.messagesContainer&&(this.elements.messagesContainer.scrollTop=this.elements.messagesContainer.scrollHeight)}},window.ChatbotSDK.init()}();
//# sourceMappingURL=chatbot.bundle.js.map
